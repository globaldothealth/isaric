#:schema ../../schemas/dev/parser.schema.json

[adtl]
  name = "ccp-guinea"
  description = "ccp-guinea"
  defaultDateFormat = "%d/%m/%Y"
  experimental_agents = [
    'Chloroquine',
    'Hydroxychloroquine',
    'Remdesivir',
    'IL6/IL1 inhibitors',
    'Convalescent plasma',
  ]

  [adtl.tables.subject]
    kind = "groupBy"
    groupBy = "subject_id"
    aggregation = "lastNotNull"
    schema = "../../schemas/dev/subject.schema.json"
    optional-fields = ["ethnicity"]

  [adtl.tables.visit]
    kind = "groupBy"
    groupBy = "visit_id"
    aggregation = "lastNotNull"
    schema = "../../schemas/dev/visit.schema.json"

  [adtl.tables.observation]
    kind = "oneToMany"
    schema = "../../schemas/dev/observation.schema.json"
    common = { visit_id = { field = "record_id", sensitive = true } }

[adtl.defs]
  "Y/N" = { values = { 1 = true, 2 = false } }
  checkbox = { values = { 1 = true } }

  [adtl.defs.admissionDateHierarchy]
    combinedType = "firstNonNull"
    fields = [
      { field = "add_date" },
      { field = "signes_date_t", description = "Admission signs form date", source_date = "%d/%m/%Y %H:%M" },
      { field = "demo_date_t", description = "Demographics form date", source_date = "%d/%m/%Y %H:%M" },
    ]

  [adtl.defs.countryMap.values]
    1 = "AFG"
    2 = "ALB"
    3 = "DZA"
    4 = "AND"
    5 = "AGO"
    6 = "ATG"
    7 = "ARG"
    8 = "ARM"
    9 = "AUS"
    10 = "AUT"
    11 = "AZE"
    12 = "BHS"
    13 = "BHR"
    14 = "BGD"
    15 = "BRB"
    16 = "BLR"
    17 = "BEL"
    18 = "BLZ"
    19 = "BEN"
    20 = "BTN"
    21 = "BOL"
    22 = "BIH"
    23 = "BWA"
    24 = "BRA"
    25 = "BRN"
    26 = "BGR"
    27 = "BFA"
    28 = "BDI"
    29 = "KHM"
    30 = "CMR"
    31 = "CAN"
    32 = "CPV"
    33 = "CAF"
    34 = "TCD"
    35 = "CHL"
    36 = "CHN"
    37 = "COL"
    38 = "COM"
    39 = "COG"
    40 = "COD"
    41 = "CRI"
    42 = "HRV"
    43 = "CUB"
    44 = "CYP"
    45 = "CZE"
    46 = "DNK"
    47 = "DJI"
    48 = "DMA"
    49 = "DOM"
    50 = "TLS"
    51 = "ECU"
    52 = "EGY"
    53 = "SLV"
    54 = "GNQ"
    55 = "ERI"
    56 = "EST"
    57 = "ETH"
    58 = "FJI"
    59 = "FIN"
    60 = "FRA"
    61 = "GAB"
    62 = "GMB"
    63 = "GEO"
    64 = "DEU"
    65 = "GHA"
    66 = "GRC"
    67 = "GRD"
    68 = "GTM"
    69 = "GIN"
    70 = "GNB"
    71 = "GUY"
    72 = "HTI"
    73 = "HND"
    74 = "HUN"
    75 = "ISL"
    76 = "IND"
    77 = "IDN"
    78 = "IRN"
    79 = "IRQ"
    80 = "IRL"
    81 = "ISR"
    82 = "ITA"
    83 = "CIV"
    84 = "JAM"
    85 = "JPN"
    86 = "JOR"
    87 = "KAZ"
    88 = "KEN"
    89 = "KIR"
    90 = "PRK"
    91 = "KOR"
    92 = "XXK"
    93 = "KWT"
    94 = "KGZ"
    95 = "LAO"
    96 = "LVA"
    97 = "LBN"
    98 = "LSO"
    99 = "LBR"
    100 = "LBY"
    101 = "LIE"
    102 = "LTU"
    103 = "LUX"
    104 = "MKD"
    105 = "MDG"
    106 = "MWI"
    107 = "MYS"
    108 = "MDV"
    109 = "MLI"
    110 = "MLT"
    111 = "MHL"
    112 = "MRT"
    113 = "MUS"
    114 = "MEX"
    115 = "FSM"
    116 = "MDA"
    117 = "MCO"
    118 = "MNG"
    119 = "MNE"
    120 = "MAR"
    121 = "MOZ"
    122 = "MMR"
    123 = "NAM"
    124 = "NRU"
    125 = "NPL"
    126 = "NLD"
    127 = "NZL"
    128 = "NIC"
    129 = "NER"
    130 = "NGA"
    131 = "NOR"
    132 = "OMN"
    133 = "PAK"
    134 = "PLW"
    135 = "PAN"
    136 = "PNG"
    137 = "PRY"
    138 = "PER"
    139 = "PHL"
    140 = "POL"
    141 = "PRT"
    142 = "QAT"
    143 = "ROU"
    144 = "RUS"
    145 = "RWA"
    146 = "KNA"
    147 = "LCA"
    148 = "VCT"
    149 = "WSM"
    150 = "SMR"
    151 = "STP"
    152 = "SAU"
    153 = "SEN"
    154 = "SRB"
    155 = "SYC"
    156 = "SLE"
    157 = "SGP"
    158 = "SVK"
    159 = "SVN"
    160 = "SLB"
    161 = "SOM"
    162 = "ZAF"
    163 = "SSD"
    164 = "ESP"
    165 = "LKA"
    166 = "SDN"
    167 = "SUR"
    168 = "SWZ"
    169 = "SWE"
    170 = "CHE"
    171 = "SYR"
    172 = "TWN"
    173 = "TJK"
    174 = "TZA"
    175 = "THA"
    176 = "TGO"
    177 = "TON"
    178 = "TTO"
    179 = "TUN"
    180 = "TUR"
    181 = "TKM"
    182 = "TUV"
    183 = "UGA"
    184 = "UKR"
    185 = "ARE"
    186 = "GBR"
    187 = "USA"
    188 = "URY"
    189 = "UZB"
    190 = "VUT"
    191 = "VAT"
    192 = "VEN"
    193 = "VNM"
    194 = "YEM"
    195 = "ZMB"
    196 = "ZWE"


[subject]
  pathogen = "COVID-19"

  [subject.subject_id]
    field = "record_id"
    sensitive = true

  [subject.earliest_admission_date]
    combinedType = "min"
    fields = [{ ref = "admissionDateHierarchy" }]

  [subject.enrolment_date]
    field = "recruit_date"

  [subject.sex]
    field = "sex"
    values = { 0 = "female", 1 = "male" }

  [subject.age]
    combinedType = "firstNonNull"
    fields = [
      { field = "age", description = "Age", source_unit = { field = "age_unit", values = { 1 = "years", 2 = "months", 3 = "days" } }, unit = "years" },
      { field = "dob", apply = { function = "yearsElapsed", params = [
        "$signes_date_t",
        2022,
        "%d/%m/%Y",
        "%d/%m/%Y %H:%M",
      ] } },
    ]

  [subject.date_of_birth]
    field = "dob"
    source_date = "%d/%m/%Y"

  [subject.dob_year]
    combinedType = "firstNonNull"
    fields = [
      { field = "dob", apply = { function = "splitDate", params = [
        "year",
        2022,
        "%d/%m/%Y",
      ] } },
      { field = "age", if.any = [
        { age_unit = 1 },
        { age_unit = "" },
      ], apply = { function = "startYear", params = [
        [
          "$signes_date_t",
          "$demo_date_t",
        ],
        2022,
        "%d/%m/%Y %H:%M",
      ] } },
      { field = "age", if = { age_unit = 2 }, apply = { function = "startYear", params = [
        "$signes_date_t",
        2022,
        "%d/%m/%Y %H:%M",
        "months",
      ] } },
      { field = "age", if = { age_unit = 3 }, apply = { function = "startYear", params = [
        "$signes_date_t",
        2022,
        "%d/%m/%Y %H:%M",
        "days",
      ] } },
    ]

  [subject.dob_month]
    combinedType = "firstNonNull"
    fields = [
      { field = "dob", apply = { function = "splitDate", params = [
        "month",
        2022,
        "%d/%m/%Y",
      ] } },
      { field = "age", if = { age_unit = 2 }, apply = { function = "startMonth", params = [
        "$signes_date_t",
        2022,
        "%d/%m/%Y %H:%M",
      ] } },
      { field = "age", if = { age_unit = 3 }, apply = { function = "startMonth", params = [
        "$signes_date_t",
        2022,
        "%d/%m/%Y %H:%M",
        "days",
      ] } },
    ]

  [subject.dob_day]
    field = "dob"
    apply = { function = "splitDate", params = ["day", 2022, "%d/%m/%Y"] }

  [subject.ethnicity]
    combinedType = "set"
    excludeWhen = "none"

    [[subject.ethnicity.fields]]
      field = "ethnicity"

      [subject.ethnicity.fields.values]
        1 = "Arabic"
        2 = "Black"
        3 = "South_Asian"
        4 = "East_Asian"
        5 = "West_Asian"
        6 = "Latin_American"
        7 = "White"
        8 = "Aboriginal_First_Nations"

[subject.has_asthma]
  field = "asthma"
  description = "Asthma (diagnosed by a physician)"
  ref = "Y/N"

[subject.has_chronic_cardiac_disease]
  field = "cardiac"
  description = "Chronic heart disease, including congenital heart disease (not hypertension)"
  ref = "Y/N"

[subject.has_chronic_hematologic_disease]
  field = "hem_dse"
  description = "Chronic blood disease"
  ref = "Y/N"

[subject.has_chronic_kidney_disease]
  field = "ckd"
  description = "Chronic kidney disease"
  ref = "Y/N"

[subject.has_dementia]
  field = "dement"
  description = "Dementia"
  ref = "Y/N"

[subject.has_diabetes]
  combinedType = "any"
  fields = [
    { field = "diab", description = "Diabetes", ref = "Y/N" },
    { field = "diab_comp", description = "Diabetes without complication", ref = "Y/N" },
  ]

[subject.has_hiv]
  combinedType = "any"
  fields = [
    { field = "aids", description = "HIV/AIDS", ref = "Y/N" },
    { field = "hiv_res", description = "HIV 1&2 test result", values = { 1 = true, 0 = false } },
  ]

[subject.has_hypertension]
  field = "hypertension"
  description = "Hypertension"
  ref = "Y/N"

[subject.has_immunosuppression]
  field = "other_imm_supps_premed"
  description = "Other Immunosuppressive Agents"
  ref = "Y/N"

[subject.has_liver_disease]
  combinedType = "any"
  fields = [
    { field = "hep_dse_mild", description = "Mild liver disease", ref = "Y/N" },
    { field = "hep_dse_mod_sev", description = "Moderate or severe liver disease", ref = "Y/N" },
  ]

[subject.has_malignant_neoplasm]
  field = "neopla"
  description = "Malignant tumor"
  ref = "Y/N"

[subject.has_malnutrition]
  field = "malnu"
  description = "Malnutrition"
  ref = "Y/N"

[subject.has_obesity]
  field = "obesity"
  description = "Obesity (as defined by caregiver)"
  ref = "Y/N"

[subject.has_solid_organ_transplant]
  field = "organ_rec"
  description = "Transplanted (organ or bone marrow)"
  ref = "Y/N"

[subject.has_tuberculosis]
  field = "tuberculosis"
  description = "Tuberculosis"
  ref = "Y/N"

[subject.icu_admitted]
  field = "on_admn"
  values = { 1 = true }

[subject.pregnancy]
  field = "preg_2"
  ref = "Y/N"

[subject.pregnancy_post_partum]
  field = "preg_2"
  description = "Whether currently pregnant or in post-partum period"
  ref = "Y/N"

[subject.pregnancy_gestational_age_weeks]
  field = "gest"
  description = "Gestational age"
  unit = "weeks"
  apply = { function = "getFloat" }

[subject.pregnancy_outcome]
  field = "del_outcome"
  values = { 0 = "still born", 1 = "live birth" }

[subject.pregnancy_whether_breastfed]
  field = "breastfed"
  ref = "Y/N"

[subject.pregnancy_gestational_outcome]
  field = "gest_out"
  values = { 1 = "term_birth", 2 = "preterm_birth" }

[subject.works_healthcare]
  field = "hth_wrk"
  description = "Employed as a health worker?"
  values = { 1 = true, 0 = false }

[subject.works_lab]
  field = "microb"
  description = "Employee of a microbiology laboratory"
  values = { 1 = true }

[subject.works_microbiology_lab]
  field = "microb"
  description = "Employee of a microbiology laboratory"
  values = { 1 = true, 0 = false }

  # VISIT

[visit.subject_id]
  field = "record_id"
  sensitive = true

[visit.visit_id]
  field = "record_id"
  sensitive = true

[visit.country_iso3]
  field = "country"
  ref = "countryMap"

[visit.outcome]
  field = "outcome"

  [visit.outcome.values]
    1 = "discharged"
    2 = "discharged"
    3 = "transferred"
    4 = "death"
    5 = "discharged"           # released with home care
    6 = "palliative discharge" # released with palliative care

[visit.start_date]
  ref = "admissionDateHierarchy"

[visit.date_outcome]
  field = "outcome_date"
  source_date = "%d/%m/%Y"

[visit.icu_admission]
  field = "on_admn"
  values = { 1 = true }

[visit.icu_admission_dates]
  combinedType = "set"
  excludeWhen = "none"
  fields = [{ field = "icu_date" }]

[visit.pathogen_test_date]
  field = "path_date"
  description = "Test date"

[visit.treatment_antibiotics]
  field = "daily_antibiotic_cmyn"
  description = "Antibiotics"
  values = { 1 = true, 0 = false }

[visit.treatment_antibiotics_type]
  combinedType = "set"
  excludeWhen = "none"
  description = "Antibiotic given - free text field"
  fields = [{ field = "daily_antibiot_cmyn_name" }]

[visit.treatment_ace_inhibitors]
  field = "daily_ace_cmoccur"
  description = "Angiotensin converting enzyme (ACE) inhibitors?"
  values = { 1 = true, 0 = false }

[visit.treatment_antifungal_agent]
  field = "daily_antifung_cmyn"
  description = "Antifungal agent?"
  values = { 1 = true, 0 = false }

[visit.treatment_arb]
  field = "daily_arb_cmoccur"
  description = "Angiotensin II receptor antagonists (ARBs)?"
  values = { 1 = true, 0 = false }

[visit.treatment_antimalarial]
  combinedType = "any"
  excludeWhen = "none"
  fields = [
    { field = "daily_antimal_cmyn", description = "Antimalarials?", values = { 1 = true, 0 = false } },
    { field = "daily_exper_cmtype___1", ref = "checkbox" },
    { field = "daily_exper_cmtype___2", ref = "checkbox" },
  ]

[visit.treatment_antimalarial_type]
  combinedType = "set"
  excludeWhen = "none"
  fields = [
    { field = "daily_exper_cmtype___1", values = { 1 = "Chloroquine" } },
    { field = "daily_exper_cmtype___2", values = { 1 = "Hydroxychloroquine" } },
  ]

[visit.treatment_antiviral_type]
  description = "Type of antiviral agent used"
  combinedType = "set"
  excludeWhen = "none"
  fields = [
    { field = "daily_antiviral_cmtrt___1", values = { 1 = "Ribavirin" } },
    { field = "daily_antiviral_cmtrt___2", values = { 1 = "Lopinavir/Ritonavir" } },
    { field = "daily_antiviral_cmtrt___3", values = { 1 = "Interferon alpha" } },
    { field = "daily_antiviral_cmtrt___4", values = { 1 = "Interferon beta" } },
    { field = "daily_antiviral_cmtrt___5", values = { 1 = "Neuraminidase inhibitor" } },
    { field = "daily_antiviral_cmtrt___6", values = { 1 = "Other" } },
  ]

[visit.treatment_antivirals]
  field = "daily_antiviral_cmyn"
  values = { 1 = true, 0 = false }

[visit.treatment_high_flow_nasal_cannula]
  combinedType = "any"
  fields = [
    { field = "daily_oxygen_cmtype_1", values = { 2 = true } },
    { field = "can_oxy_ther", values = { 1 = true, 2 = false } },
  ]

[visit.treatment_dialysis]
  combinedType = "any"

  [[visit.treatment_dialysis.fields]]
    field = "dialy_hemo"
    description = "Dialysis/Hemofiltration?"
    ref = "Y/N"

[visit.treatment_ecmo]
  field = "ecls"
  description = "Extracorporeal (ECMO) support"
  ref = "Y/N"

[visit.treatment_corticosteroid]
  field = "daily_corticost_cmyn"
  description = "Corticosteroids"
  ref = "Y/N"

[visit.treatment_corticosteroid_type]
  combinedType = "set"
  excludeWhen = "none"
  fields = [
    { field = "hydrocortisone", values = { 1 = "Hydrocortisone" } },
    { field = "prednisone", values = { 1 = "Prednisone" } },
    { field = "methylprednisolone", values = { 1 = "Methylprednisolone" } },
    { field = "daily_corticost_cmtrt___1", values = { 1 = "Dexamethasone" } },
    { field = "daily_corticost_cmtrt___2", values = { 1 = "Hydrocortisone" } },
    { field = "daily_corticost_cmtrt___3", values = { 1 = "Prednisolone" } },
    { field = "daily_corticost_cmtrt___4", values = { 1 = "Methylprednisolone" } },
    { field = "daily_corticost_cmtrt___5", values = { 1 = "Other" } },
  ]

  # daily_corticost_cmoth is empty

[visit.treatment_cardiovascular_support]
  combinedType = "any"
  fields = [
    { field = "vaso_or_inot", description = "Any administration of vasopressor/inotrope?", ref = "Y/N" },
  ]

[visit.treatment_inotropes_vasopressors]
  field = "vaso_or_inot"
  description = "Any administration of vasopressor/inotrope?"
  ref = "Y/N"

[visit.treatment_invasive_ventilation]
  field = "inv_vent"
  ref = "Y/N"

[visit.treatment_noninvasive_ventilation]
  field = "non_inv_vent"
  ref = "Y/N"

[visit.treatment_other]
  combinedType = "set"
  excludeWhen = "none"
  fields = [
    { field = "other_meds_1", description = "Other treatment" },
    { field = "other_meds_2", description = "Other treatment" },
    { field = "other_intervs_specify" },
    { field = "daily_exper_cmtype___3", values = { 1 = "Remdesivir" } },
    { field = "daily_exper_cmtype___4", values = { 1 = "IL6 inhibitor" } },
    { field = "daily_exper_cmtype___5", values = { 1 = "IL1 inhibitor" } },
    { field = "daily_exper_cmtype___6", values = { 1 = "Convalescent plasma" } },
    { field = "daily_exper_cmoth" },
  ]

[visit.treatment_oxygen_therapy]
  combinedType = "any"
  fields = [
    { field = "can_oxy_ther", ref = "Y/N" },
    { field = "non_inv_vent", ref = "Y/N" },
    { field = "inv_vent", ref = "Y/N" },
    { field = "ecls", ref = "Y/N" },
    { field = "fio2", if = { fio2 = { ">" = 21 } }, apply = { function = "isNotNull" } },
    { field = "any_supplemental_oxygen_value", if = { fio2_0_21_1_0_unit = 2 }, apply = { function = "isNotNull" } },
    { field = "any_supplemental_oxygen_value", if.all = [
      { fio2_0_21_1_0_unit = 1 },
      { any_supplemental_oxygen_value = { ">" = 21 } },
    ], apply = { function = "isNotNull" } },
    { field = "daily_oxygen_cmdose_1", values = { 1 = true, 2 = true, 3 = true, 4 = true } },
  ]

[visit.treatment_prone_position]
  field = "prone"
  description = "Prone position"
  ref = "Y/N"

[visit.treatment_inhaled_nitric_oxide]
  field = "inhaled_nitric"
  description = "Inhaled nitric oxide"
  ref = "Y/N"

[visit.treatment_neuromuscular_blocking_agents]
  field = "neuro_block"
  ref = "Y/N"

[visit.treatment_intravenous_fluids]
  field = "daily_iv_fluids_cmyn"
  ref = "Y/N"

[visit.treatment_nsaid]
  field = "daily_nsaid_cmoccur"
  ref = "Y/N"

  # Observations

[[observation]]
  name = "abdominal_pain"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  duration_type = "event"
  start_date = { field = "abd_pain_date" }
  is_present = { field = "abd_pain", ref = "Y/N" }

[[observation]]
  name = "lymphadenopathy"
  phase = "study"
  is_present = { field = "lymphadenopathy_v2", ref = "Y/N" }

  [observation.date]
    combinedType = "firstNonNull"
    fields = [
      { field = "lymphadenopathy_v2_date" },
      { field = "signs_symps_date" },
    ]

[[observation]]
  name = "altered_consciousness_confusion"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  start_date = { field = "consciousness_date" }
  duration_type = "event"
  is_present = { field = "consciousness", values = { 1 = true, 0 = false } }

[[observation]]
  name = "altered_consciousness_confusion"
  phase = "study"
  is_present = { field = "consciousness_v2", ref = "Y/N" }

  [observation.date]
    combinedType = "firstNonNull"
    fields = [
      { field = "consciousness_v2_date" },
      { field = "signs_symps_date" },
    ]

[[observation]]
  name = "base_excess"
  phase = "study"
  date = { field = "icu_date" }
  value = { field = "base_excess", description = "Basic excess" }

[[observation]]
  name = "chest_pain"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  start_date = { field = "chest_pain_date" }
  duration_type = "event"
  is_present = { field = "chest_pain", values = { 1 = true, 0 = false } }

[[observation]]
  name = "chest_pain"
  phase = "study"
  is_present = { field = "chest_pain_v2", ref = "Y/N" }

  [observation.date]
    combinedType = "firstNonNull"
    fields = [{ field = "chest_pain_v2_date" }, { field = "signs_symps_date" }]

[[observation]]
  name = "conjunctivitis"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  start_date = { field = "conjunc_date" }
  duration_type = "event"
  is_present = { field = "conjunc", values = { 1 = true, 0 = false } }

[[observation]]
  name = "conjunctivitis"
  phase = "study"
  is_present = { field = "conjunc_v2", ref = "Y/N" }

  [observation.date]
    combinedType = "firstNonNull"
    fields = [{ field = "conjunc_v2_date" }, { field = "signs_symps_date" }]

[[observation]]
  name = "cough"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  duration_type = "event"

  [observation.is_present]
    combinedType = "any"
    fields = [
      { field = "cough", values = { 1 = true, 0 = false } },
      { field = "dry_cough", values = { 1 = true, 0 = false } },
      { field = "wet_cough", values = { 1 = true, 0 = false } },
      { field = "blood_cough", values = { 1 = true, 0 = false } },
    ]
  [observation.start_date]
    combinedType = "min"
    fields = [
      { field = "dry_cough_date" },
      { field = "wet_cough_date" },
      { field = "blood_cough_date" },
    ]

[[observation]]
  name = "cough_dry"
  phase = "admission"
  start_date = { field = "dry_cough_date" }
  duration_type = "event"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "dry_cough", values = { 1 = true, 0 = false } }

[[observation]]
  name = "cough_with_sputum_production"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  start_date = { field = "wet_cough_date" }
  duration_type = "event"
  is_present = { field = "wet_cough", values = { 1 = true, 0 = false } }

[[observation]]
  name = "cough_with_haemoptysis"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  start_date = { field = "blood_cough_date" }
  duration_type = "event"
  is_present = { field = "blood_cough", values = { 1 = true, 0 = false } }

[[observation]]
  name = "cough"
  phase = "study"
  [observation.is_present]
    combinedType = "any"
    fields = [
      { field = "cough_v2", ref = "Y/N" },
      { field = "dry_cough_v2", ref = "Y/N" },
      { field = "wet_cough_v2", ref = "Y/N" },
      { field = "blood_cough_v2", ref = "Y/N" },
    ]
  [observation.date]
    combinedType = "min"
    fields = [
      { field = "dry_cough_v2_date" },
      { field = "wet_cough_v2_date" },
      { field = "blood_cough_v2_date" },
      { field = "signs_symps_date" },
    ]

[[observation]]
  name = "cough_dry"
  phase = "study"
  is_present = { field = "dry_cough_v2", ref = "Y/N" }

  [observation.date]
    combinedType = "firstNonNull"
    fields = [{ field = "dry_cough_v2_date" }, { field = "signs_symps_date" }]

[[observation]]
  name = "cough_with_sputum_production"
  phase = "study"
  is_present = { field = "wet_cough_v2", ref = "Y/N" }

  [observation.date]
    combinedType = "firstNonNull"
    fields = [{ field = "wet_cough_v2_date" }, { field = "signs_symps_date" }]

[[observation]]
  name = "cough_with_haemoptysis"
  phase = "study"
  is_present = { field = "blood_cough_v2", ref = "Y/N" }

  [observation.date]
    combinedType = "firstNonNull"
    fields = [{ field = "blood_cough_v2_date" }, { field = "signs_symps_date" }]

[[observation]]
  name = "diarrhoea"
  phase = "admission"
  is_present = { field = "diarrhea", values = { 1 = true, 0 = false } }
  date = { ref = "admissionDateHierarchy" }
  start_date = { field = "diarrhea_date" }
  duration_type = "event"

[[observation]]
  name = "diarrhoea"
  phase = "study"
  is_present = { field = "diarrhea_v2", ref = "Y/N" }

  [observation.date]
    combinedType = "firstNonNull"
    fields = [{ field = "diarrhea_v2_date" }, { field = "signs_symps_date" }]

[[observation]]
  name = "ear_pain"
  phase = "admission"
  is_present = { field = "ear_pain", values = { 1 = true, 0 = false } }
  date = { ref = "admissionDateHierarchy" }
  start_date = { field = "ear_pain_date" }
  duration_type = "event"

[[observation]]
  name = "ear_pain"
  phase = "study"
  is_present = { field = "ear_pain_v2", ref = "Y/N" }

  [observation.date]
    combinedType = "firstNonNull"
    fields = [{ field = "ear_pain_v2_date" }, { field = "signs_symps_date" }]

[[observation]]
  name = "fatigue_malaise"
  phase = "admission"
  is_present = { field = "fatigue", values = { 1 = true, 0 = false } }
  date = { ref = "admissionDateHierarchy" }
  start_date = { field = "fatigue_date" }
  duration_type = "event"

[[observation]]
  name = "fatigue_malaise"
  phase = "study"
  is_present = { field = "fatigue_v2", ref = "Y/N" }

  [observation.date]
    combinedType = "firstNonNull"
    fields = [{ field = "fatigue_v2_date" }, { field = "signs_symps_date" }]

[[observation]]
  name = "loss_of_smell_or_taste"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  duration_type = "event"

  [observation.start_date]
    combinedType = "min"
    fields = [{ field = "anosmia_date" }, { field = "ageusia_date" }]

  [observation.is_present]
    combinedType = "any"
    fields = [
      { field = "anosmia", description = "Anosmia (loss of smell)", ref = "Y/N" },
      { field = "ageusia", description = "Ageusia (loss of taste)", ref = "Y/N" },
    ]

[[observation]]
  name = "loss_of_smell_or_taste"
  phase = "study"

  [observation.date]
    combinedType = "min"
    fields = [
      { field = "anosmia_v2_date" },
      { field = "ageusia_v2_date" },
      { field = "signs_symps_date" },
    ]

  [observation.is_present]
    combinedType = "any"
    fields = [
      { field = "anosmia_v2", description = "Anosmia (loss of smell)", ref = "Y/N" },
      { field = "ageusia_v2", description = "Ageusia (loss of taste)", ref = "Y/N" },
    ]

[[observation]]
  name = "loss_of_smell"
  phase = "admission"
  is_present = { field = "anosmia", values = { 1 = true, 0 = false } }
  date = { ref = "admissionDateHierarchy" }
  start_date = { field = "anosmia_date" }
  duration_type = "event"

[[observation]]
  name = "loss_of_smell"
  phase = "study"
  is_present = { field = "anosmia_v2", ref = "Y/N" }

  [observation.date]
    combinedType = "firstNonNull"
    fields = [{ field = "anosmia_v2_date" }, { field = "signs_symps_date" }]

[[observation]]
  name = "loss_of_taste"
  phase = "admission"
  is_present = { field = "ageusia", values = { 1 = true, 0 = false } }
  date = { ref = "admissionDateHierarchy" }
  start_date = { field = "ageusia_date" }
  duration_type = "event"

[[observation]]
  name = "loss_of_taste"
  phase = "study"
  is_present = { field = "ageusia_v2", ref = "Y/N" }

  [observation.date]
    combinedType = "firstNonNull"
    fields = [{ field = "ageusia_v2_date" }, { field = "signs_symps_date" }]

[[observation]]
  name = "lower_chest_wall_indrawing"
  phase = "study"
  is_present = { field = "lowerchesdrawing", ref = "Y/N" }

  [observation.date]
    combinedType = "firstNonNull"
    fields = [
      { field = "lowerchesdrawing_date" },
      { field = "signs_symps_date" },
    ]

[[observation]]
  name = "muscle_aches"
  phase = "admission"
  is_present = { field = "myalagia", values = { 1 = true, 0 = false } }
  date = { ref = "admissionDateHierarchy" }
  start_date = { field = "myalagia_date" }
  duration_type = "event"

[[observation]]
  name = "muscle_aches"
  phase = "study"
  is_present = { field = "myalagia_v2", ref = "Y/N" }

  [observation.date]
    combinedType = "firstNonNull"
    fields = [{ field = "myalagia_v2_date" }, { field = "signs_symps_date" }]

[[observation]]
  name = "musculoskeletal_pain"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  duration_type = "event"

  [observation.start_date]
    combinedType = "min"
    fields = [{ field = "myalagia_date" }, { field = "jt_pain_date" }]

  [observation.is_present]
    combinedType = "any"
    excludeWhen = "none"
    fields = [
      { field = "myalagia", values = { 1 = true } },
      { field = "jt_pain", values = { 1 = true } },
    ]

[[observation]]
  name = "musculoskeletal_pain"
  phase = "study"

  [observation.date]
    combinedType = "min"
    fields = [
      { field = "myalagia_v2_date" },
      { field = "jt_pain_v2_date" },
      { field = "signs_symps_date" },
    ]

  [observation.is_present]
    combinedType = "any"
    excludeWhen = "none"
    fields = [
      { field = "myalagia_v2", values = { 1 = true } },
      { field = "jt_pain_v2", values = { 1 = true } },
    ]

[[observation]]
  name = "runny_nose"
  phase = "admission"
  is_present = { field = "rhinorrhea", values = { 1 = true, 0 = false } }
  date = { ref = "admissionDateHierarchy" }
  start_date = { field = "rhinorrhea_date" }
  duration_type = "event"

[[observation]]
  name = "runny_nose"
  phase = "study"
  is_present = { field = "rhinorrhea_v2", ref = "Y/N" }

  [observation.date]
    combinedType = "firstNonNull"
    fields = [{ field = "rhinorrhea_v2_date" }, { field = "signs_symps_date" }]

[[observation]]
  name = "seizures"
  phase = "admission"
  is_present = { field = "seizures", values = { 1 = true, 0 = false } }
  date = { ref = "admissionDateHierarchy" }
  start_date = { field = "seizures_date_s_and_s" }
  duration_type = "event"

[[observation]]
  name = "seizures"
  phase = "study"
  is_present = { field = "seizures_v2", ref = "Y/N" }

  [observation.date]
    combinedType = "firstNonNull"
    fields = [{ field = "seizures_v2_date" }, { field = "signs_symps_date" }]

[[observation]]
  name = "shortness_of_breath"
  phase = "admission"
  is_present = { field = "dyspnea", values = { 1 = true, 0 = false } }
  date = { ref = "admissionDateHierarchy" }
  start_date = { field = "dyspnea_date" }
  duration_type = "event"

[[observation]]
  name = "shortness_of_breath"
  phase = "study"
  is_present = { field = "dyspnea_v2", ref = "Y/N" }

  [observation.date]
    combinedType = "firstNonNull"
    fields = [{ field = "dyspnea_v2_date" }, { field = "signs_symps_date" }]

[[observation]]
  name = "skin_rash"
  phase = "admission"
  is_present = { field = "skin_rash", values = { 1 = true, 0 = false } }
  date = { ref = "admissionDateHierarchy" }
  start_date = { field = "skin_rash_date" }
  duration_type = "event"

[[observation]]
  name = "skin_rash"
  phase = "study"
  is_present = { field = "skin_rash_v2", ref = "Y/N" }

  [observation.date]
    combinedType = "firstNonNull"
    fields = [{ field = "skin_rash_v2_date" }, { field = "signs_symps_date" }]

[[observation]]
  name = "sore_throat"
  phase = "admission"
  is_present = { field = "sore_throat", values = { 1 = true, 0 = false } }
  date = { ref = "admissionDateHierarchy" }
  start_date = { field = "sore_throat_date" }
  duration_type = "event"

[[observation]]
  name = "sore_throat"
  phase = "study"
  is_present = { field = "sore_throat_v2", ref = "Y/N" }

  [observation.date]
    combinedType = "firstNonNull"
    fields = [{ field = "sore_throat_v2_date" }, { field = "signs_symps_date" }]

[[observation]]
  name = "vomiting_nausea"
  phase = "admission"
  is_present = { field = "nausea", values = { 1 = true, 0 = false } }
  date = { ref = "admissionDateHierarchy" }
  start_date = { field = "nausea_date" }
  duration_type = "event"

[[observation]]
  name = "wheezing"
  phase = "admission"
  is_present = { field = "wheezing", values = { 1 = true, 0 = false } }
  date = { ref = "admissionDateHierarchy" }
  start_date = { field = "wheezing_date" }
  duration_type = "event"

[[observation]]
  name = "wheezing"
  phase = "study"
  is_present = { field = "wheezing_v2", ref = "Y/N" }

  [observation.date]
    combinedType = "firstNonNull"
    fields = [{ field = "wheezing_v2_date" }, { field = "signs_symps_date" }]

[[observation]]
  name = "vomiting_nausea"
  phase = "study"
  is_present = { field = "nausea_v2", ref = "Y/N" }

  [observation.date]
    combinedType = "firstNonNull"
    fields = [{ field = "nausea_v2_date" }, { field = "signs_symps_date" }]

[[observation]]
  name = "bleeding_haemorrhage"
  phase = "study"
  is_present = { field = "bleeding_v2", ref = "Y/N" }

  [observation.date]
    combinedType = "firstNonNull"
    fields = [{ field = "bleeding_v2_date" }, { field = "signs_symps_date" }]

[[observation]]
  name = "bleeding_haemorrhage"
  phase = "admission"
  start_date = { field = "bleeding_date" }
  date = { ref = "admissionDateHierarchy" }
  duration_type = "event"
  is_present = { field = "bleeding", values = { 1 = true, 0 = false } }

[[observation]]
  name = "diastolic_blood_pressure_mmHg"
  phase = "admission"
  date = { field = "constantes_date_t", source_date = "%d/%m/%Y %H:%M" }
  value = { field = "diastol_iso", description = "Diastolic blood pressure (BP diastolic)" }

[[observation]]
  name = "pneumonia"
  phase = "study"
  is_present = { field = "clipneu", values = { 1 = true } }
  context = ['clinical diagnosis']

  [observation.date]
    combinedType = "firstNonNull"
    fields = [{ field = "clipneu_date" }, { field = "signs_symps_date" }]

[[observation]]
  name = "pneumonia"
  phase = "study"
  is_present = { field = "viral_pneumo", ref = "Y/N" }
  context = ['viral']

  [observation.date]
    combinedType = "firstNonNull"
    fields = [{ field = "viral_pneumo_date" }, { field = "comp_date" }]

[[observation]]
  name = "pneumonia"
  phase = "study"
  is_present = { field = "bact_pneumo", ref = "Y/N" }
  context = ['bacterial']

  [observation.date]
    combinedType = "firstNonNull"
    fields = [{ field = "bact_pneumo_date" }, { field = "comp_date" }]

[[observation]]
  name = "pneumonia"
  phase = "study"
  is_present = { field = "cop", ref = "Y/N" }
  context = ['cryptogenic organizing pneumonia (POC)']

  [observation.date]
    combinedType = "firstNonNull"
    fields = [{ field = "cop_date" }, { field = "comp_date" }]

[[observation]]
  name = "diastolic_blood_pressure_mmHg"
  phase = "study"
  date = { field = "vitals_date" }
  value = { field = "diastol", description = "Diastolic BP" }

[[observation]]
  name = "glasgow_coma_score"
  phase = "admission"
  date = { field = "constantes_date_t", source_date = "%d/%m/%Y %H:%M" }
  value = { field = "gcs_15", description = "Glasgow score" }

[[observation]]
  name = "glasgow_coma_score"
  phase = "study"
  date = { field = "vitals_date" }
  value = { field = "gcs", description = "Value Glasgow Score (SG/15)" }

[[observation]]
  name = "heart_rate_bpm"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  value = { field = "pulse_iso", description = "Heart Rate (HR)" }

[[observation]]
  name = "heart_rate_bpm"
  phase = "study"
  date = { field = "vitals_date" }
  value = { field = "hr", description = "Heart Rate Value (HR)" }

[[observation]]
  name = "other_symptom"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  start_date = { field = "other_1_date" }
  duration_type = "event"
  text = { field = "other_0", description = "Other symptom 1" }

[[observation]]
  name = "other_symptom"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  start_date = { field = "other_date" }
  duration_type = "event"
  text = { field = "other_1", description = "Other symptom 2" }

[[observation]]
  name = "other_symptom"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  start_date = { field = "other_2_date" }
  duration_type = "event"
  text = { field = "other_2", description = "Other symptom 3" }

[[observation]]
  name = "other_symptom"
  phase = "study"
  text = { field = "other_0_v2", description = "Other symptom 1" }

  [observation.date]
    combinedType = "firstNonNull"
    fields = [{ field = "other_0_v2_date" }, { field = "signs_symps_date" }]

[[observation]]
  name = "other_symptom"
  phase = "study"
  text = { field = "other_1_v2", description = "Other symptom 2" }

  [observation.date]
    combinedType = "firstNonNull"
    fields = [{ field = "other_1_v2_date" }, { field = "signs_symps_date" }]

[[observation]]
  name = "other_symptom"
  phase = "study"
  text = { field = "other_2_v2", description = "Other symptom 3" }

  [observation.date]
    combinedType = "firstNonNull"
    fields = [{ field = "other_2_v2_date" }, { field = "signs_symps_date" }]

[[observation]]
  name = "oxygen_saturation_percent"
  phase = "admission"
  date = { field = "constantes_date_t", source_date = "%d/%m/%Y %H:%M" }
  value = { field = "oxygen_saturation", description = "Oxygen saturation" }

  [observation.context]
    combinedType = "set"
    excludeWhen = "none"
    fields = [{ field = "on", values = { 1 = "on room air", 2 = "on oxygen" } }]

[[observation]]
  name = "oxygen_saturation_percent"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  value = { field = "oxy_vsorres", description = "Oxygen saturation" }

  [observation.context]
    combinedType = "set"
    excludeWhen = "none"
    fields = [
      { field = "oxy_vsorresu", values = { 1 = "on room air", 2 = "on oxygen" } },
    ]

[[observation]]
  name = "oxygen_saturation_percent"
  phase = "study"
  date = { field = "vitals_date" }
  value = { field = "o2_sate", description = "Oxygen saturation" }

  [observation.context]
    combinedType = "set"
    excludeWhen = "none"
    fields = [
      { field = "ox_type", values = { 1 = "without-oxygen", 2 = "with-oxygen" } },
    ]

[[observation]]
  name = "pH"
  phase = "study"
  date = { field = "icu_date" }
  value = { field = "ph" }

[[observation]]
  name = "respiratory_rate"
  phase = "study"
  date = { field = "vitals_date" }
  value = { field = "rr", description = "Respiratory rate (RR)" }

[[observation]]
  name = "respiratory_rate"
  phase = "admission"
  date = { field = "constantes_date_t", source_date = "%d/%m/%Y %H:%M" }
  value = { field = "rr_iso", description = "Respiratory rate (RR)" }

[[observation]]
  name = "systolic_blood_pressure_mmHg"
  phase = "admission"
  date = { field = "constantes_date_t", source_date = "%d/%m/%Y %H:%M" }
  value = { field = "systol_iso", description = "Systolic blood pressure (BP systolic)" }

[[observation]]
  name = "systolic_blood_pressure_mmHg"
  phase = "study"
  date = { field = "vitals_date" }
  value = { field = "systol", description = "Systolic BP" }

[[observation]]
  name = "temperature_celsius"
  phase = "admission"
  date = { field = "constantes_date_t", source_date = "%d/%m/%Y %H:%M" }
  value = { field = "temperature_iso", description = "Temperature" }

[[observation]]
  name = "temperature_celsius"
  phase = "study"
  date = { field = "vitals_date" }
  value = { field = "temperature", description = "Value Temperature" }

[[observation]]
  name = "fio2_percent"
  phase = "admission"
  date = { field = "constantes_date_t", source_date = "%d/%m/%Y %H:%M" }
  value = { field = "any_supplemental_oxygen_value", apply = { function = "Percentage" }, if.any = [
    { fio2_0_21_1_0_unit = 1 },                        # percentage
    { any_supplemental_oxygen_value = { "!=" = "" } },
  ] }

[[observation]]
  name = "oxygen_flow_rate"
  phase = "admission"
  date = { field = "constantes_date_t", source_date = "%d/%m/%Y %H:%M" }
  text = { field = "daily_oxygen_cmdose_1", values = { 1 = "1-5", 2 = "6-10", 3 = "11-15", 4 = ">15" } }
  [observation.context]
    combinedType = "set"
    excludeWhen = "none"
    fields = [
      { field = "daily_oxygen_cmtype_1", values = { 1 = "nasal cannula", 2 = "HFNC", 3 = "mask", 4 = "mask with reservoir", 5 = "CPAP/NIV mask", 6 = "Unknown" } },
    ]

[[observation]]
  name = "oxygen_flow_rate"
  phase = "admission"
  date = { field = "constantes_date_t", source_date = "%d/%m/%Y %H:%M" }
  value = { field = "any_supplemental_oxygen_value", if.any = [
    { fio2_0_21_1_0_unit = 2 },                        # L/min
    { any_supplemental_oxygen_value = { "!=" = "" } },
  ] }

[[observation]]
  name = "fio2_percent"
  phase = "study"
  date = { field = "icu_date" }
  value = { field = "fio2", apply = { function = "Percentage" } }

[[observation]]
  name = "pao2_mmHg"
  phase = "study"
  date = { field = "icu_date" }
  value = { field = "pa02", source_unit = { field = "pa02_type", values = { 1 = "kPa", 2 = "mmHg" } }, unit = "mmHg" }

  [observation.context]
    combinedType = "set"
    fields = [
      { field = "pa02_samp_type", values = { 1 = "arterial", 2 = "venous", 3 = "capillary" } },
    ]

[[observation]]
  name = "pco2_mmHg"
  phase = "study"
  date = { field = "icu_date" }
  value = { field = "pcc02", source_unit = { field = "pc02_type", values = { 1 = "kPa", 2 = "mmHg" } }, unit = "mmHg" }

  [observation.context]
    combinedType = "set"
    fields = [
      { field = "pcc02_source", values = { 1 = "same blood gas record as paO2" } },
    ]

[[observation]]
  name = "history_of_fever"
  phase = "admission"
  is_present = { field = "fever", values = { 1 = true } }
  date = { ref = "admissionDateHierarchy" }
  start_date = { field = "fever_date" }
  duration_type = "event"

[[observation]]
  name = "history_of_fever"
  phase = "study"
  is_present = { field = "fever_v2", ref = "Y/N" }

  [observation.date]
    combinedType = "firstNonNull"
    fields = [{ field = "fever_v2_date" }, { field = "signs_symps_date" }]

[[observation]]
  name = "joint_pain"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  start_date = { field = "jt_pain_date" }
  duration_type = "event"
  is_present = { field = "jt_pain", values = { 1 = true } }

[[observation]]
  name = "joint_pain"
  phase = "study"
  is_present = { field = "jt_pain_v2", ref = "Y/N" }

  [observation.date]
    combinedType = "firstNonNull"
    fields = [{ field = "jt_pain_v2_date" }, { field = "signs_symps_date" }]

[[observation]]
  name = "headache"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  start_date = { field = "headache_date" }
  duration_type = "event"
  is_present = { field = "headache", values = { 1 = true } }

[[observation]]
  name = "headache"
  phase = "study"
  is_present = { field = "headache_v2", ref = "Y/N" }

  [observation.date]
    combinedType = "firstNonNull"
    fields = [{ field = "headache_v2_date" }, { field = "signs_symps_date" }]

[[observation]]
  name = "skin_ulcers"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  start_date = { field = "skin_ulcers_date" }
  duration_type = "event"
  is_present = { field = "skin_ulcers", values = { 1 = true } }

[[observation]]
  name = "skin_ulcers"
  phase = "study"
  is_present = { field = "skin_ulcers_v2", ref = "Y/N" }

  [observation.date]
    combinedType = "firstNonNull"
    fields = [{ field = "skin_ulcers_v2_date" }, { field = "signs_symps_date" }]
