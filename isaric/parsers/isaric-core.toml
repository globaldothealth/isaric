#:schema ../../schemas/dev/parser.schema.json

[adtl]
  name = "isaric-core"
  description = "isaric-core"

  [adtl.tables.subject]
    kind = "groupBy"
    groupBy = "subject_id"
    aggregation = "lastNotNull"
    schema = "../../schemas/dev/subject.schema.json"

  [adtl.tables.visit]
    kind = "groupBy"
    groupBy = "subject_id"
    aggregation = "lastNotNull"
    schema = "../../schemas/dev/visit.schema.json"

  [adtl.tables.observation]
    kind = "oneToMany"
    schema = "../../schemas/dev/observation.schema.json"

    [adtl.tables.observation.common.visit_id]
      field = "subjid"
      sensitive = true

[adtl.defs."Y/N/NK".values]
  1 = true
  2 = false

[adtl.defs."ethnicityMap".values]
  1 = "white"
  2 = "arab"
  3 = "black"
  4 = "east asian"
  5 = "south asian"
  6 = "west asian"
  7 = "latin american"
  8 = "other"

[adtl.defs.admissionDateHierachy]
  combinedType = "firstNonNull"
  fields = [
    { field = "hostdat", description = "Admission date at this facility" },
    { field = "cestdat", description = "Onset date of first/earliest symptom" },
    { field = "dsstdat", description = "Date of enrolment" },
  ]

[adtl.defs.countryMap.values]
  1 = "AFG"
  2 = "ALB"
  3 = "DZA"
  4 = "AND"
  5 = "AGO"
  6 = "ATG"
  7 = "ARG"
  8 = "ARM"
  9 = "AUS"
  10 = "AUT"
  11 = "AZE"
  12 = "BHS"
  13 = "BHR"
  14 = "BGD"
  15 = "BRB"
  16 = "BLR"
  17 = "BEL"
  18 = "BLZ"
  19 = "BEN"
  20 = "BTN"
  21 = "BOL"
  22 = "BIH"
  23 = "BWA"
  24 = "BRA"
  25 = "BRN"
  26 = "BGR"
  27 = "BFA"
  28 = "BDI"
  29 = "KHM"
  30 = "CMR"
  31 = "CAN"
  32 = "CPV"
  33 = "CAF"
  34 = "TCD"
  35 = "CHL"
  36 = "CHN"
  37 = "COL"
  38 = "COM"
  39 = "COG"
  40 = "COD"
  41 = "CRI"
  42 = "HRV"
  43 = "CUB"
  44 = "CYP"
  45 = "CZE"
  46 = "DNK"
  47 = "DJI"
  48 = "DMA"
  49 = "DOM"
  50 = "TLS"
  51 = "ECU"
  52 = "EGY"
  53 = "SLV"
  54 = "GNQ"
  55 = "ERI"
  56 = "EST"
  57 = "ETH"
  58 = "FJI"
  59 = "FIN"
  60 = "FRA"
  61 = "GAB"
  62 = "GMB"
  63 = "GEO"
  64 = "DEU"
  65 = "GHA"
  66 = "GRC"
  67 = "GRD"
  68 = "GTM"
  69 = "GIN"
  70 = "GNB"
  71 = "GUY"
  72 = "HTI"
  73 = "HND"
  74 = "HUN"
  75 = "ISL"
  76 = "IND"
  77 = "IDN"
  78 = "IRN"
  79 = "IRQ"
  80 = "IRL"
  81 = "ISR"
  82 = "ITA"
  83 = "CIV"
  84 = "JAM"
  85 = "JPN"
  86 = "JOR"
  87 = "KAZ"
  88 = "KEN"
  89 = "KIR"
  90 = "PRK"
  91 = "KOR"
  92 = "XXK"
  93 = "KWT"
  94 = "KGZ"
  95 = "LAO"
  96 = "LVA"
  97 = "LBN"
  98 = "LSO"
  99 = "LBR"
  100 = "LBY"
  101 = "LIE"
  102 = "LTU"
  103 = "LUX"
  104 = "MKD"
  105 = "MDG"
  106 = "MWI"
  107 = "MYS"
  108 = "MDV"
  109 = "MLI"
  110 = "MLT"
  111 = "MHL"
  112 = "MRT"
  113 = "MUS"
  114 = "MEX"
  115 = "FSM"
  116 = "MDA"
  117 = "MCO"
  118 = "MNG"
  119 = "MNE"
  120 = "MAR"
  121 = "MOZ"
  122 = "MMR"
  123 = "NAM"
  124 = "NRU"
  125 = "NPL"
  126 = "NLD"
  127 = "NZL"
  128 = "NIC"
  129 = "NER"
  130 = "NGA"
  131 = "NOR"
  132 = "OMN"
  133 = "PAK"
  134 = "PLW"
  135 = "PAN"
  136 = "PNG"
  137 = "PRY"
  138 = "PER"
  139 = "PHL"
  140 = "POL"
  141 = "PRT"
  142 = "QAT"
  143 = "ROU"
  144 = "RUS"
  145 = "RWA"
  146 = "KNA"
  147 = "LCA"
  148 = "VCT"
  149 = "WSM"
  150 = "SMR"
  151 = "STP"
  152 = "SAU"
  153 = "SEN"
  154 = "SRB"
  155 = "SYC"
  156 = "SLE"
  157 = "SGP"
  158 = "SVK"
  159 = "SVN"
  160 = "SLB"
  161 = "SOM"
  162 = "ZAF"
  163 = "SSD"
  164 = "ESP"
  165 = "LKA"
  166 = "SDN"
  167 = "SUR"
  168 = "SWZ"
  169 = "SWE"
  170 = "CHE"
  171 = "SYR"
  172 = "TWN"
  173 = "TJK"
  174 = "TZA"
  175 = "THA"
  176 = "TGO"
  177 = "TON"
  178 = "TTO"
  179 = "TUN"
  180 = "TUR"
  181 = "TKM"
  182 = "TUV"
  183 = "UGA"
  184 = "UKR"
  185 = "ARE"
  186 = "GBR"
  187 = "USA"
  188 = "URY"
  189 = "UZB"
  190 = "VUT"
  191 = "VAT"
  192 = "VEN"
  193 = "VNM"
  194 = "YEM"
  195 = "ZMB"
  196 = "ZWE"

[subject]
  pathogen = "COVID-19"
  country_iso3 = { field = "country", ref = "countryMap" }

  [subject.subject_id]
    field = "subjid"
    sensitive = true

  [subject.admission_date]
    ref = "admissionDateHierachy"

  [subject.enrolment_date]
    field = "dsstdat"
    description = "Date of enrolment into the study or for in-patients is the date that COVID-19 was first assessed a suspected or confirmed by a clinician."

  [subject.age]
    field = "age_estimateyears"
    unit = "years"
    source_unit = { field = "age_estimateyearsu", values = { 1 = "months", 2 = "years", 3 = "days" } }

  [subject.sex_at_birth]
    combinedType = "firstNonNull"
    excludeWhen = "none"
    fields = [
      { field = "sex", values = { 1 = "male", 2 = "female" } },
      { field = "flw_sex_at_birth", values = { 1 = "male", 2 = "female", 3 = "non_binary" } },
      { field = "flw2_sex_at_birth", values = { 1 = "male", 2 = "female", 3 = "non_binary" } },
    ]

  [subject.ethnicity]
    combinedType = "set"
    excludeWhen = "none"
    fields = [
      { field = "ethnic___1", values = { 1 = "arab" } },
      { field = "ethnic___2", values = { 1 = "black" } },
      { field = "ethnic___3", values = { 1 = "east asian" } },
      { field = "ethnic___4", values = { 1 = "south asian" } },
      { field = "ethnic___5", values = { 1 = "west asian" } },
      { field = "ethnic___6", values = { 1 = "latin american" } },
      { field = "ethnic___7", values = { 1 = "white" } },
      { field = "ethnic___8", values = { 1 = "Aboriginal/First Nations" } },
      { field = "ethnic___9", values = { 1 = "Other" } },
      { field = "flw_ethnicity", ref = "ethnicityMap" },
      { field = "flw2_ethnicity", ref = "ethnicityMap" },
      { field = "flw_ethnicity_oth" },
      { field = "flw2_ethnicity_oth" },
    ]

  [subject.has_asplenia]
    field = "asplenia_mhyn"
    description = "Please include any of splenectomy, non-functional spleen, and congenital asplenia."
    ref = "Y/N/NK"

  [subject.has_asthma]
    field = "asthma_mhyn"
    description = "Clinician-diagnosed asthma"
    ref = "Y/N/NK"

  [subject.has_chronic_cardiac_disease]
    combinedType = "any"

    [[subject.has_chronic_cardiac_disease.fields]]
      field = "chroniccard_mhyn"
      description = "<acronym title=\"Include any of coronary artery disease, heart failure, congenital heart disease, cardiomyopathy, rheumatic heart disease.\">Chronic cardiac disease <i>(not hypertension)</i></acronym>"
      ref = "Y/N/NK"

    [[subject.has_chronic_cardiac_disease.fields]]
      field = "chronicpul_mhyn"
      description = "<acronym title=\"Include any of chronic obstructive pulmonary disease (chronic bronchitis, chronic obstructive pulmonary disease (COPD), emphysema), cystic fibrosis, bronchiectasis, interstitial lung disease, pre-existing requirement for long term oxygen therapy. Do not include asthma.\">Chronic pulmonary disease <i>(not asthma)</i></acronym>"
      ref = "Y/N/NK"

[subject.has_chronic_kidney_disease]
  field = "renal_mhyn"
  description = "<acronym title=\"Please include any of clinician-diagnosed chronic kidney disease, chronic estimated glomerular filtration rate < 60mL/min/1.73m2, history of kidney transplantation\">Chronic kidney disease</acronym>"
  ref = "Y/N/NK"

[subject.has_dementia]
  field = "dementia_mhyn"
  description = "This is defined a clinical diagnosis of dementia"
  ref = "Y/N/NK"

[subject.has_diabetes]
  combinedType = "any"
  excludeWhen = "none"
  fields = [
    { field = "diabetes_mhyn", description = "4b.13. Diabetes without complication", ref = "Y/N/NK" },
    { field = "diabetiscomp_mhyn", description = "4b.12. Diabetes with complication", ref = "Y/N/NK" },
    { field = "diabetes_mhyn_2", description = "Type 1 or Type 2 diabetes mellitus requiring oral or subcutaneous treatment.", apply = { function = "isNotNull" } },
  ]

[subject.diabetes_type]
  field = "diabetes_mhyn_2"
  description = "Type 1 or Type 2 diabetes mellitus requiring oral or subcutaneous treatment. Please indicate whether type 1 or type 2."
  values = { 1 = "type-1", 4 = "type-2", 5 = "gestational" }

[subject.has_hiv]
  combinedType = "any"
  excludeWhen = "none"
  fields = [
    { field = "aidshiv_mhyn", description = "4b.10. AIDS/HIV", ref = "Y/N/NK" },
    { field = "aidshiv_mhyn_2", description = "History of laboratory-confirmed HIV infection", values = { 1 = true, 4 = true, 2 = false } },
  ]

[subject.has_hiv_art]
  field = "aidshiv_mhyn_2"
  values = { 1 = true, 2 = false, 4 = false }

[subject.has_hypertension]
  field = "hypertension_mhyn"
  description = "Elevated arterial blood pressure diagnosed clinically, >140mmHg systolic or >90mmHg diastolic."
  ref = "Y/N/NK"

[subject.has_liver_disease]
  combinedType = "any"

  [[subject.has_liver_disease.fields]]
    field = "mildliv_mhyn"
    description = "This is defined a cirrhosis without portal hypertension or chronic hepatitis"
    ref = "Y/N/NK"

  [[subject.has_liver_disease.fields]]
    field = "modliver_mhyn"
    description = "This is defined a cirrhosis with portal hypertension, with or without bleeding or a history of variceal bleeding"
    ref = "Y/N/NK"

[subject.has_malignant_neoplasm]
  field = "malignantneo_mhyn"
  description = "Current solid organ or haematological malignancy"
  ref = "Y/N/NK"

[subject.has_malnutrition]
  field = "malnutrition_mhyn"
  description = "Any clinically identified deficiency in intake, either of total energy or of specific nutrient that led to a dietetic intervention or referral prior to the onset of COVID-19 symptoms."
  ref = "Y/N/NK"

[subject.has_obesity]
  field = "obesity_mhyn"
  description = "This refers to patient for whom an attending clinician ha assessed them to be obese - ideally but not necessarily with an objective measurement of obesity, such a calculation of the body mass index (BMI of 30 or more) or measurement of abdominal girth."
  ref = "Y/N/NK"

[subject.has_rheumatologic_disorder]
  field = "rheumatology_mhyr"
  description = "This is defined a an inflammatory and degenerative disease of connective tissue structures. It includes chronic arthropathy and arthritis, connective tissue disorder and vasculitides."
  ref = "Y/N/NK"

[subject.has_smoking]
  field = "smoking_mhyn"
  description = "Smoking at least one cigarette, cigar, pipe or equivalent per day before the onset of the current illness."

  [subject.has_smoking.values]
    1 = "yes"
    2 = "never"
    3 = "former"

[subject.has_tuberculosis]
  field = "tb_mhyn"
  description = "Patients currently receiving treatment for tuberculosis."
  ref = "Y/N/NK"

[subject.icu_admitted]
  combinedType = "any"

  [[subject.icu_admitted.fields]]
    field = "flw2_icu"
    description = "If ever admitted to hospital, were you admitted to intensive care (ICU/ITU)?"

    [subject.icu_admitted.fields.values]
      1 = true
      0 = false

  [[subject.icu_admitted.fields]]
    field = "flw_icu"
    description = "If ever admitted to hospital, were you admitted to intensive care (ICU/ITU)?"

    [subject.icu_admitted.fields.values]
      1 = true
      0 = false
      2 = "not sure"

  [[subject.icu_admitted.fields]]
    field = "ccm_b_icu_hodat"
    description = "<acronym title=\"Date admitted to critical care ward\">ICU ADMISSION DATE</acronym>"

  [[subject.icu_admitted.fields]]
    field = "icu_hostdat"
    description = "Date of ICU admission:"

[subject.pregnancy]
  field = "pregyn_rptestcd"
  description = "Pregnant?"
  values = { 1 = true, 0 = false }

[subject.pregnancy_birth_weight_kg]
  combinedType = "firstNonNull"
  fields = [
    { field = "apvs_weight", description = "Birth weight", source_unit = { field = "apvs_weightu", values = { 1 = "kg", 2 = "lbs" } }, unit = "kg" },
    { field = "apvs_weight_vsorres", description = "4.8 Birth weight", source_unit = "grams", unit = "kg" },
  ]

[subject.pregnancy_date_of_delivery]
  combinedType = "firstNonNull"
  fields = [
    { field = "dlvrdtc_rptestcd", description = "Delivery date:" },
    { field = "edlvrdtc_rporres", description = "1.1 Expected estimated date of delivery:" },
    { field = "dlvr_cestdat", description = "Delivery during admission? If yes, date:" },
  ]

[subject.pregnancy_gestational_assessment_weeks]
  combinedType = "firstNonNull"
  fields = [
    { field = "egestage_rptestcd", description = "If YES: Gestational week assessment:" },
    { field = "apsc_egestage_scorres", description = "4.6 Gestational age, weeks:" },
  ]

[subject.pregnancy_gestational_outcome]
  combinedType = "firstNonNull"
  excludeWhen = "none"
  fields = [
    { field = "apsc_gestout", description = "Gestational outcome", values = { 1 = "term_birth", 2 = "preterm_birth" } },
    { field = "pregout_rptestcd", description = "Pregnancy Outcome", values = { 1 = "term_birth", 2 = "preterm_birth" } },
  ]

[subject.pregnancy_outcome]
  field = "pregout_rptestcd"
  description = "Pregnancy Outcome"
  values = { 1 = "live birth", 2 = "still birth" }

[subject.pregnancy_post_partum]
  field = "postpart_rptestcd"
  description = "Defined a within six week of delivery."
  values = { 1 = true, 0 = false }

[subject.pregnancy_whether_breastfed]
  combinedType = "any"
  excludeWhen = "none"
  fields = [
    { field = "apsc_brfed", description = "Breastfed?", values = { 1 = true, 2 = true, 0 = false } },
    { field = "apsc_brfedind", description = "1.7.3 Breastfed", ref = "Y/N/NK" },
    { field = "apsc_brfedindy", description = "If YES", values = { 1 = true, 2 = true } },
  ]

[subject.works_healthcare]
  field = "healthwork_erterm"
  description = "Employed a a healthcare worker?"
  ref = "Y/N/NK"

[subject.works_microbiology_lab]
  field = "labwork_erterm"
  description = "Employed in a microbiology laboratory?"
  ref = "Y/N/NK"

[subject.has_immunosuppression_therapy_treatment]
  field = "pre_nonoralsteroid_cmoccur"
  description = "Other immunosuppressant agents (not oral steroids)"
  ref = "Y/N/NK"

[subject.has_comorbidity_other]
  combinedType = "set"
  excludeWhen = "none"
  fields = [
    { field = "otherrisktext", description = "Other relevant risk factor(s)" },
  ]

[subject.has_died]
  combinedType = "any"
  excludeWhen = "none"
  fields = [
    { field = "dsterm", values = { 1 = false, 2 = false, 3 = false, 4 = true, 5 = false } },
    { field = "flw_deceased_yn", values = { 1 = true, 0 = false } },
    { field = "flw2_deceased_yn", values = { 1 = true, 0 = false } },
  ]

[subject.date_death]
  combinedType = "firstNonNull"
  fields = [
    { field = "dsstdtc", if = { dsterm = 4 } },
    { field = "flw_date_death", description = "If known, date of death" },
    { field = "flw2_date_death", description = "If known, date of death" },
  ]

[visit]
  country_iso3 = { field = "country", ref = "countryMap" }

  [visit.subject_id]
    field = "subjid"
    sensitive = true

  [visit.visit_id]
    field = "subjid"
    sensitive = true

  [visit.start_date]
    combinedType = "firstNonNull"
    fields = [
      { field = "hostdat", description = "Admission date at this facility" },
      { field = "cestdat", description = "Onset date of first/earliest symptom" },
      { field = "dsstdat", description = "Date of enrolment" },
    ]

  [visit.icu_admission]
    combinedType = "any"

    [[visit.icu_admission.fields]]
      field = "icu_hostdat"
      description = "Date of ICU admission:"

    [[visit.icu_admission.fields]]
      field = "flw2_icu"
      description = "If ever admitted to hospital, were you admitted to intensive care (ICU/ITU)?"

      [visit.icu_admission.fields.values]
        1 = true
        0 = false

    [[visit.icu_admission.fields]]
      field = "flw_icu"
      description = "If ever admitted to hospital, were you admitted to intensive care (ICU/ITU)?"

      [visit.icu_admission.fields.values]
        1 = true
        0 = false
        2 = "not sure"

[visit.icu_admission_dates]
  combinedType = "set"
  excludeWhen = "none"

  [[visit.icu_admission_dates.fields]]
    field = "icu_hostdat"
    description = "Date of ICU admission:"

  [[visit.icu_admission_dates.fields]]
    field = "ccm_b_icu_hodat"
    description = "Date admitted to critical care ward"

[visit.treatment_antibiotics]
  combinedType = "any"
  excludeWhen = "none"
  fields = [
    { field = "antibiotic_cmyn", ref = "Y/N/NK" },
    { field = "antibiotic_cmtrt_1", apply = { function = "isNotNull" } },
    { field = "antibiotic_cmtrt_2", apply = { function = "isNotNull" } },
    { field = "antibiotic_cmtrt_3", apply = { function = "isNotNull" } },
    { field = "antibiotic_cmtrt_4", apply = { function = "isNotNull" } },
    { field = "antibiotic_cmtrt_5", apply = { function = "isNotNull" } },
    { field = "antibiotic_cmtrt_6", apply = { function = "isNotNull" } },
    { field = "antibiotic_cmtrt_7", apply = { function = "isNotNull" } },
    { field = "antibiotic_cmtrt_8", apply = { function = "isNotNull" } },
    { field = "antibiotic_cmtrt_9", apply = { function = "isNotNull" } },
  ]

[visit.treatment_antibiotics_type]
  combinedType = "set"
  excludeWhen = "none"
  fields = [
    { field = "antibiotic_cmtrt_1" },
    { field = "antibiotic_cmtrt_2" },
    { field = "antibiotic_cmtrt_3" },
    { field = "antibiotic_cmtrt_4" },
    { field = "antibiotic_cmtrt_5" },
    { field = "antibiotic_cmtrt_6" },
    { field = "antibiotic_cmtrt_7" },
    { field = "antibiotic_cmtrt_8" },
    { field = "antibiotic_cmtrt_9" },
  ]

[visit.treatment_anticoagulation]
  combinedType = "any"
  excludeWhen = "none"
  fields = [
    { field = "anticoag_cmyn", description = "Anticoagulation?", ref = "Y/N/NK" },
    { field = "ccm_b_heparint_cmyn", description = "Heparin for anticoagulation?", ref = "Y/N/NK" },
  ]

[visit.treatment_antifungal_agent]
  field = "antifung_cmyn"
  description = "Antifungal agent refers to any agent(s) prescribed specifically to treat systemic or topical infection caused by fungi."
  ref = "Y/N/NK"

[visit.treatment_antivirals]
  combinedType = "any"
  # excludeWhen = "none"
  fields = [
    { field = "antiviral_cmyn", ref = "Y/N/NK" },
    { field = "antiviral_cmtrt___1", values = { 1 = true } },
    { field = "antiviral_cmtrt___2", values = { 1 = true } },
    { field = "antiviral_cmtrt___3", values = { 1 = true } },
    { field = "antiviral_cmtrt___4", values = { 1 = true } },
    { field = "antiviral_cmtrt___5", values = { 1 = true } },
    { field = "antiviral_cmtrt___6", values = { 1 = true } },
    { field = "antiviral_cmtrt___7", values = { 1 = true } },
    { field = "antiviral_cmtrt___8", values = { 1 = true } },
    { field = "antiviral_cmtrt___9", values = { 1 = true } },
    { field = "antiviral_cmtrt___10", values = { 1 = true } },
    { field = "antiviral_cmtrt___11", values = { 1 = true } },
    { field = "ribar_antiviral_cmdat", apply = { function = "textIfNotNull", params = [
      'true',
    ] } },
    { field = "lopin_antiviral_cmdat", apply = { function = "textIfNotNull", params = [
      'true',
    ] } },
    { field = "remde_antiviral_cmdat", apply = { function = "textIfNotNull", params = [
      'true',
    ] } },
    { field = "intera_antiviral_cmdat", apply = { function = "textIfNotNull", params = [
      'true',
    ] } },
    { field = "interb_antiviral_cmdat", apply = { function = "textIfNotNull", params = [
      'true',
    ] } },
    { field = "chlor_antiviral_cmdat", apply = { function = "textIfNotNull", params = [
      'true',
    ] } },
    { field = "il6_antiviral_cmdat", apply = { function = "textIfNotNull", params = [
      'true',
    ] } },
    { field = "cplasma_antiviral_cmdat", apply = { function = "textIfNotNull", params = [
      'true',
    ] } },
    { field = "antiflu_antiviral_cmdat", apply = { function = "textIfNotNull", params = [
      'true',
    ] } },
    { field = "antiviral_cmtype", apply = { function = "textIfNotNull", params = [
      'true',
    ] } },
  ]

[visit.treatment_antiviral_type]
  combinedType = "set"
  excludeWhen = "none"
  fields = [
    { field = "antiviral_cmtrt___1", values = { 1 = "Ribavirin" } },
    { field = "antiviral_cmtrt___2", values = { 1 = "Lopinavir/Ritonvir" } },
    { field = "antiviral_cmtrt___3", values = { 1 = "Interferon alpha" } },
    { field = "antiviral_cmtrt___4", values = { 1 = "Interferon beta" } },
    { field = "antiviral_cmtrt___5", values = { 1 = "Neuraminidase inhibitor" } },
    { field = "antiviral_cmtrt___7", values = { 1 = "Remdesivir" } },
    { field = "antiviral_cmtrt___8", values = { 1 = "Chloroquine/Hydroxychloroquine" } },
    { field = "antiviral_cmtrt___9", values = { 1 = "IL6 inhibitor" } },
    { field = "antiviral_cmtrt___10", values = { 1 = "Convalescent plasma" } },
    { field = "antiviral_cmtrt___11", values = { 1 = "Anti-influenza antiviral" } },
    { field = "ribar_antiviral_cmdat", apply = { function = "textIfNotNull", params = [
      "Ribavirin",
    ] } },
    { field = "lopin_antiviral_cmdat", apply = { function = "textIfNotNull", params = [
      "Lopinavir/Ritonvir",
    ] } },
    { field = "remde_antiviral_cmdat", apply = { function = "textIfNotNull", params = [
      "Remdesivir",
    ] } },
    { field = "intera_antiviral_cmdat", apply = { function = "textIfNotNull", params = [
      "Interferon alpha",
    ] } },
    { field = "interb_antiviral_cmdat", apply = { function = "textIfNotNull", params = [
      "Interferon beta",
    ] } },
    { field = "chlor_antiviral_cmdat", apply = { function = "textIfNotNull", params = [
      "Chloroquine/Hydroxychloroquine",
    ] } },
    { field = "il6_antiviral_cmdat", apply = { function = "textIfNotNull", params = [
      "IL6 inhibitor",
    ] } },
    { field = "cplasma_antiviral_cmdat", apply = { function = "textIfNotNull", params = [
      "Convalescent plasma",
    ] } },
    { field = "antiflu_antiviral_cmdat", apply = { function = "textIfNotNull", params = [
      "Anti-influenza antiviral",
    ] } },
  ]

[visit.treatment_antiviral_type_other]
  combinedType = "set"
  excludeWhen = "none"
  fields = [{ field = "antiviral_cmtype" }]

[visit.treatment_corticosteroid]
  combinedType = "any"
  excludeWhen = "none"
  fields = [
    { field = "corticost_cmyn", ref = "Y/N/NK" },                         # check - true should override the falses, not just the empty values.
    { field = "dexameth_cmyn", ref = "Y/N/NK" },
    { field = "steroid_other_cmyn", apply = { function = "isNotNull" } },
  ]

[visit.treatment_corticosteroid_type]
  combinedType = "set"
  excludeWhen = "none"
  fields = [
    { field = "dexameth_cmyn", values = { 1 = "Dexamethasone" } },
    { field = "steroid_other_cmtrt___1", values = { 1 = "Prednisolone" } },
    { field = "steroid_other_cmtrt___2", values = { 1 = "Hydrocortisone" } },
    { field = "steroid_other_cmtrt___3", values = { 1 = "Methylprednisolone" } },
  ]

[visit.treatment_dialysis]
  combinedType = "any"
  fields = [
    { field = "renal_proccur", description = "7.3.3. Dialysis / renal treatment?", ref = "Y/N/NK" },
    { field = "ccm_b_renal_prtrt", description = "Dialysis/Hemofiltration?", ref = "Y/N/NK" },
  ]

[visit.treatment_ecmo]
  combinedType = "any"

  [[visit.treatment_ecmo.fields]]
    field = "extracorp_prtrt"
    description = "Extracorporeal support (ECMO)?"
    ref = "Y/N/NK"

  [[visit.treatment_ecmo.fields]]
    field = "daily_ecmo_prtrt"
    description = "Extra corporeal life support (ECLS / ECMO)?"
    ref = "Y/N/NK"

[visit.treatment_experimental_agent]
  field = "othertx_cmyn"
  description = "Other treatment administered for COVID-19 including experimental or compassionate use?"
  ref = "Y/N/NK"

  # [visit.treatment_experimental_agent_type]
  #   combinedType = "set"
  #   excludeWhen = "none"
  #   fields = [
  #     { field = "othertx_cmtrt_1" },
  #     { field = "othertx_cmtrt_2" },
  #     { field = "othertx_cmtrt_3" },
  #   ]

[visit.treatment_oxygen_therapy]
  combinedType = "any"

  [[visit.treatment_oxygen_therapy.fields]]
    field = "daily_nasaloxy_cmtrt"
    description = "High-flow nasal canula oxygen therapy?"
    ref = "Y/N/NK"

  [[visit.treatment_oxygen_therapy.fields]]
    field = "oxygen_cmdur"
    description = "<i>Any Oxygen therapy</i> - if YES, total duration:"

  [[visit.treatment_oxygen_therapy.fields]]
    field = "oxygen_proccur"
    description = "<acronym title=\"Includes, NIV or home ventilation (respiratory support/treatment).\">Post discharge treatment: Oxygen therapy?</acronym>"
    ref = "Y/N/NK"

  [[visit.treatment_oxygen_therapy.fields]]
    field = "ccm_b_hhfnc_prtrt"
    description = "Humidified high flow nasal cannula (HHFNC)?"
    ref = "Y/N/NK"

  [[visit.treatment_oxygen_therapy.fields]]
    field = "nasal_highflow_proccur"
    description = "High flow nasal oxygen"
    ref = "Y/N/NK"

  [[visit.treatment_oxygen_therapy.fields]]
    field = "daily_nasaloxy_cmtrt"
    description = "High-flow nasal canula oxygen therapy?"
    ref = "Y/N/NK"

[visit.treatment_high_flow_nasal_cannula]
  combinedType = "any"
  fields = [
    { field = "ccm_b_hhfnc_prtrt", description = "Humidified high flow nasal cannula (HHFNC)?", ref = "Y/N/NK" },
    { field = "nasal_highflow_proccur", description = "High flow nasal oxygen", ref = "Y/N/NK" },
    { field = "daily_nasaloxy_cmtrt", description = "High-flow nasal canula oxygen therapy?", ref = "Y/N/NK" },
  ]

[visit.treatment_invasive_ventilation]
  combinedType = "any"
  fields = [
    { field = "invasive_proccur", ref = "Y/N/NK" },
    { field = "daily_invasive_prtrt", ref = "Y/N/NK" },
    { field = "ccm_b_invasive_prtrt", ref = "Y/N/NK" },
  ]

[visit.treatment_noninvasive_ventilation]
  combinedType = "any"
  fields = [
    { field = "noninvasive_proccur", ref = "Y/N/NK" },
    { field = "daily_noninvasive_prtrt", ref = "Y/N/NK" },
    { field = "ccm_b_noninvasive_prtrt", ref = "Y/N/NK" },
  ]

[visit.treatment_indication_anticoagulation]
  field = "anticoag_cmyn"
  description = "Anticoagulation?"
  ref = "Y/N/NK"

[visit.treatment_inhaled_nitric_oxide]
  combinedType = "any"
  fields = [
    { field = "inhalednit_cmtrt", description = "Inhaled Nitric Oxide?", ref = "Y/N/NK" },
    { field = "daily_nitritc_cmtrt", description = "Inhaled Nitric Oxide ?", ref = "Y/N/NK" },
  ]

[visit.treatment_inotropes_vasopressors]
  combinedType = "any"
  description = "A vasopressor is a pharmaceutical agent that cause vasoconstriction."
  fields = [
    { field = "inotrop_cmtrt", ref = "Y/N/NK" },
    { field = "daily_inotrope_cmyn", ref = "Y/N/NK" },
  ]

[visit.treatment_neuromuscular_blocking_agents]
  field = "daily_neuro_cmtrt"
  description = "Neuromuscular blocking agents?"
  ref = "Y/N/NK"

[visit.treatment_other]
  combinedType = "set"
  excludeWhen = "none"
  fields = [
    { field = "othertx_cmtrt_1", description = "<i>Other Agent 1</i> - Agent:" },
    { field = "othertx_cmtrt_3", description = "<i>Other Agent 3</i> - Agent:" },
    { field = "othertx_cmtrt_2", description = "<i>Other Agent 2</i> - Agent:" },
  ]

[visit.treatment_prone_position]
  combinedType = "any"

  [[visit.treatment_prone_position.fields]]
    field = "pronevent_prtrt"
    description = "Prone ventilation refers to ventilation with the patient lying in the prone position. If the patient received prone ventilation at any time during their hospital stay, please tick YES and indicate the total duration in days."
    ref = "Y/N/NK"

  [[visit.treatment_prone_position.fields]]
    field = "daily_prone_cmtrt"
    description = "Prone ventilation refers to ventilation with the patient lying in the prone position. If the patient received prone ventilation at any time during their hospital stay, please tick YES and indicate the total duration in days."
    ref = "Y/N/NK"

  [[visit.treatment_prone_position.fields]]
    field = "ccm_b_pronevent_prtrt"
    description = "Prone Positioning?"
    ref = "Y/N/NK"

    # [[visit.treatment_prone_position.fields]]
    #   field = "daily_prone_cmtype"
    #   description = "<i>Prone Positioning</i>, if YES"

    #   [visit.treatment_prone_position.fields.values]
    #     1 = "during invasive ventilation"
    #     2 = "whilst self-ventilating"

[visit.date_outcome]
  field = "dsstdtc"
  description = "Please state the date for the outcome listed above."

[visit.outcome]
  field = "dsterm"
  description = "Please state the date for the outcome listed above."
  values = { 1 = "discharged", 2 = "hospitalised", 3 = "transferred", 4 = "death", 5 = "palliative discharge" }

  ## OBSERVATION

[[observation]]
  name = "abdominal_pain"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  is_present = { field = "abdopain_ceoccur_v2", values = { 1 = true, 2 = false } }

[[observation]]
  name = "abdominal_pain"
  phase = "followup"
  date = { field = "flw_survey_date" }
  is_present = { field = "flw_stomach_pain", values = { 1 = true, 0 = false } }

[[observation]]
  name = "abdominal_pain"
  phase = "followup"
  date = { field = "flw2_survey_date" }
  is_present = { field = "flw2_stomach", values = { 1 = true, 0 = false } }

  # [[observation]]
  #   name = "abdominal_pain"
  #   phase = "followup"

  #   [observation.date]
  #     ref = "followupDateHierarchy"

  #   [observation.if.flw_eq5d_pd_5l_uk_eng]
  #     "!=" = ""

  # [observation.is_present]
  #   field = "flw_eq5d_pd_5l_uk_eng"
  #   description = "PAIN / DISCOMFORT"

  #   [observation.is_present.values]
  #     1 = "i have no pain or discomfort"
  #     2 = "i have slight pain or discomfort"
  #     3 = "i have moderate pain or discomfort"
  #     4 = "i have severe pain or discomfort"
  #     5 = "i have extreme pain or discomfort"

[[observation]]
  name = "altered_consciousness_confusion"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  is_present = { field = "confusion_ceoccur_v2", description = "Altered consciousness / confusion", ref = "Y/N/NK" }

[[observation]]
  name = "confusion"
  phase = "followup"
  date = { field = "flw_survey_date" }
  is_present = { field = "flw_confusion", description = "Confusion/lack of concentration", values = { 1 = true, 0 = false } }

[[observation]]
  name = "confusion"
  phase = "followup"
  date = { field = "flw2_survey_date" }
  is_present = { field = "flw2_confusion", description = "Confusion/lack of concentration", values = { 1 = true, 0 = false } }

[[observation]]
  name = "anorexia"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  is_present = { field = "anorexia_ceoccur_v2", description = "Anorexia", ref = "Y/N/NK" }

[[observation]]
  name = "avpu"
  phase = "study"
  date = { field = "daily_dsstdat" }
  text = { field = "avpu_vsorres", values = { 1 = "alert", 2 = "verbal", 3 = "pain", 4 = "unresponsive" } }

[[observation]]
  name = "base_excess"
  phase = "study"
  date = { field = "daily_dsstdat" }
  value = { field = "daily_baseex_lborres", apply = { function = "getFloat" } }

[[observation]]
  name = "bleeding_haemorrhage"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  is_present = { field = "bleed_ceoccur_v2", description = "Bleeding (Haemorrhage)", ref = "Y/N/NK" }

  [observation.context]
    combinedType = "set"
    excludeWhen = "none"
    fields = [{ field = "bleed_cetermy_v2", description = "specify site" }]

[[observation]]
  name = "bleeding"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  is_present = { field = "bleed_ceterm_v2", description = "Bleeding (others)", ref = "Y/N/NK" }

[[observation]]
  name = "bleeding"
  phase = "followup"
  date = { field = "flw_survey_date" }
  is_present = { field = "flw_bleeding", description = "Bleeding", values = { 1 = true, 0 = false } }

  [observation.context]
    combinedType = "set"
    excludeWhen = "none"
    fields = [
      { field = "flw_bleeding_site", description = "please specify bleeding site" },
    ]

[[observation]]
  name = "chest_pain"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  is_present = { field = "chestpain_ceoccur_v2", description = "Chest pain", ref = "Y/N/NK" }

[[observation]]
  name = "chest_pain"
  phase = "followup"
  date = { field = "flw_survey_date" }
  is_present = { field = "flw_chest_pains", description = "Chest pain", values = { 1 = true, 0 = false } }

[[observation]]
  name = "chest_pain"
  phase = "followup"
  date = { field = "flw2_survey_date" }
  is_present = { field = "flw2_chest_pains", description = "Chest pain", values = { 1 = true, 0 = false } }

[[observation]]
  name = "clinical_frailty_score"
  phase = "study"
  date = { field = "ccm_a_dat" }
  value = { field = "ccm_b_cfs_rsorres" }

[[observation]]
  name = "conjunctivitis"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  is_present = { field = "conjunct_ceoccur_v2", description = "Conjunctivitis", ref = "Y/N/NK" }

[[observation]]
  name = "cough"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }

  [observation.is_present]
    combinedType = "any"
    excludeWhen = "none"
    fields = [
      { field = "cough_ceoccur_v2", description = "Cough", ref = "Y/N/NK" },
      { field = "coughsput_ceoccur_v2", description = "Cough: with sputum production", ref = "Y/N/NK" },
      { field = "coughhb_ceoccur_v2", description = "Cough: bloody sputum / haemoptysis", ref = "Y/N/NK" },
      { field = "cough_ceoccur_v2_2", description = "Cough: 1-nonproductive, 2-productive, 3-with haemoptysis", values = { 1 = true, 2 = true, 3 = true, 0 = false } },
    ]

[[observation]]
  name = "cough"
  phase = "followup"
  date = { field = "flw_survey_date" }

  [observation.is_present]
    combinedType = "any"
    excludeWhen = "none"
    fields = [
      { field = "flw_pers_cough", description = "Persistant cough", values = { 1 = true, 0 = false } },
      { field = "flw_pers_cough_y", description = "If yes to persistent cough, please specify", values = { 1 = true, 2 = true } },
    ]

[[observation]]
  name = "cough"
  phase = "followup"
  date = { field = "flw2_survey_date" }

  [observation.is_present]
    combinedType = "any"
    excludeWhen = "none"
    fields = [
      { field = "flw2_cough", description = "Persistant cough", values = { 1 = true, 0 = false } },
      { field = "flw2_pers_cough_dry", description = "Persistent cough (dry)", values = { 1 = true, 0 = false } },
      { field = "flw2_pers_cough_ph", description = "Persistent cough (with phlegm)", values = { 1 = true, 0 = false } },
    ]

[[observation]]
  name = "cough_with_sputum_production"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }

  [observation.is_present]
    combinedType = "any"
    excludeWhen = "none"
    fields = [
      { field = "coughsput_ceoccur_v2", description = "Cough: with sputum production", ref = "Y/N/NK" },
      { field = "cough_ceoccur_v2_2", description = "Cough: 1-nonproductive, 2-productive, 3-with haemoptysis", values = { 1 = false, 2 = true, 3 = false, 0 = false } },
    ]

[[observation]]
  name = "cough_with_sputum_production"
  phase = "followup"
  date = { field = "flw_survey_date" }
  is_present = { field = "flw_pers_cough_y", description = "If yes to persistent cough, please specify", values = { 1 = false, 2 = true } }

[[observation]]
  name = "cough_with_sputum_production"
  phase = "followup"
  date = { field = "flw2_survey_date" }
  is_present = { field = "flw2_pers_cough_ph", description = "Persistent cough (with phlegm)", values = { 1 = true, 0 = false } }

[[observation]]
  name = "cough_with_haemoptysis"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }

  [observation.is_present]
    combinedType = "any"
    excludeWhen = "none"
    fields = [
      { field = "coughhb_ceoccur_v2", description = "Cough: bloody sputum / haemoptysis", ref = "Y/N/NK" },
      { field = "cough_ceoccur_v2_2", description = "Cough: 1-nonproductive, 2-productive, 3-with haemoptysis", values = { 1 = false, 2 = false, 3 = true, 0 = false } },
    ]

[[observation]]
  name = "diarrhoea"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  is_present = { field = "diarrhoea_ceoccur_v2", description = "Diarrhoea", ref = "Y/N/NK" }

[[observation]]
  name = "diarrhoea"
  phase = "followup"
  date = { field = "flw_survey_date" }
  is_present = { field = "flw_diarrhoea", description = "Diarrhoea", values = { 1 = true, 0 = false } }

[[observation]]
  name = "diarrhoea"
  phase = "followup"
  date = { field = "flw2_survey_date" }
  is_present = { field = "flw2_diarrhoea", description = "Diarrhoea", values = { 1 = true, 0 = false } }

[[observation]]
  name = "diastolic_blood_pressure_mmHg"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  value = { field = "admission_diabp_vsorres", source_unit = "mmHg" }

[[observation]]
  name = "diastolic_blood_pressure_mmHg"
  phase = "study"
  date = { field = "daily_dsstdat" }
  value = { field = "diastolic_vsorres", source_unit = "mmHg" }

[[observation]]
  name = "ear_pain"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  is_present = { field = "earpain_ceoccur_v2", description = "4a.5. Ear pain", ref = "Y/N/NK" }

[[observation]]
  name = "fatigue_malaise"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  is_present = { field = "fatigue_ceoccur_v2", description = "Fatigue / Malaise", ref = "Y/N/NK" }

[[observation]]
  name = "fatigue_malaise"
  phase = "followup"
  date = { field = "flw_survey_date" }
  is_present = { field = "flw_fatigue", description = "Fatigue", values = { 1 = true, 0 = false } }

[[observation]]
  name = "fatigue_malaise"
  phase = "followup"
  date = { field = "flw2_survey_date" }
  is_present = { field = "flw2_fatigue", description = "Fatigue", values = { 1 = true, 0 = false } }

[[observation]]
  name = "glasgow_coma_score"
  phase = "study"
  date = { field = "daily_dsstdat" }
  value = { field = "daily_gcs_vsorres", description = "Please state the lowest GCS recorded" }

[[observation]]
  name = "headache"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  is_present = { field = "headache_ceoccur_v2", description = "Headache", ref = "Y/N/NK" }

[[observation]]
  name = "headache"
  phase = "followup"
  date = { field = "flw_survey_date" }
  is_present = { field = "flw_headache", description = "Headache", values = { 1 = true, 0 = false } }

[[observation]]
  name = "headache"
  phase = "followup"
  date = { field = "flw2_survey_date" }
  is_present = { field = "flw2_headache", description = "Headache", values = { 1 = true, 0 = false } }

[[observation]]
  name = "heart_rate_bpm"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  value = { field = "hr_vsorres", description = "Enter the heart rate measured in beat per minute." }

[[observation]]
  name = "heart_rate_bpm"
  phase = "study"
  date = { field = "daily_dsstdat" }
  value = { field = "daily_hr_vsorres" }

[[observation]]
  name = "history_of_fever"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  is_present = { field = "fever_ceoccur_v2", description = "History of fever", ref = "Y/N/NK" }

[[observation]]
  name = "inability_to_walk"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  is_present = { field = "inablewalk_ceoccur_v2", description = "Inability to walk", ref = "Y/N/NK" }

[[observation]]
  name = "inability_to_walk_scale"
  phase = "followup"
  date = { field = "flw_survey_date" }
  text = { field = "flw_eq5d_mb_5l_uk_eng_2", values = { 1 = "No difficulty", 2 = "Some difficulty", 3 = "Some difficulty", 4 = "Lots of difficulty", 5 = "Unable to walk" } }

[[observation]]
  name = "inability_to_walk_scale"
  phase = "followup"
  date = { field = "flw2_survey_date" }
  text = { field = "flw2_eq5d_mb_5l_uk_eng_2", values = { 1 = "No difficulty", 2 = "Some difficulty", 3 = "Some difficulty", 4 = "Lots of difficulty", 5 = "Unable to walk" } }

[[observation]]
  name = "joint_pain"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  is_present = { field = "jointpain_ceoccur_v2", description = "Joint pain (Arthralgia)", ref = "Y/N/NK" }

[[observation]]
  name = "joint_pain"
  phase = "followup"
  date = { field = "flw_survey_date" }
  is_present = { field = "flw_joint_pain", description = "Joint pain or swelling", values = { 1 = true, 0 = false } }

[[observation]]
  name = "joint_pain"
  phase = "followup"
  date = { field = "flw2_survey_date" }
  is_present = { field = "flw2_joint_pain", description = "Joint pain or swelling", values = { 1 = true, 0 = false } }

[[observation]]
  name = "loss_of_smell"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  is_present = { field = "anosmia_ceoccur_v2", description = "Loss of smell (Anosmia)", ref = "Y/N/NK" }

[[observation]]
  name = "loss_of_smell"
  phase = "followup"
  date = { field = "flw_survey_date" }
  is_present = { field = "flw_loss_smell", description = "Loss of smell", values = { 1 = true, 0 = false } }

[[observation]]
  name = "loss_of_smell"
  phase = "followup"
  date = { field = "flw2_survey_date" }
  is_present = { field = "flw2_loss_of_smell", description = "Loss of smell", values = { 1 = true, 0 = false } }

[[observation]]
  name = "loss_of_taste"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  is_present = { field = "ageusia_ceoccur_v2", description = "Loss of taste (Ageusia)", ref = "Y/N/NK" }

[[observation]]
  name = "loss_of_taste"
  phase = "followup"
  date = { field = "flw_survey_date" }
  is_present = { field = "flw_loss_taste", description = "Loss of taste", values = { 1 = true, 0 = false } }

[[observation]]
  name = "loss_of_taste"
  phase = "followup"
  date = { field = "flw2_survey_date" }
  is_present = { field = "flw2_loss_of_taste", description = "Loss of taste", values = { 1 = true, 0 = false } }

[[observation]]
  name = "lower_chest_wall_indrawing"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  is_present = { field = "lowerchest_ceoccur_v2", description = "Lower chest wall indrawing", ref = "Y/N/NK" }

[[observation]]
  name = "lymphadenopathy"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  is_present = { field = "lymp_ceoccur_v2", description = "Lymphadenopathy", ref = "Y/N/NK" }

[[observation]]
  name = "mean_arterial_blood_pressure_mmHg"
  phase = "study"
  date = { field = "daily_dsstdat" }
  value = { field = "daily_meanart_vsorres", description = "Mean Arterial Pressure:" }

[[observation]]
  name = "muscle_aches"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  is_present = { field = "myalgia_ceoccur_v2", description = "Muscle ache (Myalgia)", ref = "Y/N/NK" }

[[observation]]
  name = "muscle_aches"
  phase = "followup"
  date = { field = "flw_survey_date" }
  is_present = { field = "flw_muscle_pain", description = "Persistent muscle pain", values = { 1 = true, 0 = false } }

[[observation]]
  name = "muscle_aches"
  phase = "followup"
  date = { field = "flw2_survey_date" }
  is_present = { field = "flw2_muscle_pain", description = "Persistent muscle pain", values = { 1 = true, 0 = false } }

[[observation]]
  name = "other_symptom"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  text = { field = "other_cetermy_v2", description = "Other sign or symptom" }

[[observation]]
  name = "oxygen_flow_volume_max"
  phase = "study"
  date = { field = "daily_dsstdat" }
  text = { field = "oxygen_cmdose", values = { 1 = "<2 l/min", 6 = "2-5 l/min", 2 = "6-10 l/min", 3 = "11-15 l/min", 4 = ">15 l/min" } }

[[observation]]
  name = "oxygen_saturation_percent"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  value = { field = "oxy_vsorres", description = "Oxygen saturation on:" }

  [observation.context]
    combinedType = "set"
    excludeWhen = "none"
    fields = [
      { field = "oxy_vsorresu", description = "Oxygen saturation on:", values = { 1 = "room air", 2 = "oxygen therapy" } },
    ]

[[observation]]
  name = "oxygen_saturation_percent"
  phase = "study"
  date = { field = "daily_dsstdat" }
  value = { field = "daily_oxy_vsorres", description = "percentage oxygen saturation" }

[[observation]]
  name = "pao2"
  phase = "study"
  date = { field = "daily_dsstdat" }
  value = { field = "daily_pao2_lborres", unit = "mmHg", source_unit = { field = "daily_pao2_lborresu", values = { 1 = "kPa", 2 = "mmHg" } } }

  [observation.context]
    combinedType = "set"
    excludeWhen = "none"
    fields = [
      { field = "daily_pao2_lbspec", values = { 1 = "Arterial", 2 = "Capillary", 3 = "Venous", 4 = "Unknown" } },
    ]

[[observation]]
  name = "pco2"
  phase = "study"
  date = { field = "daily_dsstdat" }
  value = { field = "daily_pco2_lborres", unit = "mmHg", source_unit = { field = "daily_pco2_lborresu", values = { 1 = "kPa", 2 = "mmHg" } } }

[[observation]]
  name = "pH"
  phase = "study"
  date = { field = "daily_dsstdat" }
  value = { field = "daily_ph_lborres", description = "pH" }

[[observation]]
  name = "respiratory_rate"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  value = { field = "rr_vsorres", description = "Respiratory rate in breath per minute. Record the highest respiratory rate documented on admission." }

[[observation]]
  name = "respiratory_rate"
  phase = "study"
  date = { field = "daily_dsstdat" }
  value = { field = "daily_rr_vsorres", description = "Respiratory rate in breath per minute. If both abnormal low and high rate observed, record the abnormally high rate." }

[[observation]]
  name = "richmond_agitation-sedation_scale"
  phase = "study"
  date = { field = "daily_dsstdat" }
  value = { field = "rass_vsorres", apply = { function = "getFloat" }, description = "RASS calculated between -5 and 4" }

[[observation]]
  name = "riker_sedation-agitation_scale"
  phase = "study"
  date = { field = "daily_dsstdat" }
  value = { field = "sas_vsorres", description = "SAS calculated between 1 and 7" }

[[observation]]
  name = "runny_nose"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  is_present = { field = "runnynose_ceoccur_v2", description = "Runny nose (Rhinorrhoea)", ref = "Y/N/NK" }

[[observation]]
  name = "seizures"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  is_present = { field = "seizures_cecoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "seizures"
  phase = "study"
  date = { field = "daily_dsstdat" }
  is_present = { field = "seizure_ceterm", ref = "Y/N/NK" }

[[observation]]
  name = "seizures"
  phase = "followup"
  date = { field = "flw_survey_date" }
  is_present = { field = "flw_seizures", ref = "Y/N/NK" }

[[observation]]
  name = "seizures"
  phase = "followup"
  date = { field = "flw2_survey_date" }
  is_present = { field = "flw2_seizures", values = { 1 = true, 0 = false } }

[[observation]]
  name = "severe_dehydration"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  is_present = { field = "dehydration_vsorres", description = "Severe dehydration:", ref = "Y/N/NK" }

[[observation]]
  name = "shortness_of_breath"
  phase = "followup"
  date = { field = "flw_survey_date" }
  is_present = { field = "flw_short_breath", description = "Shortness of breath/breathlessness", values = { 1 = true, 0 = false } }

[[observation]]
  name = "shortness_of_breath"
  phase = "followup"
  date = { field = "flw2_survey_date" }
  is_present = { field = "flw2_short_breath", description = "Shortness of breath/breathlessness", values = { 1 = true, 0 = false } }

[[observation]]
  name = "shortness_of_breath"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  is_present = { field = "shortbreath_ceoccur_v2", description = "Shortness of breath (Dyspnea)", ref = "Y/N/NK" }

  # [[observation]]
  #   name = "shortness_of_breath"
  #   phase = "followup"

  #   [observation.date]
  #     ref = "followupDateHierarchy"

  #   [observation.if.flw_breathless_now]
  #     "!=" = ""

  # [observation.value]
  #   field = "flw_breathless_now"
  #   description = "(Breathless) Within the last 24 hour"

  #   [observation.value.values]
  #     1 = "not troubled by breathlessness except on strenuous exercise"
  #     2 = "short of breath when hurrying or when walking up a slight hill"
  #     3 = "walk slower than most people of my age because of breathlessness"
  #     4 = "stop for breath after walking 100 yards/ 90-100 metres"
  #     5 = "too breathless to leave the house"

  # [[observation]]
  #   name = "shortness_of_breath"
  #   phase = "followup"

  #   [observation.date]
  #     ref = "followupDateHierarchy"

  #   [observation.if.flw2_breathless_now]
  #     "!=" = ""

  # [observation.value]
  #   field = "flw2_breathless_now"
  #   description = "(Breathless) Within the last 24 hour"

  #   [observation.value.values]
  #     1 = "not troubled by breathlessness except on strenuous exercise"
  #     2 = "short of breath when hurrying or when walking up a slight hill"
  #     3 = "walk slower than most people of my age because of breathlessness"
  #     4 = "stop for breath after walking 100 yards/ 90-100 metres"
  #     5 = "too breathless to leave the house"

[[observation]]
  name = "skin_rash"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  is_present = { field = "rash_ceoccur_v2", description = "Skin rash", ref = "Y/N/NK" }

[[observation]]
  name = "skin_rash"
  phase = "followup"
  date = { field = "daily_dsstdat" }
  is_present = { field = "flw_skin_rash", description = "Skin rash", values = { 1 = true, 0 = false } }

[[observation]]
  name = "skin_ulcers"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  is_present = { field = "skinulcers_ceoccur_v2", description = "4a.20. Skin ulcer", ref = "Y/N/NK" }

[[observation]]
  name = "sore_throat"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  is_present = { field = "sorethroat_ceoccur_v2", description = "Sore throat", ref = "Y/N/NK" }

[[observation]]
  name = "sternal_capillary_refill_time_greater_2s"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  is_present = { field = "stercap_vsyn", description = "Sternal capillary refill time >2 seconds?", values = { 1 = true, 2 = false } }

[[observation]]
  name = "sternal_capillary_refill_time_greater_2s"
  phase = "study"
  date = { field = "daily_dsstdat" }
  is_present = { field = "daily_stercap_vsorres", values = { 1 = true, 2 = false } }

[[observation]]
  name = "systolic_blood_pressure_mmHg"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  value = { field = "sysbp_vsorres", source_unit = "mmHg" }

[[observation]]
  name = "systolic_blood_pressure_mmHg"
  phase = "study"
  date = { field = "daily_dsstdat" }
  value = { field = "systolic_vsorres", source_unit = "mmHg" }

[[observation]]
  name = "temperature_celsius"
  phase = "study"
  date = { field = "daily_dsstdat" }
  value = { field = "daily_temp_vsorres", source_unit = { field = "daily_temp_vsorresu", values = { 1 = "°C", 2 = "°F" } } }
  context = ['Highest']

[[observation]]
  name = "temperature_celsius"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  value = { field = "temp_vsorres", source_unit = { field = "temp_vsorresu", values = { 1 = "°C", 2 = "°F" } } }
  context = ['Highest']

[[observation]]
  name = "transfer_from_other_facility"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  is_present = { field = "hooccur", values = { 1 = true, 2 = true, 3 = false } }

[[observation]]
  name = "vomiting_nausea"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  is_present = { field = "vomit_ceoccur_v2", description = "Vomiting / Nausea", ref = "Y/N/NK" }

[[observation]]
  name = "vomiting_nausea"
  phase = "followup"
  date = { field = "flw_survey_date" }
  is_present = { field = "flw_nausea", description = "Nausea/vomiting", values = { 1 = true, 0 = false } }

[[observation]]
  name = "vomiting_nausea"
  phase = "followup"
  date = { field = "flw2_survey_date" }
  is_present = { field = "flw2_feeling_sick", description = "Feeling sick/vomiting", values = { 1 = true, 0 = false } }

[[observation]]
  name = "wheezing"
  phase = "admission"
  date = { ref = "admissionDateHierachy" }
  is_present = { field = "wheeze_ceoccur_v2", description = "Wheezing", ref = "Y/N/NK" }
