#:schema ../../schemas/dev/parser.schema.json

[adtl]
  name = "isaric-core"
  description = "isaric-core"
  skipFieldPattern = "flw.*"

  [adtl.tables.subject]
    kind = "groupBy"
    groupBy = "subject_id"
    aggregation = "lastNotNull"
    schema = "../../schemas/dev/subject.schema.json"

  [adtl.tables.visit]
    kind = "groupBy"
    groupBy = "subject_id"
    aggregation = "lastNotNull"
    schema = "../../schemas/dev/visit.schema.json"

  [adtl.tables.observation]
    kind = "oneToMany"
    schema = "../../schemas/dev/observation.schema.json"

    [adtl.tables.observation.common.visit_id]
      field = "subjid"
      sensitive = true

[adtl.defs."Y/N/NK".values]
  1 = true
  2 = false

[adtl.defs."ethnicityMap".values]
  1 = "white"
  2 = "arab"
  3 = "black"
  4 = "east asian"
  5 = "south asian"
  6 = "west asian"
  7 = "latin american"
  8 = "other"

[adtl.defs."ethnicityMapItaly".values]
  1 = "arab"
  2 = "black"
  3 = "east asian"
  4 = "south asian"
  5 = "west asian"
  6 = "latin american"
  7 = "white"
  8 = "aboriginal/first_nations"
  10 = "other"
  11 = "Unknown"

[adtl.defs.admissionDateHierarchy]
  combinedType = "firstNonNull"
  fields = [
    { field = "hostdat", description = "Admission date at this facility" },
    { field = "cestdat", description = "Onset date of first/earliest symptom" },
    { field = "dsstdat", description = "Date of enrolment" },
  ]

[adtl.defs.countryMap.values]
  1 = "AFG"
  2 = "ALB"
  3 = "DZA"
  4 = "AND"
  5 = "AGO"
  6 = "ATG"
  7 = "ARG"
  8 = "ARM"
  9 = "AUS"
  10 = "AUT"
  11 = "AZE"
  12 = "BHS"
  13 = "BHR"
  14 = "BGD"
  15 = "BRB"
  16 = "BLR"
  17 = "BEL"
  18 = "BLZ"
  19 = "BEN"
  20 = "BTN"
  21 = "BOL"
  22 = "BIH"
  23 = "BWA"
  24 = "BRA"
  25 = "BRN"
  26 = "BGR"
  27 = "BFA"
  28 = "BDI"
  29 = "KHM"
  30 = "CMR"
  31 = "CAN"
  32 = "CPV"
  33 = "CAF"
  34 = "TCD"
  35 = "CHL"
  36 = "CHN"
  37 = "COL"
  38 = "COM"
  39 = "COG"
  40 = "COD"
  41 = "CRI"
  42 = "HRV"
  43 = "CUB"
  44 = "CYP"
  45 = "CZE"
  46 = "DNK"
  47 = "DJI"
  48 = "DMA"
  49 = "DOM"
  50 = "TLS"
  51 = "ECU"
  52 = "EGY"
  53 = "SLV"
  54 = "GNQ"
  55 = "ERI"
  56 = "EST"
  57 = "ETH"
  58 = "FJI"
  59 = "FIN"
  60 = "FRA"
  61 = "GAB"
  62 = "GMB"
  63 = "GEO"
  64 = "DEU"
  65 = "GHA"
  66 = "GRC"
  67 = "GRD"
  68 = "GTM"
  69 = "GIN"
  70 = "GNB"
  71 = "GUY"
  72 = "HTI"
  73 = "HND"
  74 = "HUN"
  75 = "ISL"
  76 = "IND"
  77 = "IDN"
  78 = "IRN"
  79 = "IRQ"
  80 = "IRL"
  81 = "ISR"
  82 = "ITA"
  83 = "CIV"
  84 = "JAM"
  85 = "JPN"
  86 = "JOR"
  87 = "KAZ"
  88 = "KEN"
  89 = "KIR"
  90 = "PRK"
  91 = "KOR"
  92 = "XXK"
  93 = "KWT"
  94 = "KGZ"
  95 = "LAO"
  96 = "LVA"
  97 = "LBN"
  98 = "LSO"
  99 = "LBR"
  100 = "LBY"
  101 = "LIE"
  102 = "LTU"
  103 = "LUX"
  104 = "MKD"
  105 = "MDG"
  106 = "MWI"
  107 = "MYS"
  108 = "MDV"
  109 = "MLI"
  110 = "MLT"
  111 = "MHL"
  112 = "MRT"
  113 = "MUS"
  114 = "MEX"
  115 = "FSM"
  116 = "MDA"
  117 = "MCO"
  118 = "MNG"
  119 = "MNE"
  120 = "MAR"
  121 = "MOZ"
  122 = "MMR"
  123 = "NAM"
  124 = "NRU"
  125 = "NPL"
  126 = "NLD"
  127 = "NZL"
  128 = "NIC"
  129 = "NER"
  130 = "NGA"
  131 = "NOR"
  132 = "OMN"
  133 = "PAK"
  134 = "PLW"
  135 = "PAN"
  136 = "PNG"
  137 = "PRY"
  138 = "PER"
  139 = "PHL"
  140 = "POL"
  141 = "PRT"
  142 = "QAT"
  143 = "ROU"
  144 = "RUS"
  145 = "RWA"
  146 = "KNA"
  147 = "LCA"
  148 = "VCT"
  149 = "WSM"
  150 = "SMR"
  151 = "STP"
  152 = "SAU"
  153 = "SEN"
  154 = "SRB"
  155 = "SYC"
  156 = "SLE"
  157 = "SGP"
  158 = "SVK"
  159 = "SVN"
  160 = "SLB"
  161 = "SOM"
  162 = "ZAF"
  163 = "SSD"
  164 = "ESP"
  165 = "LKA"
  166 = "SDN"
  167 = "SUR"
  168 = "SWZ"
  169 = "SWE"
  170 = "CHE"
  171 = "SYR"
  172 = "TWN"
  173 = "TJK"
  174 = "TZA"
  175 = "THA"
  176 = "TGO"
  177 = "TON"
  178 = "TTO"
  179 = "TUN"
  180 = "TUR"
  181 = "TKM"
  182 = "TUV"
  183 = "UGA"
  184 = "UKR"
  185 = "ARE"
  186 = "GBR"
  187 = "USA"
  188 = "URY"
  189 = "UZB"
  190 = "VUT"
  191 = "VAT"
  192 = "VEN"
  193 = "VNM"
  194 = "YEM"
  195 = "ZMB"
  196 = "ZWE"

[subject]
  pathogen = "COVID-19"

  [subject.subject_id]
    field = "subjid"
    sensitive = true

  [subject.earliest_admission_date]
    ref = "admissionDateHierarchy"

  [subject.enrolment_date]
    field = "dsstdat"
    description = "Date of enrolment into the study or for in-patients is the date that COVID-19 was first assessed a suspected or confirmed by a clinician."

  [subject.age]
    field = "age_estimateyears"
    unit = "years"
    source_unit = { field = "age_estimateyearsu", values = { 1 = "months", 2 = "years", 3 = "days" } }

  [subject.date_of_birth]
    combinedType = "firstNonNull"
    fields = [{ field = "flw_date_of_birth" }, { field = "flw2_date_of_birth" }]

  [subject.dob_year]
    combinedType = "firstNonNull"
    fields = [
      { field = "flw_date_of_birth", apply = { function = "splitDate", params = [
        "year",
        2022,
      ] } },
      { field = "flw2_date_of_birth", apply = { function = "splitDate", params = [
        "year",
        2022,
      ] } },
      { field = "age_estimateyears", apply = { function = "startYear", params = [
        [
          "$hostdat",
          "$cestdat",
          "$dsstdat",
        ],
        2022,
      ] } },
    ]

  [subject.sex_at_birth]
    combinedType = "firstNonNull"
    excludeWhen = "none"
    fields = [
      { field = "sex", values = { 1 = "male", 2 = "female" } },
      { field = "flw_sex_at_birth", values = { 1 = "male", 2 = "female", 3 = "non_binary" } },
      { field = "flw2_sex_at_birth", values = { 1 = "male", 2 = "female", 3 = "non_binary" } },
    ]

  [subject.ethnicity]
    combinedType = "set"
    excludeWhen = "none"
    fields = [
      { field = "ethnic", ref = "ethnicityMapItaly", can_skip = true },
      { field = "ethnic___1", values = { 1 = "arab" }, can_skip = true },
      { field = "ethnic___2", values = { 1 = "black" }, can_skip = true },
      { field = "ethnic___3", values = { 1 = "east asian" }, can_skip = true },
      { field = "ethnic___4", values = { 1 = "south asian" }, can_skip = true },
      { field = "ethnic___5", values = { 1 = "west asian" }, can_skip = true },
      { field = "ethnic___6", values = { 1 = "latin american" }, can_skip = true },
      { field = "ethnic___7", values = { 1 = "white" }, can_skip = true },
      { field = "ethnic___8", values = { 1 = "Aboriginal/First Nations" }, can_skip = true },
      { field = "ethnic___9", values = { 1 = "Other" }, can_skip = true },
      { field = "ethnic___10", values = { 1 = "Unknown" }, can_skip = true },
      { field = "other_ethnic" },
      { field = "flw_ethnicity", ref = "ethnicityMap" },
      { field = "flw2_ethnicity", ref = "ethnicityMap" },
      { field = "flw_ethnicity_oth" },
      { field = "flw2_ethnicity_oth" },
    ]

  [subject.has_asplenia]
    field = "asplenia_mhyn"
    description = "Please include any of splenectomy, non-functional spleen, and congenital asplenia."
    ref = "Y/N/NK"

  [subject.has_asthma]
    field = "asthma_mhyn"
    description = "Clinician-diagnosed asthma"
    ref = "Y/N/NK"

  [subject.has_chronic_cardiac_disease]
    combinedType = "any"

    [[subject.has_chronic_cardiac_disease.fields]]
      field = "chroniccard_mhyn"
      description = "Chronic cardiac disease (not hypertension)"
      ref = "Y/N/NK"

[subject.has_chronic_hematologic_disease]
  field = "chronhaemo_mhyn"
  ref = "Y/N/NK"

[subject.has_chronic_kidney_disease]
  field = "renal_mhyn"
  description = "<acronym title=\"Please include any of clinician-diagnosed chronic kidney disease, chronic estimated glomerular filtration rate < 60mL/min/1.73m2, history of kidney transplantation\">Chronic kidney disease</acronym>"
  ref = "Y/N/NK"

[subject.has_dementia]
  field = "dementia_mhyn"
  description = "This is defined a clinical diagnosis of dementia"
  ref = "Y/N/NK"

[subject.has_diabetes]
  combinedType = "any"
  fields = [
    { fieldPattern = "diabetes_mhyn.*", description = "4b.13. Diabetes without complication", values = { 1 = true, 2 = false, 4 = true, 5 = true } },
    { field = "diabetiscomp_mhyn", description = "4b.12. Diabetes with complication", ref = "Y/N/NK", "can_skip" = true },
  ]

[subject.diabetes_type]
  field = "diabetes_mhyn_2"
  description = "Type 1 or Type 2 diabetes mellitus requiring oral or subcutaneous treatment. Please indicate whether type 1 or type 2."
  values = { 1 = "type-1", 4 = "type-2", 5 = "gestational" }

[subject.has_hiv]
  combinedType = "any"
  fields = [
    { field = "aidshiv_mhyn", description = "4b.10. AIDS/HIV", ref = "Y/N/NK", "can_skip" = true },
    { fieldPattern = "aidshiv_mhyn.*", description = "History of laboratory-confirmed HIV infection", values = { 1 = true, 4 = true, 2 = false } },
  ]

[subject.has_hiv_art]
  field = "aidshiv_mhyn_2"
  values = { 1 = true, 2 = false, 4 = false }

[subject.has_hypertension]
  field = "hypertension_mhyn"
  description = "Elevated arterial blood pressure diagnosed clinically, >140mmHg systolic or >90mmHg diastolic."
  ref = "Y/N/NK"

[subject.has_liver_disease]
  combinedType = "any"

  [[subject.has_liver_disease.fields]]
    field = "mildliv_mhyn"
    description = "This is defined a cirrhosis without portal hypertension or chronic hepatitis"
    ref = "Y/N/NK"

  [[subject.has_liver_disease.fields]]
    field = "modliver_mhyn"
    description = "This is defined a cirrhosis with portal hypertension, with or without bleeding or a history of variceal bleeding"
    ref = "Y/N/NK"

[subject.has_malignant_neoplasm]
  field = "malignantneo_mhyn"
  description = "Current solid organ or haematological malignancy"
  ref = "Y/N/NK"

[subject.has_malnutrition]
  field = "malnutrition_mhyn"
  description = "Any clinically identified deficiency in intake, either of total energy or of specific nutrient that led to a dietetic intervention or referral prior to the onset of COVID-19 symptoms."
  ref = "Y/N/NK"

[subject.has_obesity]
  field = "obesity_mhyn"
  description = "This refers to patient for whom an attending clinician ha assessed them to be obese - ideally but not necessarily with an objective measurement of obesity, such a calculation of the body mass index (BMI of 30 or more) or measurement of abdominal girth."
  ref = "Y/N/NK"

[subject.has_rheumatologic_disorder]
  field = "rheumatology_mhyr"
  description = "This is defined a an inflammatory and degenerative disease of connective tissue structures. It includes chronic arthropathy and arthritis, connective tissue disorder and vasculitides."
  ref = "Y/N/NK"

[subject.has_smoking]
  field = "smoking_mhyn"
  description = "Smoking at least one cigarette, cigar, pipe or equivalent per day before the onset of the current illness."

  [subject.has_smoking.values]
    1 = "yes"
    2 = "never"
    3 = "former"

[subject.has_tuberculosis]
  field = "tb_mhyn"
  description = "Patients currently receiving treatment for tuberculosis."
  ref = "Y/N/NK"

[subject.icu_admitted]
  combinedType = "any"

  [[subject.icu_admitted.fields]]
    field = "ccm_b_icu_hodat"
    description = "Date admitted to critical care ward"
    apply = { function = "isNotNull" }

  [[subject.icu_admitted.fields]]
    field = "icu_hostdat"
    description = "Date of ICU admission:"
    apply = { function = "isNotNull" }

  [[subject.icu_admitted.fields]]
    field = "icu_hoterm"
    description = "ICU admission:"
    ref = "Y/N/NK"

  [[subject.icu_admitted.fields]]
    field = "daily_hoterm"
    description = "ICU admission:"
    ref = "Y/N/NK"

[subject.pregnancy]
  field = "pregyn_rptestcd"
  description = "Pregnant?"
  values = { 1 = true, 0 = false }

[subject.pregnancy_birth_weight_kg]
  combinedType = "firstNonNull"
  fields = [
    { field = "apvs_weight", description = "Birth weight", source_unit = { field = "apvs_weightu", values = { 1 = "kg", 2 = "lbs" } }, unit = "kg" },
    { field = "apvs_weight_vsorres", description = "4.8 Birth weight", source_unit = "grams", unit = "kg", can_skip = true },
  ]

[subject.pregnancy_date_of_delivery]
  combinedType = "firstNonNull"
  fields = [
    { field = "dlvrdtc_rptestcd", description = "Delivery date:" },
    { field = "dlvr_cestdat", description = "Delivery during admission? If yes, date:", can_skip = true },
  ]

[subject.pregnancy_gestational_age_weeks]
  field = "egestage_rptestcd"
  description = "If YES: Gestational week assessment:"

[subject.pregnancy_gestational_outcome]
  combinedType = "firstNonNull"
  excludeWhen = "none"
  fields = [
    { field = "apsc_gestout", description = "Gestational outcome", values = { 1 = "term_birth", 2 = "preterm_birth" } },
    # { field = "pregout_rptestcd", description = "Pregnancy Outcome", values = { 1 = "term_birth", 2 = "preterm_birth" } },
    { field = "apdd_prcdth_ddorres", values = { 1 = "preterm_birth" }, "can_skip" = true },
  ]

[subject.pregnancy_outcome]
  field = "pregout_rptestcd"
  description = "Pregnancy Outcome"
  values = { 1 = "live birth", 2 = "still birth" }

[subject.pregnancy_post_partum]
  field = "postpart_rptestcd"
  description = "Defined a within six week of delivery."
  values = { 1 = true, 0 = false, 2 = false }

[subject.pregnancy_whether_breastfed]
  combinedType = "any"
  fields = [
    { field = "apsc_brfed", description = "Breastfed?", values = { 1 = true, 2 = true, 0 = false } },
    { field = "apsc_brfedind", description = "1.7.3 Breastfed", ref = "Y/N/NK", "can_skip" = true },
    { field = "apsc_brfedindy", description = "If YES", values = { 1 = true, 2 = true }, "can_skip" = true },
  ]

[subject.works_healthcare]
  field = "healthwork_erterm"
  description = "Employed a a healthcare worker?"
  ref = "Y/N/NK"

[subject.works_microbiology_lab]
  field = "labwork_erterm"
  description = "Employed in a microbiology laboratory?"
  ref = "Y/N/NK"

[subject.has_immunosuppression]
  field = "pre_nonoralsteroid_cmoccur"
  description = "Other immunosuppressant agents (not oral steroids)"
  ref = "Y/N/NK"

[subject.has_comorbidity_other]
  combinedType = "set"
  excludeWhen = "none"
  fields = [
    { field = "otherrisktext", description = "Other relevant risk factor(s)" },
  ]

[subject.has_died]
  combinedType = "any"
  fields = [
    { field = "dsterm", values = { 1 = false, 2 = false, 3 = false, 4 = true, 5 = false } },
    { field = "flw_deceased_yn", values = { 1 = true, 0 = false } },
    { field = "flw2_deceased_yn", values = { 1 = true, 0 = false } },
  ]

[subject.date_death]
  combinedType = "firstNonNull"
  fields = [
    { field = "dsstdtc", if = { dsterm = 4 } },
    { field = "flw_date_death", description = "If known, date of death" },
    { field = "flw2_date_death", description = "If known, date of death" },
  ]

[subject.vaccinated_covid19]
    field = "vacc_cov19_cmyn"
    values = { 1 = true, 0 = false }

[subject.vaccinated_covid19_dates]
  combinedType = "list"
  fields = [
    { field = "vacc_cov19_1_cmdat" },
    { field = "vacc_cov19_2_cmdat" },
    { field = "vacc_cov19_3_cmdat" },
    { field = "vacc_cov19_4_cmdat" },
  ]

[visit]
  country_iso3 = { field = "country", ref = "countryMap" }

  [visit.subject_id]
    field = "subjid"
    sensitive = true

  [visit.visit_id]
    field = "subjid"
    sensitive = true

  [visit.start_date]
    combinedType = "firstNonNull"
    fields = [
      { field = "hostdat", description = "Admission date at this facility" },
      { field = "flw_date_symptoms" },
      { field = "cestdat", description = "Onset date of first/earliest symptom" },
    ]

  [visit.icu_admission]
    combinedType = "any"

    [[visit.icu_admission.fields]]
      field = "icu_hoterm"
      description = "Date of ICU admission:"
      ref = "Y/N/NK"

    [[visit.icu_admission.fields]]
      field = "daily_hoterm"
      description = "Date of ICU admission:"
      ref = "Y/N/NK"

    [[visit.icu_admission.fields]]
      field = "ccm_b_icu_hodat"
      description = "Date admitted to critical care ward"
      apply = { function = "isNotNull" }

[visit.icu_admission_dates]
  combinedType = "set" # We require ICU admission to be a list, so firstNonNull won't work. Maybe some data cleaning on the other end is the best way to deal with this where dates are recorded slightly differently for what appears to be the same visit.
  excludeWhen = "none"

  [[visit.icu_admission_dates.fields]]
    field = "icu_hostdat"
    description = "Date of ICU admission:"

  [[visit.icu_admission_dates.fields]]
    field = "ccm_b_icu_hodat"
    description = "Date admitted to critical care ward"

[visit.transfer_from_other_facility]
  field = "hoyn"
  values = { 1 = false, 2 = true, 0 = false }

[visit.treatment_antibiotics]
  field = "antibiotic_cmyn"
  ref = "Y/N/NK"

[visit.treatment_antibiotics_type]
  combinedType = "set"
  excludeWhen = "none"
  fields = [
    { field = "antibiotic_cmtrt", can_skip = true },
    { field = "antibiotic_cmtrt_1", can_skip = true },
    { field = "antibiotic_cmtrt_2" },
    { field = "antibiotic_cmtrt_3" },
    { field = "antibiotic_cmtrt_4", can_skip = true },
    { field = "antibiotic_cmtrt_5", can_skip = true },
    { field = "antibiotic_cmtrt_6", can_skip = true },
    { field = "antibiotic_cmtrt_7", can_skip = true },
    { field = "antibiotic_cmtrt_8", can_skip = true },
    { field = "antibiotic_cmtrt_9", can_skip = true },
  ]

[visit.treatment_antifungal_agent]
  field = "antifung_cmyn"
  description = "Antifungal agent refers to any agent(s) prescribed specifically to treat systemic or topical infection caused by fungi."
  ref = "Y/N/NK"

[visit.treatment_antivirals]
  field = "antiviral_cmyn"
  ref = "Y/N/NK"

[visit.treatment_antiviral_type]
  combinedType = "set"
  excludeWhen = "none"
  fields = [
    { field = "antiviral_cmtrt___1", values = { 1 = "Ribavirin" }, "can_skip" = true },
    { field = "antiviral_cmtrt___2", values = { 1 = "Lopinavir/Ritonavir" }, "can_skip" = true },
    { field = "antiviral_cmtrt___3", values = { 1 = "Interferon alpha" }, "can_skip" = true },
    { field = "antiviral_cmtrt___4", values = { 1 = "Interferon beta" }, "can_skip" = true },
    { field = "antiviral_cmtrt___5", values = { 1 = "Neuraminidase inhibitor" }, "can_skip" = true },
    { field = "antiviral_cmtrt___7", values = { 1 = "Remdesivir" }, "can_skip" = true },
    { field = "antiviral_cmtrt___9", values = { 1 = "IL6 inhibitor" }, "can_skip" = true },
    { field = "antiviral_cmtrt___10", values = { 1 = "Convalescent plasma" }, "can_skip" = true },
    { field = "antiviral_cmtrt___11", values = { 1 = "Anti-influenza antiviral" }, "can_skip" = true },
    { field = "ribar_antiviral_cmdat", apply = { function = "textIfNotNull", params = [
      "Ribavirin",
    ] } },
    { field = "lopin_antiviral_cmdat", apply = { function = "textIfNotNull", params = [
      "Lopinavir/Ritonavir",
    ] } },
    { field = "remde_antiviral_cmdat", apply = { function = "textIfNotNull", params = [
      "Remdesivir",
    ] } },
    { field = "intera_antiviral_cmdat", apply = { function = "textIfNotNull", params = [
      "Interferon alpha",
    ] }, "can_skip" = true },
    { field = "interb_antiviral_cmdat", apply = { function = "textIfNotNull", params = [
      "Interferon beta",
    ] } },
    { field = "il6_antiviral_cmdat", apply = { function = "textIfNotNull", params = [
      "IL6 inhibitor",
    ] }, "can_skip" = true },
    { field = "cplasma_antiviral_cmdat", apply = { function = "textIfNotNull", params = [
      "Convalescent plasma",
    ] }, "can_skip" = true },
    { field = "antiflu_antiviral_cmdat", apply = { function = "textIfNotNull", params = [
      "Anti-influenza antiviral",
    ] }, "can_skip" = true },
  ]

[visit.treatment_antiviral_type_other]
  combinedType = "set"
  excludeWhen = "none"
  fields = [{ field = "antiviral_cmtype" }]

[visit.treatment_antimalarial]
  combinedType = "any"
  fields = [
    { field = "antiviral_cmtrt___8", values = { 1 = true }, "can_skip" = true },
    { field = "chlor_antiviral_cmdat", apply = { function = "isNotNull" } },
  ]

[visit.treatment_antimalarial_type]
  combinedType = "set"
  excludeWhen = "none"
  fields = [
    { field = "antiviral_cmtrt___8", values = { 1 = "Chloroquine/Hydroxychloroquine" }, "can_skip" = true },
    { field = "chlor_antiviral_cmdat", apply = { function = "textIfNotNull", params = [
      "Chloroquine/Hydroxychloroquine",
    ] } },
  ]

[visit.treatment_cardiovascular_support]
  combinedType = "any"
  fields = [
    { fieldPattern = "extracorp_prtr.*", description = "Extracorporeal support (ECMO)?", ref = "Y/N/NK" },
    { field = "daily_ecmo_prtrt", description = "Extra corporeal life support (ECLS / ECMO)?", ref = "Y/N/NK" },
    { field = "inotrop_cmtrt", ref = "Y/N/NK" },
    { field = "daily_inotrope_cmyn", ref = "Y/N/NK" },
  ]

[visit.treatment_corticosteroid]
  combinedType = "any"
  fields = [
    { field = "corticost_cmyn", ref = "Y/N/NK" },                        # check - true should override the falses, not just the empty values.
    { field = "dexameth_cmyn", ref = "Y/N/NK", "can_skip" = true },
    { field = "steroid_other_cmyn", ref = "Y/N/NK", "can_skip" = true },
  ]

[visit.treatment_corticosteroid_type]
  combinedType = "set"
  excludeWhen = "none"

  [[visit.treatment_corticosteroid_type.fields]]
    field = "dexameth_cmyn"
    values = { 1 = "Dexamethasone" }
    "can_skip" = true

  [[visit.treatment_corticosteroid_type.fields]]
    field = "steroid_other_cmtrt___1"
    values = { 1 = "Prednisolone" }
    "can_skip" = true

  [[visit.treatment_corticosteroid_type.fields]]
    field = "steroid_other_cmtrt___2"
    values = { 1 = "Hydrocortisone" }
    "can_skip" = true

  [[visit.treatment_corticosteroid_type.fields]]
    field = "steroid_other_cmtrt___3"
    values = { 1 = "Methylprednisolone" }
    "can_skip" = true

  [[visit.treatment_corticosteroid_type.fields]]
    field = "corticost_cmtrt"
    apply.function = "wordSubstituteSet"
    apply.params = [
      ["D[e,é][x,s]a?m[e,é]th?a[s,z]one?", "Dexamethasone"],
      ["Dexa", "Dexamethasone"],
      ["aacidexam", "Dexamethasone"], # brand name, Belgium
      ["deks[o,a]meth?ason", "Dexamethasone"],
      ["Predn?ison[e,a]?", "Prednisone"],
      ["Pred?nisol[o,a]n[e,a]?", "Prednisolone"],
      ["H[y,i]dr?[o,a]co?rti[s,z]on[e,a]?", "Hydrocortisone"],
      ["Methyl[-, ]?pre?d?nis(ol)?on?e", "Methylprednisolone"],
      ["Metilpred?n?is(ol)?on[e,a]?", "Methylprednisolone"],
      [
        "M[e,é]drol",         # US brandname
        "Methylprednisolone",
      ],
      ["budesonide", "Budesonide"],
    ]

[visit.treatment_corticosteroid_type_other]
  combinedType = "set"
  excludeWhen = "none"
  fields = [{ field = "corticost_cmtrt", "can_skip" = true }]

[visit.treatment_dialysis]
  combinedType = "any"
  fields = [
    { field = "ccm_b_renal_prtrt", description = "Dialysis/Hemofiltration?", ref = "Y/N/NK" },
    { field = "daily_rrt_cmtrt", ref = "Y/N/NK" },
    { field = "rrt_prtrt", ref = "Y/N/NK" },
  ]

[visit.treatment_ecmo]
  combinedType = "any"

  [[visit.treatment_ecmo.fields]]
    fieldPattern = "extracorp_prtr.*"
    description = "Extracorporeal support (ECMO)?"
    ref = "Y/N/NK"

  [[visit.treatment_ecmo.fields]]
    field = "daily_ecmo_prtrt"
    description = "Extra corporeal life support (ECLS / ECMO)?"
    ref = "Y/N/NK"

[visit.treatment_oxygen_therapy]
  combinedType = "any"

  [[visit.treatment_oxygen_therapy.fields]]
    field = "daily_nasaloxy_cmtrt"
    description = "High-flow nasal canula oxygen therapy?"
    ref = "Y/N/NK"

  [[visit.treatment_oxygen_therapy.fields]]
    field = "daily_noninvasive_prtrt"
    description = "Non-invasive ventialtion"
    ref = "Y/N/NK"

  [[visit.treatment_oxygen_therapy.fields]]
    field = "daily_invasive_prtrt"
    description = "Invasive ventialtion"
    ref = "Y/N/NK"

  [[visit.treatment_oxygen_therapy.fields]]
    field = "daily_prone_cmtrt"
    description = "Prone ventilation"
    ref = "Y/N/NK"
    if = { daily_prone_cmtype = 1, "can_skip" = true } # doesn't exist in Italy data, but field is only presented if invasive_ventilation is True so still valid.

  [[visit.treatment_oxygen_therapy.fields]]
    field = "daily_ecmo_prtrt"
    description = "ECMO"
    ref = "Y/N/NK"

  [[visit.treatment_oxygen_therapy.fields]]
    field = "oxygen_cmoccur"
    description = "Any Oxygen therapy:"

  [[visit.treatment_oxygen_therapy.fields]]
    field = "noninvasive_proccur"
    description = "Non-invasive ventilation"
    ref = "Y/N/NK"

  [[visit.treatment_oxygen_therapy.fields]]
    field = "invasive_proccur"
    description = "Invasive ventilation"
    ref = "Y/N/NK"

  [[visit.treatment_oxygen_therapy.fields]]
    field = "nasal_highflow_proccur"
    description = "High flow nasal oxygen"
    ref = "Y/N/NK"
    can_skip = true

  [[visit.treatment_oxygen_therapy.fields]]
    fieldPattern = "extracorp_prtr.*"
    description = "Extracorporeal support (ECMO)"
    ref = "Y/N/NK"

  [[visit.treatment_oxygen_therapy.fields]]
    field = "ccm_b_invasive_prtrt"
    description = "Invasive ventilation?"
    ref = "Y/N/NK"

  [[visit.treatment_oxygen_therapy.fields]]
    field = "ccm_b_noninvasive_prtrt"
    description = "Non-invasive ventilation?"
    ref = "Y/N/NK"

  [[visit.treatment_oxygen_therapy.fields]]
    field = "ccm_b_hhfnc_prtrt"
    description = "Humidified high flow nasal cannula (HHFNC)?"
    ref = "Y/N/NK"

  [[visit.treatment_oxygen_therapy.fields]]
    field = "ccm_b_mechvent"
    description = "Mechanical Ventilation?"
    ref = "Y/N/NK"
    can_skip = true

  [[visit.treatment_oxygen_therapy.fields]]
    field = "ccm_b_mechvent_prtrt"
    description = "Mechanical Ventilation?"
    values = { 1 = true, 2 = true, 3 = true, 4 = true }

[visit.treatment_oxygen_mask_prongs]
  field = "oxygen_cminterface"
  values = { 1 = false, 2 = true, 3 = true, 4 = false }
  description = "Ventimask, Reservoir, NasalO2, HHFNC"
  can_skip = true

[visit.treatment_high_flow_nasal_cannula]
  combinedType = "any"
  fields = [
    { field = "ccm_b_hhfnc_prtrt", description = "Humidified high flow nasal cannula (HHFNC)?", ref = "Y/N/NK" },
    { field = "nasal_highflow_proccur", description = "High flow nasal oxygen", ref = "Y/N/NK", "can_skip" = true },
    { field = "daily_nasaloxy_cmtrt", description = "High-flow nasal canula oxygen therapy?", ref = "Y/N/NK" },
  ]

[visit.treatment_invasive_ventilation]
  combinedType = "any"
  fields = [
    { field = "invasive_proccur", ref = "Y/N/NK" },
    { field = "daily_invasive_prtrt", ref = "Y/N/NK" },
    { field = "ccm_b_invasive_prtrt", ref = "Y/N/NK" },
  ]

[visit.treatment_noninvasive_ventilation]
  combinedType = "any"
  fields = [
    { field = "noninvasive_proccur", ref = "Y/N/NK" },
    { field = "daily_noninvasive_prtrt", ref = "Y/N/NK" },
    { field = "ccm_b_noninvasive_prtrt", ref = "Y/N/NK" },
  ]

[visit.treatment_anticoagulation]
  combinedType = "any"
  fields = [
    { field = "anticoag_cmyn", description = "Anticoagulation?", ref = "Y/N/NK", "can_skip" = true },
    { field = "heparint_cmyn", description = "Heparin?", ref = "Y/N/NK", "can_skip" = true },
    { field = "ccm_b_heparint_cmyn", description = "Heparin", ref = "Y/N/NK" },
  ]

[visit.treatment_inhaled_nitric_oxide]
  combinedType = "any"
  fields = [
    { field = "inhalednit_cmtrt", description = "Inhaled Nitric Oxide?", ref = "Y/N/NK" },
    { field = "daily_nitritc_cmtrt", description = "Inhaled Nitric Oxide ?", ref = "Y/N/NK" },
  ]

[visit.treatment_inotropes_vasopressors]
  combinedType = "any"
  description = "A vasopressor is a pharmaceutical agent that cause vasoconstriction."
  fields = [
    { field = "inotrop_cmtrt", ref = "Y/N/NK" },
    { field = "daily_inotrope_cmyn", ref = "Y/N/NK" },
  ]

[visit.treatment_neuromuscular_blocking_agents]
  field = "daily_neuro_cmtrt"
  description = "Neuromuscular blocking agents?"
  ref = "Y/N/NK"

[visit.treatment_other]
  combinedType = "set"
  excludeWhen = "none"
  fields = [
    { field = "othertx_cmtrt_1", description = "<i>Other Agent 1</i> - Agent:" },
    { field = "othertx_cmtrt_3", description = "<i>Other Agent 3</i> - Agent:", "can_skip" = true },
    { field = "othertx_cmtrt_2", description = "<i>Other Agent 2</i> - Agent:" },
    { field = "daily_other_prtrt" },
    { field = "other_cm", "can_skip" = true },
  ]

[visit.treatment_prone_position]
  combinedType = "any"

  [[visit.treatment_prone_position.fields]]
    field = "pronevent_prtrt"
    description = "Prone ventilation refers to ventilation with the patient lying in the prone position. If the patient received prone ventilation at any time during their hospital stay, please tick YES and indicate the total duration in days."
    ref = "Y/N/NK"

  [[visit.treatment_prone_position.fields]]
    field = "daily_prone_cmtrt"
    description = "Prone ventilation refers to ventilation with the patient lying in the prone position. If the patient received prone ventilation at any time during their hospital stay, please tick YES and indicate the total duration in days."
    ref = "Y/N/NK"

  [[visit.treatment_prone_position.fields]]
    field = "ccm_b_pronevent_prtrt"
    description = "Prone Positioning?"
    ref = "Y/N/NK"

[visit.date_outcome]
  field = "dsstdtc"
  description = "Please state the date for the outcome listed above."

[visit.outcome]
  field = "dsterm"
  description = "Please state the date for the outcome listed above."
  values = { 1 = "discharged", 2 = "hospitalised", 3 = "transferred", 4 = "death", 5 = "palliative discharge" }

  ## OBSERVATION

[[observation]]
  name = "abdominal_pain"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "abdopain_ceoccur_v2", values = { 1 = true, 2 = false }, can_skip = true }

[[observation]]
  name = "abdominal_pain"
  phase = "followup"
  start_date = { field = "flw_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw_survey_date" }
  duration_type = "event"
  is_present = { field = "flw_stomach_pain", values = { 1 = true, 0 = false } }

[[observation]]
  name = "abdominal_pain"
  phase = "followup"
  start_date = { field = "flw2_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw2_survey_date" }
  duration_type = "event"
  is_present = { field = "flw2_stomach", values = { 1 = true, 0 = false } }

[[observation]]
  name = "altered_consciousness_confusion"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "confusion_ceoccur_v2", description = "Altered consciousness / confusion", ref = "Y/N/NK" }

[[observation]]
  name = "confusion"
  phase = "followup"
  start_date = { field = "flw_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw_survey_date" }
  duration_type = "event"
  is_present = { field = "flw_confusion", description = "Confusion/lack of concentration", values = { 1 = true, 0 = false } }

[[observation]]
  name = "confusion"
  phase = "followup"
  start_date = { field = "flw2_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw2_survey_date" }
  duration_type = "event"
  is_present = { field = "flw2_confusion", description = "Confusion/lack of concentration", values = { 1 = true, 0 = false } }

[[observation]]
  name = "anorexia"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "anorexia_ceoccur_v2", description = "Anorexia", ref = "Y/N/NK" }

[[observation]]
  name = "anorexia"
  phase = "followup"
  start_date = { field = "flw_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw_survey_date" }
  duration_type = "event"
  is_present = { field = "flw_appetite", ref = "Y/N/NK" }

[[observation]]
  name = "anorexia"
  phase = "followup"
  start_date = { field = "flw2_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw2_survey_date" }
  duration_type = "event"
  is_present = { field = "flw2_loss_of_app", ref = "Y/N/NK" }

[[observation]]
  name = "avpu"
  phase = "study"
  date = { field = "daily_dsstdat" }
  text = { field = "avpu_vsorres", values = { 1 = "Alert", 2 = "Verbal", 3 = "Pain", 4 = "Unresponsive" } }

[[observation]]
  name = "base_excess"
  phase = "study"
  date = { field = "daily_dsstdat" }
  value = { field = "daily_baseex_lborres", apply = { function = "getFloat" } }

[[observation]]
  name = "bleeding_haemorrhage"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "bleed_ceoccur_v2", description = "Bleeding (Haemorrhage)", ref = "Y/N/NK", can_skip = true }

  [observation.context]
    combinedType = "set"
    excludeWhen = "none"
    fields = [
      { field = "bleed_ceterm_v2", description = "specify site", if.all = [
        { bleed_ceterm_v2 = { "!=" = 1 } },
        { bleed_ceterm_v2 = { "!=" = 2 } },
        { bleed_ceterm_v2 = { "!=" = 3 } },
        { bleed_ceterm_v2 = { "!=" = "" } },
      ], can_skip = true },
      { field = "bleed_cetermy_v2", if.all = [
        { bleed_cetermy_v2 = { "!=" = 1 } },
        { bleed_cetermy_v2 = { "!=" = 2 } },
        { bleed_cetermy_v2 = { "!=" = 3 } },
        { bleed_cetermy_v2 = { "!=" = "" } },
      ] },
    ]

[[observation]]
  name = "bleeding"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }

  [observation.is_present]
    combinedType = "any"
    fields = [
      { field = "bleed_cetermy_v2", description = "Bleeding (others)", ref = "Y/N/NK", "can_skip" = true },
      { field = "bleed_ceterm_v2", ref = "Y/N/NK", can_skip = true },
    ]

[[observation]]
  name = "bleeding"
  phase = "followup"
  start_date = { field = "flw_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw_survey_date" }
  duration_type = "event"
  is_present = { field = "flw_bleeding", description = "Bleeding", values = { 1 = true, 0 = false } }

  [observation.context]
    combinedType = "set"
    excludeWhen = "none"
    fields = [
      { field = "flw_bleeding_site", description = "please specify bleeding site" },
    ]

[[observation]]
  name = "bleeding"
  phase = "followup"
  start_date = { field = "flw_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw_survey_date" }
  duration_type = "event"
  is_present = { field = "flw_bleeding", values = { 1 = true, 0 = false } }
  # site?

[[observation]]
  name = "chest_pain"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "chestpain_ceoccur_v2", description = "Chest pain", ref = "Y/N/NK" }

[[observation]]
  name = "chest_pain"
  phase = "followup"
  start_date = { field = "flw_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw_survey_date" }
  duration_type = "event"
  is_present = { field = "flw_chest_pains", description = "Chest pain", values = { 1 = true, 0 = false } }

[[observation]]
  name = "chest_pain"
  phase = "followup"
  start_date = { field = "flw2_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw2_survey_date" }
  duration_type = "event"
  is_present = { field = "flw2_chest_pains", description = "Chest pain", values = { 1 = true, 0 = false } }

[[observation]]
  name = "clinical_frailty_score"
  phase = "study"
  date = { field = "ccm_a_dat" }
  value = { field = "ccm_b_cfs_rsorres" }

[[observation]]
  name = "conjunctivitis"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "conjunct_ceoccur_v2", description = "Conjunctivitis", ref = "Y/N/NK" }

[[observation]]
  name = "cough"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }

  [observation.is_present]
    combinedType = "any"
    fields = [
      { field = "cough_ceoccur_v2", description = "Cough", ref = "Y/N/NK", "can_skip" = true },
      { field = "coughsput_ceoccur_v2", description = "Cough: with sputum production", ref = "Y/N/NK", "can_skip" = true },
      { field = "coughhb_ceoccur_v2", description = "Cough: bloody sputum / haemoptysis", ref = "Y/N/NK", "can_skip" = true },
      { field = "cough_ceoccur_v2_2", description = "Cough: 1-nonproductive, 2-productive, 3-with haemoptysis", values = { 1 = true, 2 = true, 3 = true, 0 = false } },
    ]

[[observation]]
  name = "cough"
  phase = "followup"
  start_date = { field = "flw_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw_survey_date" }
  duration_type = "event"

  [observation.is_present]
    combinedType = "any"
    fields = [
      { field = "flw_pers_cough", description = "Persistant cough", values = { 1 = true, 0 = false } },
      { field = "flw_pers_cough_y", description = "If yes to persistent cough, please specify", values = { 1 = true, 2 = true } },
      { field = "flw_pers_cough_dry", values = { 1 = true, 0 = false } },
      { field = "flw_pers_cough_ph", values = { 1 = true, 0 = false } },
    ]

[[observation]]
  name = "cough"
  phase = "followup"
  start_date = { field = "flw2_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw2_survey_date" }
  duration_type = "event"

  [observation.is_present]
    combinedType = "any"
    fields = [
      { field = "flw2_cough", description = "Persistant cough", values = { 1 = true, 0 = false } },
      { field = "flw2_pers_cough_dry", description = "Persistent cough (dry)", values = { 1 = true, 0 = false } },
      { field = "flw2_pers_cough_ph", description = "Persistent cough (with phlegm)", values = { 1 = true, 0 = false } },
    ]

[[observation]]
  name = "cough_dry"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  [observation.is_present]
    combinedType = "any"
    fields = [
      { field = "cough_ceoccur_v2_2", description = "Cough: 1-nonproductive, 2-productive, 3-with haemoptysis", values = { 1 = true, 2 = false, 3 = false, 0 = false } },
    ]

[[observation]]
  name = "cough_dry"
  phase = "followup"
  start_date = { field = "flw_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw_survey_date" }
  duration_type = "event"
  [observation.is_present]
    combinedType = "any"
    fields = [
      { field = "flw_pers_cough_y", description = "If yes to persistent cough, please specify", values = { 1 = true, 2 = false } },
      { field = "flw_pers_cough_dry", values = { 1 = true, 0 = false } },
    ]

[[observation]]
  name = "cough_dry"
  phase = "followup"
  start_date = { field = "flw2_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw2_survey_date" }
  duration_type = "event"
  is_present = { field = "flw2_pers_cough_dry", description = "Persistent cough (dry)", values = { 1 = true, 0 = false } }

[[observation]]
  name = "cough_with_sputum_production"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }

  [observation.is_present]
    combinedType = "any"
    fields = [
      { field = "coughsput_ceoccur_v2", description = "Cough: with sputum production", ref = "Y/N/NK", "can_skip" = true },
      { field = "cough_ceoccur_v2_2", description = "Cough: 1-nonproductive, 2-productive, 3-with haemoptysis", values = { 1 = false, 2 = true, 3 = false, 0 = false } },
    ]

[[observation]]
  name = "cough_with_sputum_production"
  phase = "followup"
  start_date = { field = "flw_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw_survey_date" }
  duration_type = "event"
  [observation.is_present]
    combinedType = "any"
    fields = [
      { field = "flw_pers_cough_y", description = "If yes to persistent cough, please specify", values = { 1 = false, 2 = true } },
      { field = "flw_pers_cough_ph", values = { 1 = true, 0 = false } },
    ]

[[observation]]
  name = "cough_with_sputum_production"
  phase = "followup"
  start_date = { field = "flw2_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw2_survey_date" }
  duration_type = "event"
  is_present = { field = "flw2_pers_cough_ph", description = "Persistent cough (with phlegm)", values = { 1 = true, 0 = false } }

[[observation]]
  name = "cough_with_haemoptysis"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }

  [observation.is_present]
    combinedType = "any"
    fields = [
      { field = "coughhb_ceoccur_v2", description = "Cough: bloody sputum / haemoptysis", ref = "Y/N/NK", "can_skip" = true },
      { field = "cough_ceoccur_v2_2", description = "Cough: 1-nonproductive, 2-productive, 3-with haemoptysis", values = { 1 = false, 2 = false, 3 = true, 0 = false } },
    ]

[[observation]]
  name = "diarrhoea"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "diarrhoea_ceoccur_v2", description = "Diarrhoea", ref = "Y/N/NK" }

[[observation]]
  name = "diarrhoea"
  phase = "followup"
  start_date = { field = "flw_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw_survey_date" }
  duration_type = "event"
  is_present = { field = "flw_diarrhoea", description = "Diarrhoea", values = { 1 = true, 0 = false } }

[[observation]]
  name = "diarrhoea"
  phase = "followup"
  start_date = { field = "flw2_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw2_survey_date" }
  duration_type = "event"
  is_present = { field = "flw2_diarrhoea", description = "Diarrhoea", values = { 1 = true, 0 = false } }

[[observation]]
  name = "diastolic_blood_pressure_mmHg"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  value = { field = "admission_diabp_vsorres", source_unit = "mmHg" }

[[observation]]
  name = "diastolic_blood_pressure_mmHg"
  phase = "study"
  date = { field = "daily_dsstdat" }
  value = { field = "diastolic_vsorres", source_unit = "mmHg" }

[[observation]]
  name = "ear_pain"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "earpain_ceoccur_v2", description = "4a.5. Ear pain", ref = "Y/N/NK", "can_skip" = true }

[[observation]]
  name = "fatigue_malaise"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "fatigue_ceoccur_v2", description = "Fatigue / Malaise", ref = "Y/N/NK" }

[[observation]]
  name = "fatigue_malaise"
  phase = "followup"
  start_date = { field = "flw_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw_survey_date" }
  duration_type = "event"
  [observation.is_present]
    combinedType = "any"
    fields = [
      { field = "flw_fatigue", description = "Fatigue", values = { 1 = true, 0 = false } },
      { field = "flw_fatigue_new", values = { 1 = true, 0 = false } },
    ]

[[observation]]
  name = "fatigue_malaise"
  phase = "followup"
  start_date = { field = "flw2_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw2_survey_date" }
  duration_type = "event"
  is_present = { field = "flw2_fatigue", description = "Fatigue", values = { 1 = true, 0 = false } }

[[observation]]
  name = "glasgow_coma_score"
  phase = "study"
  date = { field = "daily_dsstdat" }
  value = { field = "daily_gcs_vsorres", description = "Please state the lowest GCS recorded" }

[[observation]]
  name = "headache"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "headache_ceoccur_v2", description = "Headache", ref = "Y/N/NK" }

[[observation]]
  name = "headache"
  phase = "followup"
  start_date = { field = "flw_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw_survey_date" }
  duration_type = "event"
  is_present = { field = "flw_headache", description = "Headache", values = { 1 = true, 0 = false } }

[[observation]]
  name = "headache"
  phase = "followup"
  start_date = { field = "flw2_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw2_survey_date" }
  duration_type = "event"
  is_present = { field = "flw2_headache", description = "Headache", values = { 1 = true, 0 = false } }

[[observation]]
  name = "heart_rate_bpm"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  value = { field = "hr_vsorres", description = "Enter the heart rate measured in beat per minute." }

[[observation]]
  name = "heart_rate_bpm"
  phase = "study"
  date = { field = "daily_dsstdat" }
  value = { field = "daily_hr_vsorres" }

[[observation]]
  name = "history_of_fever"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "fever_ceoccur_v2", description = "History of fever", ref = "Y/N/NK" }

[[observation]]
  name = "history_of_fever"
  phase = "followup"
  date = { field = "flw_last_fever" }
  is_present = { field = "flw_fever", ref = "Y/N/NK" }

[[observation]]
  name = "history_of_fever"
  phase = "followup"
  date = { field = "flw2_last_fever" }
  is_present = { field = "flw2_fever", ref = "Y/N/NK" }

[[observation]]
  name = "inability_to_walk"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "inablewalk_ceoccur_v2", description = "Inability to walk", ref = "Y/N/NK" }

[[observation]]
  name = "inability_to_walk_scale"
  phase = "followup"
  date = { field = "flw_survey_date" }
  value = { field = "flw_walking_today", values = { 1 = 1, 2 = 2, 3 = 3, 4 = 4 } }
  context = ["Ability to walk or climb steps today"]

[[observation]]
  name = "inability_to_walk_scale"
  phase = "admission"
  date = { field = "admissionDateHierarchy" }
  value = { field = "flw_walking_pre_c19", values = { 1 = 1, 2 = 2, 3 = 3, 4 = 4 } }
  context = ["Ability to walk or climb steps prior to COVID-19 illness"]

[[observation]]
  name = "inability_to_walk_scale"
  phase = "admission"
  date = { field = "admissionDateHierarchy" }
  value = { field = "flw_eq5d_mb_5l_uk_eng", values = { 1 = 1, 2 = 2, 3 = 2, 4 = 3, 5 = 4 } }
  context = ["Ability to walk prior to COVID-19 illness"]

[[observation]]
  name = "inability_to_walk_scale"
  phase = "followup"
  date = { field = "flw_survey_date" }
  value = { field = "flw_eq5d_mb_5l_uk_eng_2", values = { 1 = 1, 2 = 2, 3 = 2, 4 = 3, 5 = 4 } }

[[observation]]
  name = "inability_to_walk_scale"
  phase = "followup"
  date = { field = "flw2_survey_date" }
  value = { field = "flw2_eq5d_mb_5l_uk_eng_2", values = { 1 = 1, 2 = 2, 3 = 2, 4 = 3, 5 = 4 } }

[[observation]]
  name = "inability_to_walk_scale"
  phase = "followup"
  date = { field = "flw2_survey_date" }
  value = { field = "flw2_walking_today", values = { 1 = 1, 2 = 2, 3 = 3, 4 = 4 } }
  context = ["Ability to walk or climb steps today"]

[[observation]]
  name = "joint_pain"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "jointpain_ceoccur_v2", description = "Joint pain (Arthralgia)", ref = "Y/N/NK" }

[[observation]]
  name = "joint_pain"
  phase = "followup"
  start_date = { field = "flw_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw_survey_date" }
  duration_type = "event"
  is_present = { field = "flw_joint_pain", description = "Joint pain or swelling", values = { 1 = true, 0 = false } }

[[observation]]
  name = "joint_pain"
  phase = "followup"
  start_date = { field = "flw2_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw2_survey_date" }
  duration_type = "event"
  is_present = { field = "flw2_joint_pain", description = "Joint pain or swelling", values = { 1 = true, 0 = false } }

[[observation]]
  name = "loss_of_smell_or_taste"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  [observation.is_present]
    combinedType = "any"
    fields = [
      { field = "anosmia_ceoccur_v2", description = "Loss of smell (Anosmia)", ref = "Y/N/NK" },
      { field = "ageusia_ceoccur_v2", description = "Loss of taste (Ageusia)", ref = "Y/N/NK" },
    ]

[[observation]]
  name = "loss_of_smell_or_taste"
  phase = "followup"
  start_date = { field = "flw_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw_survey_date" }
  duration_type = "event"
  [observation.is_present]
    combinedType = "any"
    fields = [
      { field = "flw_loss_smell", description = "Loss of smell", values = { 1 = true, 0 = false } },
      { field = "flw_loss_taste", description = "Loss of taste", values = { 1 = true, 0 = false } },
    ]

[[observation]]
  name = "loss_of_smell_or_taste"
  phase = "followup"
  start_date = { field = "flw2_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw2_survey_date" }
  duration_type = "event"
  [observation.is_present]
    combinedType = "any"
    fields = [
      { field = "flw2_loss_of_smell", description = "Loss of smell", values = { 1 = true, 0 = false } },
      { field = "flw2_loss_of_taste", description = "Loss of taste", values = { 1 = true, 0 = false } },
    ]

[[observation]]
  name = "loss_of_smell"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "anosmia_ceoccur_v2", description = "Loss of smell (Anosmia)", ref = "Y/N/NK" }

[[observation]]
  name = "loss_of_smell"
  phase = "followup"
  start_date = { field = "flw_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw_survey_date" }
  duration_type = "event"
  is_present = { field = "flw_loss_smell", description = "Loss of smell", values = { 1 = true, 0 = false } }

[[observation]]
  name = "loss_of_smell"
  phase = "followup"
  start_date = { field = "flw2_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw2_survey_date" }
  duration_type = "event"
  is_present = { field = "flw2_loss_of_smell", description = "Loss of smell", values = { 1 = true, 0 = false } }

[[observation]]
  name = "loss_of_taste"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "ageusia_ceoccur_v2", description = "Loss of taste (Ageusia)", ref = "Y/N/NK" }

[[observation]]
  name = "loss_of_taste"
  phase = "followup"
  start_date = { field = "flw_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw_survey_date" }
  duration_type = "event"
  is_present = { field = "flw_loss_taste", description = "Loss of taste", values = { 1 = true, 0 = false } }

[[observation]]
  name = "loss_of_taste"
  phase = "followup"
  start_date = { field = "flw2_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw2_survey_date" }
  duration_type = "event"
  is_present = { field = "flw2_loss_of_taste", description = "Loss of taste", values = { 1 = true, 0 = false } }

[[observation]]
  name = "lower_chest_wall_indrawing"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "lowerchest_ceoccur_v2", description = "Lower chest wall indrawing", ref = "Y/N/NK" }

[[observation]]
  name = "lymphadenopathy"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "lymp_ceoccur_v2", description = "Lymphadenopathy", ref = "Y/N/NK" }

[[observation]]
  name = "mean_arterial_blood_pressure_mmHg"
  phase = "study"
  date = { field = "daily_dsstdat" }
  value = { field = "daily_meanart_vsorres", description = "Mean Arterial Pressure:" }

[[observation]]
  name = "muscle_aches"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "myalgia_ceoccur_v2", description = "Muscle ache (Myalgia)", ref = "Y/N/NK" }

[[observation]]
  name = "muscle_aches"
  phase = "followup"
  start_date = { field = "flw_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw_survey_date" }
  duration_type = "event"
  is_present = { field = "flw_muscle_pain", description = "Persistent muscle pain", values = { 1 = true, 0 = false } }

[[observation]]
  name = "muscle_aches"
  phase = "followup"
  start_date = { field = "flw2_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw2_survey_date" }
  duration_type = "event"
  is_present = { field = "flw2_muscle_pain", description = "Persistent muscle pain", values = { 1 = true, 0 = false } }

[[observation]]
  name = "other_symptom"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  text = { field = "other_cetermy_v2", description = "Other sign or symptom" }

[[observation]]
  name = "other_symptom"
  phase = "followup"
  start_date = { field = "flw_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw_survey_date" }
  duration_type = "event"
  text = { field = "flw_new_symptoms" }

[[observation]]
  name = "other_symptom"
  phase = "followup"
  start_date = { field = "flw2_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw2_survey_date" }
  duration_type = "event"
  text = { field = "flw2_other_symp" }

[[observation]] # PL: look at this one
  name = "oxygen_flow_volume_max"
  phase = "study"
  start_date = { ref = "admissionDateHierarchy" }
  date = { field = "dsstdtc" }
  duration_type = "block"
  text = { field = "oxygen_cmdose", values = { 1 = "<2 l/min", 6 = "2-5 l/min", 2 = "6-10 l/min", 3 = "11-15 l/min", 4 = ">15 l/min" } }
  context = ['Maximum over entire visit']

[[observation]]
  name = "oxygen_o2hb"
  phase = "study"
  date = { field = "daily_lbdat" }
  value = { field = "daily_hb_lborres", unit = "g/dL", source_unit = { field = "daily_hb_lborresu", values = { 2 = "g/dL", 1 = "g/L", 3 = "mg/dL" } } } # 4 = "mmol/L" but conversion is tricky

[[observation]]
  name = "oxygen_saturation_percent"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  value = { field = "oxy_vsorres", description = "Oxygen saturation on:" }

  [observation.context]
    combinedType = "set"
    excludeWhen = "none"
    fields = [
      { field = "oxy_vsorresu", description = "Oxygen saturation on:", values = { 1 = "room air", 2 = "oxygen therapy" } },
    ]

[[observation]]
  name = "oxygen_saturation_percent"
  phase = "study"
  date = { field = "daily_dsstdat" }
  value = { field = "daily_oxy_vsorres", description = "percentage oxygen saturation" }

[[observation]]
  name = "pao2_mmHg"
  phase = "study"
  date = { field = "daily_dsstdat" }
  value = { field = "daily_pao2_lborres", unit = "mmHg", source_unit = { field = "daily_pao2_lborresu", values = { 1 = "kPa", 2 = "mmHg" } } }

  [observation.context]
    combinedType = "set"
    excludeWhen = "none"
    fields = [
      { field = "daily_pao2_lbspec", values = { 1 = "Arterial", 2 = "Venous", 3 = "Capillary", 4 = "Unknown" } },
    ]

[[observation]]
  name = "pco2_mmHg"
  phase = "study"
  date = { field = "daily_dsstdat" }
  value = { field = "daily_pco2_lborres", unit = "mmHg", source_unit = { field = "daily_pco2_lborresu", values = { 1 = "kPa", 2 = "mmHg" } } }

[[observation]]
  name = "pH"
  phase = "study"
  date = { field = "daily_dsstdat" }
  value = { field = "daily_ph_lborres", description = "pH" }

[[observation]]
  name = "pneumonia"
  phase = "study"
  start_date = { ref = "admissionDateHierarchy" }
  date = { field = "dsstdtc" }
  duration_type = "event"
  is_present = { field = "viralpneu_ceterm", ref = "Y/N/NK" }
  context = ["viral"]

[[observation]]
  name = "pneumonia"
  phase = "study"
  start_date = { ref = "admissionDateHierarchy" }
  date = { field = "dsstdtc" }
  duration_type = "event"
  is_present = { field = "bactpneu_ceterm", ref = "Y/N/NK" }
  context = ["bacterial"]

[[observation]]
  name = "pneumonia"
  phase = "study"
  start_date = { ref = "admissionDateHierarchy" }
  date = { field = "dsstdtc" }
  duration_type = "event"
  is_present = { field = "cryptogenic_ceterm", ref = "Y/N/NK" }
  context = ["Cryptogenic organizing pneumonia (COP)"]

[[observation]]
  name = "respiratory_rate"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  value = { field = "rr_vsorres", description = "Respiratory rate in breath per minute. Record the highest respiratory rate documented on admission." }

[[observation]]
  name = "respiratory_rate"
  phase = "study"
  date = { field = "daily_dsstdat" }
  value = { field = "daily_rr_vsorres", description = "Respiratory rate in breath per minute. If both abnormal low and high rate observed, record the abnormally high rate." }

[[observation]]
  name = "richmond_agitation-sedation_scale"
  phase = "study"
  date = { field = "daily_dsstdat" }
  value = { field = "rass_vsorres", apply = { function = "getFloat" }, description = "RASS calculated between -5 and 4" }

[[observation]]
  name = "riker_sedation-agitation_scale"
  phase = "study"
  date = { field = "daily_dsstdat" }
  value = { field = "sas_vsorres", description = "SAS calculated between 1 and 7", "can_skip" = true }

[[observation]]
  name = "runny_nose"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "runnynose_ceoccur_v2", description = "Runny nose (Rhinorrhoea)", ref = "Y/N/NK" }

[[observation]]
  name = "seizures"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "seizures_cecoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "seizures"
  phase = "study"
  start_date = { ref = "admissionDateHierarchy" }
  date = { field = "dsstdtc" }
  duration_type = "event"
  is_present = { field = "seizure_ceterm", ref = "Y/N/NK" }

[[observation]]
  name = "seizures"
  phase = "followup"
  start_date = { field = "flw_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw_survey_date" }
  duration_type = "event"
  is_present = { field = "flw_seizures", ref = "Y/N/NK" }

[[observation]]
  name = "seizures"
  phase = "followup"
  start_date = { field = "flw2_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw2_survey_date" }
  duration_type = "event"
  is_present = { field = "flw2_seizures", values = { 1 = true, 0 = false } }

[[observation]]
  name = "severe_dehydration"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "dehydration_vsorres", description = "Severe dehydration:", ref = "Y/N/NK", "can_skip" = true }

[[observation]]
  name = "shortness_of_breath"
  phase = "followup"
  start_date = { field = "flw_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw_survey_date" }
  duration_type = "event"
  is_present = { field = "flw_short_breath", description = "Shortness of breath/breathlessness", values = { 1 = true, 0 = false } }

[[observation]]
  name = "shortness_of_breath"
  phase = "followup"
  start_date = { field = "flw2_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw2_survey_date" }
  duration_type = "event"
  is_present = { field = "flw2_short_breath", description = "Shortness of breath/breathlessness", values = { 1 = true, 0 = false } }

[[observation]]
  name = "shortness_of_breath"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "shortbreath_ceoccur_v2", description = "Shortness of breath (Dyspnea)", ref = "Y/N/NK" }

[[observation]]
  name = "skin_rash"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "rash_ceoccur_v2", description = "Skin rash", ref = "Y/N/NK" }

[[observation]]
  name = "skin_rash"
  phase = "followup"
  start_date = { field = "flw_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw_survey_date" }
  duration_type = "event"
  is_present = { field = "flw_skin_rash", description = "Skin rash", values = { 1 = true, 0 = false } }

[[observation]]
  name = "skin_rash"
  phase = "followup"
  start_date = { field = "flw2_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw2_survey_date" }
  duration_type = "event"
  is_present = { field = "flw2_skin_rash", description = "Skin rash", values = { 1 = true, 0 = false } }

[[observation]]
  name = "skin_ulcers"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "skinulcers_ceoccur_v2", description = "4a.20. Skin ulcer", ref = "Y/N/NK", "can_skip" = true }

[[observation]]
  name = "sore_throat"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "sorethroat_ceoccur_v2", description = "Sore throat", ref = "Y/N/NK" }

[[observation]]
  name = "sternal_capillary_refill_time_greater_2s"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "stercap_vsorres", description = "Sternal capillary refill time >2 seconds?", values = { 1 = true, 2 = false } }

[[observation]]
  name = "sternal_capillary_refill_time_greater_2s"
  phase = "study"
  date = { field = "daily_dsstdat" }
  is_present = { field = "daily_stercap_vsorres", values = { 1 = true, 2 = false, 0 = false } }

[[observation]]
  name = "systolic_blood_pressure_mmHg"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  value = { field = "sysbp_vsorres", source_unit = "mmHg" }

[[observation]]
  name = "systolic_blood_pressure_mmHg"
  phase = "study"
  date = { field = "daily_dsstdat" }
  value = { field = "systolic_vsorres", source_unit = "mmHg" }

[[observation]]
  name = "temperature_celsius"
  phase = "study"
  date = { field = "daily_dsstdat" }
  value = { field = "daily_temp_vsorres", unit = "degC", source_unit = { field = "daily_temp_vsorresu", values = { 1 = "degC", 2 = "degF" } } }
  context = ['Highest']

[[observation]]
  name = "temperature_celsius"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  value = { field = "temp_vsorres", unit = "degC", source_unit = { field = "temp_vsorresu", values = { 1 = "degC", 2 = "degF" } } }

[[observation]]
  name = "vomiting_nausea"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "vomit_ceoccur_v2", description = "Vomiting / Nausea", ref = "Y/N/NK" }

[[observation]]
  name = "vomiting_nausea"
  phase = "followup"
  start_date = { field = "flw_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw_survey_date" }
  duration_type = "event"
  is_present = { field = "flw_nausea", description = "Nausea/vomiting", values = { 1 = true, 0 = false } }

[[observation]]
  name = "vomiting_nausea"
  phase = "followup"
  start_date = { field = "flw_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw_survey_date" }
  duration_type = "event"
  is_present = { field = "flw_feeling_sick", description = "Nausea/vomiting", values = { 1 = true, 0 = false } }

[[observation]]
  name = "vomiting_nausea"
  phase = "followup"
  start_date = { field = "flw2_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw2_survey_date" }
  duration_type = "event"
  is_present = { field = "flw2_feeling_sick", description = "Feeling sick/vomiting", values = { 1 = true, 0 = false } }

[[observation]]
  name = "wheezing"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "wheeze_ceoccur_v2", description = "Wheezing", ref = "Y/N/NK", can_skip = true }

[[observation]]
  name = "fio2_percent"
  phase = "study"
  date = { field = "daily_dsstdat" }
  value = { field = "daily_fio2b_lborres", description = "%" }

[[observation]]
  name = "fio2_percent"
  phase = "study"
  date = { field = "daily_dsstdat" }
  value = { field = "daily_fio2_lborres", apply = { function = "Percentage" } }
