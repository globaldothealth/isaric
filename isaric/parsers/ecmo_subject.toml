#:schema ../../schemas/dev/parser.schema.json

[adtl]
  name = "isaric-ecmo"
  description = "ISARIC ECMO study"

  [adtl.defs."Y/N/NK".values]
    1 = true
    2 = false

  [adtl.defs.ethnicityMap.values]
    1 = "White"
    2 = "Arab"
    3 = "Black"
    4 = "East_Asian"
    5 = "South_Asian"
    6 = "West_Asian"
    7 = "Latin_American"

[adtl.defs.admissionDateHierarchy]
  combinedType = "firstNonNull"
  fields = [
    { field = "hostdat", description = "Admission date at this facility" },
    { field = "icu_hostdat", description = "Date of ICU admission" },
    { field = "f_dateicu", description = "Date Of ICU Admission" },              # eot_icu_admis	form
    { field = "ef_dateobs", description = "Date observation" },                  # eot_daily form - - is this date relevant?
    { field = "ctr_dateass_v2", description = "Date of Assessment" },            # coagulation form - - is this date relevant?
    { field = "ccm_a_dat", description = "DATE OF ASSESSMENT" },                 # critical_care_module
    { field = "ccm_b_icu_hodat", description = "ICU ADMISSION DATE" },           # critical_care_module
    { field = "c_ntpbnpdate", description = "Date of assessment" },              # cardiac form - is this date relevant?
    { field = "cestdat", description = "Onset date of first/earliest symptom" },
    { field = "dsstdat", description = "Date of enrolment" },
  ]

[adtl.defs.dailyDateHierarchy]
  combinedType = "firstNonNull"
  fields = [
    { field = "daily_dsstdat", description = "DATE OF ASSESSMENT" },
    { field = "daily_lbdat", description = "Date of assessment" },
  ]

[adtl.tables]
  study = { kind = "constant" }
  subject = { kind = "groupBy", groupBy = "subject_id", aggregation = "lastNotNull", schema = "../../schemas/dev/subject.schema.json" }
  # visit = { kind = "groupBy", groupBy = "visit_id", aggregation = "lastNotNull", schema = "../../schemas/dev/visit.schema.json" }
  observation = { kind = "oneToMany", schema = "../../schemas/dev/observation.schema.json", common = { visit_id = { field = "subjid", sensitive = true } } }

[study]
  id = "isaric-ecmo"
  country_iso3 = "GBR"

[subject]
  study_id = "ecmo"
  country_iso3 = "GBR"
  pathogen = "COVID-19"

  [subject.sex_at_birth]
    field = "sex"
    description = "Sex at Birth"
    values = { 1 = "male", 2 = "female", 3 = "non_binary" }

  [subject.subject_id]
    field = "subjid"
    sensitive = true
    description = "Participant Identification Number (PIN) specify CPMS Site code (hyphen) four to six digit number patient number e.g. Y0401-0001."

  [subject.enrolment_date]
    field = "dsstdat"
    description = "Date of Enrolment"

  [subject.admission_date]
    field = "hostdat"
    description = "Admission date at this facility"

  [subject.ethnicity] # TODO: need to add ethnic other field
    description = "Ethnic groups"
    combinedType = "list"
    excludeWhen = "none"
    fields = [
      { field = "ethnic___1", values = { 1 = "Arab" } },
      { field = "ethnic___2", values = { 1 = "Black" } },
      { field = "ethnic___3", values = { 1 = "East_Asian" } },
      { field = "ethnic___4", values = { 1 = "South_Asian" } },
      { field = "ethnic___5", values = { 1 = "West_Asian" } },
      { field = "ethnic___6", values = { 1 = "Latin_American" } },
      { field = "ethnic___7", values = { 1 = "White" } },
      { field = "ethnic___8", values = { 1 = "Aboriginal_First_Nations" } },
    ]

  [subject.works_microbiology_lab]
    field = "labwork_erterm"
    ref = "Y/N/NK"
    description = "Employed in a microbiology laboratory?"

  [subject.works_healthcare]
    field = "healthwork_erterm"
    ref = "Y/N/NK"
    description = "Employed as a healthcare worker?"

  [subject.age]
    combinedType = "firstNonNull"
    [[subject.age.fields]]
      field = "age_estimate10"
      unit = "years"
      description = "Calculated age in years"

    [[subject.age.fields]]
      field = "age_estimateyears"
      unit = "years"
      description = "Age/Estimated age"

      [subject.age.fields.source_unit]
        field = "age_estimateyearsu"
        values = { 1 = "months", 2 = "years", 3 = "days" }

[subject.pregnancy]
  field = "pregyn_rptestcd"
  ref = "Y/N/NK"
  description = "Pregnant?"

[subject.pregnancy_date_of_delivery]
  field = "dlvrdtc_rptestcd"
  description = "Delivery date"

[subject.pregnancy_birth_weight_kg]
  field = "apvs_weight"
  unit = "kg"
  description = "Birth weight"
  source_unit = { field = "apvs_weightu", values = { 1 = "kg", 2 = "lbs" } }

[subject.pregnancy_outcome]
  field = "pregout_rptestcd"
  description = "Pregnancy Outcome"
  values = { 1 = "Live birth", 2 = "Still birth" }

[subject.pregnancy_gestational_outcome]
  field = "apsc_gestout"
  description = "Gestational outcome"
  values = { 1 = "Term birth", 2 = "Preterm birth" }

[subject.pregnancy_whether_breastfed] # SK to check here!!
  combinedType = "any"
  description = "Breastfed"
  fields = [
    { field = "apsc_brfedind", ref = "Y/N/NK" },
    { field = "apsc_brfed", values = { 1 = true, 2 = true, 0 = false } },
  ]

[subject.pregnancy_post_partum]
  description = "Post Partum (within six weeks of delivery)"
  field = "postpart_rptestcd"
  values = { 1 = true, 0 = false }

[subject.pregnancy_gestational_assessment_weeks]
  field = "egestage_rptestcd"
  description = "Gestational weeks assessment"

[subject.has_chronic_hematologic_disease]
  field = "chronhaemo_mhyn"
  ref = "Y/N/NK"
  description = "Chronic hematologic disease"

[subject.has_asplenia]
  field = "asplenia_mhyn"
  ref = "Y/N/NK"
  description = "Asplenia"

[subject.has_tuberculosis]
  field = "tb_mhyn"
  ref = "Y/N/NK"
  description = "Tuberculosis"

[subject.has_dementia]
  field = "dementia_mhyn"
  ref = "Y/N/NK"
  description = "Dementia"

[subject.has_obesity]
  field = "obesity_mhyn"
  ref = "Y/N/NK"
  description = "Obesity (as defined by clinical staff)"

[subject.has_rheumatologic_disorder]
  field = "rheumatology_mhyr"
  ref = "Y/N/NK"
  description = "Rheumatologic disorder"

[subject.has_hiv]
  combinedType = "any"
  description = "AIDS/HIV"
  fields = [
    { field = "aidshiv_mhyn", ref = "Y/N/NK" },
    { field = "aidshiv_mhyn_2", values = { 1 = true, 2 = false, 4 = true } },
  ]

[subject.has_hypertension]
  field = "hypertension_mhyn"
  ref = "Y/N/NK"
  description = "Hypertension (physician diagnosed)"

[subject.has_malignant_neoplasm]
  field = "malignantneo_mhyn"
  ref = "Y/N/NK"
  description = "Malignant neoplasm"

[subject.has_smoking]
  field = "smoking_mhyn"
  values = { 1 = "yes", 2 = "never", 3 = "former" }

[subject.has_asthma]
  field = "asthma_mhyn"
  description = "Asthma (physician diagnosed)"
  values = { 1 = true, 0 = false }

[subject.has_chronic_cardiac_disease] # SK to check here!
  description = "Chronic cardiac disease, including congenital heart disease (not hypertension)"
  combinedType = "firstNonNull"
  fields = [
    { field = "chroniccard_mhyn", ref = "Y/N/NK", description = "Chronic cardiac disease" },
    # { field = "c_chd", values = { 1 = true, 0 = false }, description = "Congenital heart disease" },
    { field = "cardiomyopathy_ceterm", ref = "Y/N/NK", description = "Cardiomyopathy" },
    # { field = "c_pcmyo", values = { 1 = true, 0 = false }, description = "Pre-existing Cardiomyopathy" },
    # { field = "c_diagtak", values = { 1 = true, 0 = false }, description = "DIAGNOSIS OF TAKOTSUBO CARDIOMYOPATHY" },
  ]

[subject.has_chronic_kidney_disease]
  field = "renal_mhyn"
  ref = "Y/N/NK"
  description = "Chronic kidney disease"

[subject.has_diabetes] # NEED TO CHECK THIS!
  combinedType = "firstNonNull"
  fields = [
    # { field = "diabetes_spain", description = "Did the patient have diabetes?" },                 # this field has no values??!!!
    { field = "diabetiscomp_mhyn", ref = "Y/N/NK", description = "Diabetes with complications" },
    { field = "diabetes_mhyn", ref = "Y/N/NK", description = "Diabetes without complications" },
    { field = "diabetes_mhyn_2", values = { 1 = true, 2 = false, 4 = true, 5 = true } },          # based on diabetes type
  ]

[subject.diabetes_type]
  field = "diabetes_mhyn_2"
  description = "Diabetes and Type"
  values = { 1 = "type-1", 4 = "type-2", 5 = "gestational" }

[subject.has_liver_disease]
  combinedType = "any"
  fields = [
    { field = "modliver_mhyn", description = "Moderate liver disease", values = { 1 = true, 0 = false } },
    { field = "mildliv_mhyn", description = "Mild liver disease", values = { 1 = true, 0 = false } },
  ]

[subject.has_hiv_art]
  field = "aidshiv_mhyn_2"
  description = "patient is on ART (antiretroviral therapy)"
  values = { 1 = true, 2 = false, 4 = false }

[subject.has_immunosuppression_therapy_treatment]
  field = "pre_nonoralsteroid_cmoccur"
  ref = "Y/N/NK"
  description = "Other immunosuppressant agents (not oral steroids)"

  # [subject.has_solid_organ_transplant]  # None of the fields are available
  #   description = "Solid organ transplant recipients:"
  #   combinedType = "firstNonNull"
  #   fields = [
  #     { field = "f_lungt_yn", values = { 1 = true, 0 = false }, description = "Did this patient receive a lung transplant due to COVID-19 associated pulmonary complications?" },
  #     { field = "c_ptransplant", values = { 1 = true, 0 = false }, description = "Previous Cardiac transplant" },
  #   ]

[subject.date_death]
  combinedType = "firstNonNull"
  fields = [
    # { field = "f_datedeath", description = "Date of death", if = { dsterm = 4 } },
    { field = "dsstdtc", description = "Outcome date", if = { dsstdtcyn = 1 } },
  ]

[subject.icu_admitted]
  field = "icu_hoterm"
  description = "Admitted to ICU?"
  apply = { function = "isNotNull" } # WHAT DOES THIS DO?

[[observation]]
  name = "bleeding_haemorrhage"
  date = { ref = "admissionDateHierarchy" }
  phase = "admission"
  is_present = { field = "bleed_ceoccur_v2", ref = "Y/N/NK" }
  if = { bleed_ceoccur_v2 = { "!=" = 3 } }

[[observation]]
  name = "bleeding_haemorrhage"
  date = { ref = "admissionDateHierarchy" }
  phase = "admission"
  is_present = { field = "bleed_cetermy_v2", ref = "Y/N/NK" }
  if = { bleed_cetermy_v2 = { "!=" = 3 } }

[[observation]]
  name = "cough"
  date = { ref = "admissionDateHierarchy" }
  phase = "admission"
  is_present = { field = "cough_ceoccur_v2", ref = "Y/N/NK" }
  if = { cough_ceoccur_v2 = { "!=" = 3 } }

[[observation]]
  name = "cough"
  date = { ref = "admissionDateHierarchy" }
  phase = "admission"
  is_present = { field = "cough_ceoccur_v2_2", values = { 1 = true, 2 = true, 3 = true, 0 = false } }
  if = { cough_ceoccur_v2_2 = { "!=" = 4 } }
  # description = "Cough"

[[observation]]
  name = "avpu"
  date = { ref = "admissionDateHierarchy" }
  phase = "study"
  text = { field = "avpu_vsorres", values = { 1 = "Alert", 2 = "Verbal", 3 = "Pain", 4 = "Unresponsive" } }
  if = { avpu_vsorres = { "!=" = "" } }

[[observation]]
  name = "oxygen_saturation_percent"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  value = { field = "oxy_vsorres" }
  if = { oxy_vsyn = 1 }

  [observation.context]
    field = "oxy_vsorresu"
    description = "Oxygen saturation on:"
    values = { 1 = ["Room air"], 2 = ["Oxygen therapy"] }


[[observation]]
  name = "oxygen_saturation_percent"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  value = { field = "daily_oxy_vsorres" }
  if = { daily_oxy_vsyn = 1 }

[[observation]]
  name = "glasgow_coma_score"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  value = { field = "gcs_vsorres" }
  if = { gcs_vsyn = 1 }

[[observation]]
  name = "glasgow_coma_score"
  phase = "study"
  date = { ref = "admissionDateHierarchy" }
  value = { field = "daily_gcs_vsorres" }
  if = { daily_gcs_lbyn = 1 }
  #description = "Glasgow Coma Score (GCS/15)"

[[observation]]
  name = "conjunctivitis"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "conjunct_ceoccur_v2", ref = "Y/N/NK" }
  if = { conjunct_ceoccur_v2 = { "!=" = 3 } }

[[observation]]
  name = "malnutrition"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "malnutrition_mhyn", ref = "Y/N/NK" }
  if = { malnutrition_mhyn = { "!=" = 3 } }

[[observation]]
  name = "runny_nose"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "runnynose_ceoccur_v2", ref = "Y/N/NK" }
  if = { runnynose_ceoccur_v2 = { "!=" = 3 } }

[[observation]]
  name = "seizures"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "seizures_cecoccur_v2", ref = "Y/N/NK" }
  if = { seizures_cecoccur_v2 = { "!=" = 3 } }

[[observation]]
  name = "sore_throat"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "sorethroat_ceoccur_v2", ref = "Y/N/NK" }
  if = { sorethroat_ceoccur_v2 = { "!=" = 3 } }

[[observation]]
  name = "vomiting_nausea"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "vomit_ceoccur_v2", ref = "Y/N/NK" }
  if = { vomit_ceoccur_v2 = { "!=" = 3 } }

[[observation]]
  name = "wheezing"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "wheeze_ceoccur_v2", ref = "Y/N/NK" }
  if = { wheeze_ceoccur_v2 = { "!=" = 3 } }

[[observation]]
  name = "confusion"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "confusion_ceoccur_v2", ref = "Y/N/NK" }
  if = { confusion_ceoccur_v2 = { "!=" = 3 } }

[[observation]]
  name = "chest_pain"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "chestpain_ceoccur_v2", ref = "Y/N/NK" }
  if = { chestpain_ceoccur_v2 = { "!=" = 3 } }

[[observation]]
  name = "joint_pain"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "jointpain_ceoccur_v2", ref = "Y/N/NK" }
  if = { jointpain_ceoccur_v2 = { "!=" = 3 } }

[[observation]]
  name = "muscle_aches"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "myalgia_ceoccur_v2", ref = "Y/N/NK" }
  if = { myalgia_ceoccur_v2 = { "!=" = 3 } }

[[observation]]
  name = "lymphadenopathy"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "lymp_ceoccur_v2", ref = "Y/N/NK" }
  if = { lymp_ceoccur_v2 = { "!=" = 3 } }

[[observation]]
  name = "shortness_of_breath"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "shortbreath_ceoccur_v2", ref = "Y/N/NK" }
  if = { shortbreath_ceoccur_v2 = { "!=" = 3 } }

[[observation]]
  name = "abdominal_pain"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "abdopain_ceoccur_v2", ref = "Y/N/NK" }
  if = { abdopain_ceoccur_v2 = { "!=" = 3 } }

[[observation]]
  name = "diarrhoea"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "diarrhoea_ceoccur_v2", ref = "Y/N/NK" }
  if = { diarrhoea_ceoccur_v2 = { "!=" = 3 } }

[[observation]]
  name = "fatigue_malaise"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "fatigue_ceoccur_v2", ref = "Y/N/NK" }
  if = { fatigue_ceoccur_v2 = { "!=" = 3 } }

[[observation]]
  name = "headache"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "headache_ceoccur_v2", ref = "Y/N/NK" }
  if = { headache_ceoccur_v2 = { "!=" = 3 } }

[[observation]]
  name = "skin_rash"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "rash_ceoccur_v2", ref = "Y/N/NK" }
  if = { rash_ceoccur_v2 = { "!=" = 3 } }

[[observation]]
  name = "history_of_fever"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "fever_ceoccur_v2", ref = "Y/N/NK" }
  if = { fever_ceoccur_v2 = { "!=" = 3 } }

[[observation]]
  name = "cough_with_haemoptysis"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "coughhb_ceoccur_v2", ref = "Y/N/NK" }
  if = { coughhb_ceoccur_v2 = { "!=" = 3 } }

[[observation]]
  name = "cough_with_sputum_production"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "coughsput_ceoccur_v2", ref = "Y/N/NK" }
  if = { coughsput_ceoccur_v2 = { "!=" = 3 } }

[[observation]]
  name = "diastolic_blood_pressure_mmHg"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  value = { field = "admission_diabp_vsorres" }
  if = { diabp_vsyn = 1 }

[[observation]]
  name = "diastolic_blood_pressure_mmHg"
  phase = "study"
  date = { ref = "dailyDateHierarchy" }
  value = { field = "diastolic_vsorres" }
  if = { diastolic_vsyn = 1 }

[[observation]]
  name = "heart_rate_bpm"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  value = { field = "hr_vsorres" }
  if = { hr_vsyn = 1 }

[[observation]]
  name = "heart_rate_bpm"
  phase = "admission"
  date = { ref = "dailyDateHierarchy" }
  value = { field = "daily_hr_vsorres" }
  if = { daily_hr_vsyn = 1 }

[[observation]]
  name = "respiratory_rate"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  value = { field = "rr_vsorres" }
  if = { rr_vsyn = 1 }

[[observation]]
  name = "respiratory_rate"
  phase = "admission"
  date = { ref = "dailyDateHierarchy" }
  value = { field = "daily_rr_vsorres" }
  if = { daily_rr_vsyn = 1 }

[[observation]]
  name = "systolic_blood_pressure_mmHg"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  value = { field = "sysbp_vsorres" }
  if = { sysbp_vsyn = 1 }

[[observation]]
  name = "systolic_blood_pressure_mmHg"
  phase = "admission"
  date = { ref = "dailyDateHierarchy" }
  value = { field = "systolic_vsorres" }
  if = { systolic_vsyn = 1 }

[[observation]]
  name = "lower_chest_wall_indrawing"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "lowerchest_ceoccur_v2", ref = "Y/N/NK" }
  if = { lowerchest_ceoccur_v2 = { "!=" = 3 } }

[[observation]]
  name = "skin_ulcers"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "skinulcers_ceoccur_v2", ref = "Y/N/NK" }
  if = { skinulcers_ceoccur_v2 = { "!=" = 3 } }

[[observation]]
  name = "severe_dehydration"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "dehydration_vsorres", ref = "Y/N/NK" }
  if = { dehydration_vsorres = { "!=" = 2 } }

[[observation]]
  name = "sternal_capillary_refill_time_greater_2s"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "stercap_vsorres", ref = "Y/N/NK" }
  if = { stercap_vsorres = { "!=" = 3 } }

[[observation]]
  name = "sternal_capillary_refill_time_greater_2s"
  phase = "admission"
  date = { ref = "dailyDateHierarchy" }
  is_present = { field = "daily_stercap_vsorres", values = { 1 = true, 0 = false } }
  if = { daily_stercap_vsorres = { "!=" = 3 } }

[[observation]]
  name = "loss_of_smell"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "anosmia_ceoccur_v2", ref = "Y/N/NK" }
  if = { anosmia_ceoccur_v2 = { "!=" = 3 } }

[[observation]]
  name = "loss_of_taste"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "ageusia_ceoccur_v2", ref = "Y/N/NK" }
  if = { ageusia_ceoccur_v2 = { "!=" = 3 } }

[[observation]]
  name = "inability_to_walk"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "inablewalk_ceoccur_v2", ref = "Y/N/NK" }
  if = { inablewalk_ceoccur_v2 = { "!=" = 3 } }

[[observation]]
  name = "clinical_frailty_score"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" } # this is in the critical_care_module
  value = { field = "ccm_b_cfs_rsorres" }
  if = { ccm_b_cfs_rsyn = 1 }

[[observation]]
  name = "renal_replacement_therapy_dialysis"
  phase = "study"
  date = { ref = "admissionDateHierarchy" }            # date in the treatment form? ..
  is_present = { field = "rrt_prtrt", ref = "Y/N/NK" }
  if = { overall_rrt_prtrt = { "!=" = 3 } }

[[observation]]
  name = "renal_replacement_therapy_dialysis"
  phase = "study"
  date = { ref = "dailyDateHierarchy" }
  is_present = { field = "daily_rrt_cmtrt", ref = "Y/N/NK" }
  if = { daily_rrt_cmtrt = { "!=" = 3 } }

[[observation]]
  name = "renal_replacement_therapy_dialysis"
  phase = "study"                                          # in the outcome form
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "renal_proccur", ref = "Y/N/NK" }
  if = { renal_proccur = { "!=" = 3 } }

[[observation]]
  name = "renal_replacement_therapy_dialysis"
  phase = "study"
  date = { ref = "admissionDateHierarchy" }                    # in the critical_care_module form
  is_present = { field = "ccm_b_renal_prtrt", ref = "Y/N/NK" }
  if = { ccm_b_renal_prtrt = { "!=" = 3 } }

[[observation]] # not sure if this mapping (below) needs to be there ..
  name = "renal_replacement_therapy_dialysis"
  phase = "study"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "k_dicuddial", values = { 1 = true, 0 = false } }
  if = { k_dicuddial = { "!=" = "" } }
  # description = "Is this patient still dialysis dependent at ICU discharge?"

[[observation]] # not sure if this mapping (below) needs to be there ..
  name = "renal_replacement_therapy_dialysis"
  phase = "study"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "k_dhosddial", values = { 1 = true, 0 = false } }
  if = { k_dhosddia = { "!=" = "" } }
  # description = "Is this patient still dialysis dependent at Hospital discharge?"

[[observation]]
  name = "temperature_celsius"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  value = { field = "temp_vsorres", source_unit = { field = "temp_vsorresu", values = { 1 = "°C", 2 = "°F" } } }
  if = { temp_vsyn = 1 }

[[observation]]
  name = "temperature_celsius"
  phase = "study"
  date = { ref = "dailyDateHierarchy" }
  value = { field = "daily_temp_vsorres", source_unit = { field = "daily_temp_vsorresu", values = { 1 = "°C", 2 = "°F" } } }
  if = { daily_temp_vsyn = 1 }

[[observation]]
  name = "pao2"
  phase = "study"
  date = { ref = "dailyDateHierarchy" }
  value = { field = "daily_pao2_lborres", source_unit = { field = "daily_pao2_lborresu", values = { 1 = "kPa", 2 = "mmHg" }, description = "PaO2 unit" } }
  if = { daily_pao2_lbyn = 1 }

[[observation]]
  name = "mean_arterial_blood_pressure_mmHg"
  phase = "study"
  date = { ref = "dailyDateHierarchy" }
  value = { field = "daily_meanart_vsorres" }
  if = { daily_meanart_lbyn = 1 }

[[observation]]
  name = "pH"
  phase = "study"
  date = { ref = "dailyDateHierarchy" }
  value = { field = "daily_ph_lborres" }
  if = { daily_ph_lbyn = 1 }

[[observation]]
  name = "pao2_sample_type"
  phase = "study"
  date = { ref = "dailyDateHierarchy" }
  value = { field = "daily_pao2_lbspec", values = { 1 = "Arterial", 2 = "Venous", 3 = "Capillary" } }
  if = { daily_pao2_lbyn = 1 }

[[observation]]
  name = "base_excess"
  phase = "study"
  date = { ref = "dailyDateHierarchy" }
  is_present = { field = "daily_baseex_lborres" }
  if = { daily_baseex_lbyn = 1 }

[[observation]]
  name = "richmond_agitation-sedation_scale"
  phase = "study"
  date = { ref = "dailyDateHierarchy" }
  is_present = { field = "rass_vsorres" }
  if = { rass_vsyn = 1 }

[[observation]]
  name = "riker_sedation-agitation_scale"
  phase = "study"
  date = { ref = "dailyDateHierarchy" }
  is_present = { field = "sas_vsorres" }
  if = { rass_sas_vsyn = 4 }

[[observation]]
  name = "neuromuscular_blocking_agents"                       # should this be in the visit table - it's a treatment ..
  phase = "study"
  date = { ref = "dailyDateHierarchy" }
  is_present = { field = "daily_neuro_cmtrt", ref = "Y/N/NK" }
  if = { rass_sas_vsyn = 4 }

  # TO DO: combinedType for 'daily date'
