#:schema ../../schemas/dev/parser.schema.json

[adtl]
  name = "washington"
  description = "COVID-19 patient data for ISARIC in SCCM VIRUS format, University of Washington Medical Center Northwest"

  [adtl.tables.subject]
    kind = "groupBy"
    groupBy = "subject_id"
    aggregation = "lastNotNull"
    schema = "../../schemas/dev/subject.schema.json"

  [adtl.tables.visit]
    kind = "groupBy"
    groupBy = "visit_id"
    aggregation = "lastNotNull"
    schema = "../../schemas/dev/visit.schema.json"

  [adtl.tables.observation]
    kind = "oneToMany"
    aggregation = "lastNotNull"
    schema = "../../schemas/dev/observation.schema.json"
    common = { visit_id = { field = "patient_study_id", sensitive = true } }

[adtl.defs]
  "Y/N" = { values = { 0 = false, 1 = true } }

  [adtl.defs.countryMap.values]
    1 = "USA"
    2 = "ARG"
    3 = "BEL"
    4 = "BOL"
    5 = "BIH"
    6 = "CAN"
    7 = "CHN"
    8 = "HVR"
    9 = "DOM"
    10 = "FRA"
    11 = "DEU"
    12 = "GRC"
    13 = "IND"
    14 = "IRN"
    15 = "ITA"
    16 = "JPN"
    17 = "LBN"
    18 = "LBY"
    19 = "MEX"
    20 = "PAK"
    21 = "PER"
    22 = "PHL"
    23 = "SAU"
    24 = "SRB"
    25 = "KOR"
    26 = "ESP"
    27 = "ESP"
    28 = "TUR"
    29 = "ARE"
    30 = "UGA"
    # 51 = "Other"

[subject]
  pathogen = "COVID-19"

  [subject.subject_id]
    # field = "patient_study_id"
    field = "icu_id" # The ID needs to be on every row for this to work - the ICU ID is the one that repeats, so has been chosen here.
    sensitive = true

  [subject.enrolment_date] # optional field
    field = "date_filling_first_form"

  [subject.earliest_admission_date]
    field = "ADMIT DATE"

  [subject.age] # need fixing here for age '>90' to consider a character ..
    field = "age"
    # no age unit?

    # [subject.dob_year]
    #   field = "age"
    #   apply = { function = "startYear", params = ["$ADMIT DATE", 2022] }

  [subject.sex_at_birth] # this is just 'sex' in the CRF - you can't be trans at birth, maybe we need some nuance here/ a different 'current_sex' variable or similar
    field = "sex"
    values = { 1 = "male", 2 = "female", 3 = "intersex" } #, 4 = "transgender"

  [subject.ethnicity]
    combinedType = "set"
    excludeWhen = "none"
    fields = [
      { field = "race", values = { 1 = "American Indian or Alaska Native", 2 = "Asian American", 3 = "Black or African American", 4 = "Native Hawaiian or Other Pacific Islander", 5 = "White Caucasian", 7 = "East Asian (China, Hongkong, Japan, S. Korea etc.)", 8 = "South Asian (India, Pakistan, Sri Lanka etc.)", 9 = "West Asian (including Arabic)", 10 = "South East Asian (Philippines, Thailand, Malaysia, Singapore, VietNam etc.)", 11 = "Mixed Race", 12 = "Unknown", 6 = "Other" } },
    ]

  [subject.pregnancy]
    field = "prgnant"
    ref = "Y/N"

  [subject.pregnancy_gestational_age_weeks]
    field = "gestational_age"

  [subject.works_microbiology_lab]
    field = "employed_as_a_healthcare_w"
    description = "Patient Employed as a Healthcare Worker or in a Microbiology Laboratory?"
    ref = "Y/N"

  [subject.works_healthcare]
    field = "employed_as_a_healthcare_w"
    description = "Patient Employed as a Healthcare Worker or in a Microbiology Laboratory?"
    ref = "Y/N"

  [subject.has_tuberculosis]
    field = "any_other_pos___4"
    ref = "Y/N"

  [subject.has_dementia]
    field = "comorbidities___34"
    ref = "Y/N"

  [subject.has_obesity]
    field = "comorbidities___30"
    ref = "Y/N"

  [subject.has_hiv]
    combinedType = "any"
    fields = [
      { field = "comorbidities___22", ref = "Y/N" },
      { field = "any_other_pos___1", ref = "Y/N" },
    ]

  [subject.has_hypertension]
    field = "comorbidities___3"
    ref = "Y/N"

  [subject.has_malignant_neoplasm]
    field = "comorbidities___20"
    ref = "Y/N"

  [subject.has_smoking]
    combinedType = "firstNonNull"
    excludeWhen = "none"
    fields = [
      { field = "social_history___1", values = { 1 = "yes" } },
      { field = "social_history___2", values = { 1 = "former" } },
    ]

  [subject.has_asthma]
    field = "comorbidities___8"
    ref = "Y/N"

  [subject.has_chronic_kidney_disease]
    field = "comorbidities___10"
    ref = "Y/N"

  [subject.has_chronic_cardiac_disease]
    combinedType = "any"
    fields = [
      { field = "comorbidities___2", ref = "Y/N", description = "Coronary artery disease" },
      { field = "comorbidities___4", ref = "Y/N", description = "Cardiac arrhythmia" },
      { field = "comorbidities___5", ref = "Y/N", description = "Congestive heart failure" },
      { field = "comorbidities___6", ref = "Y/N", description = "Valvular heart disease" },
    ]

  [subject.has_chronic_respiratory_disease]
    field = "comorbidities___7"
    ref = "Y/N"

  [subject.has_rheumatologic_disorder]
    field = "comorbidities___25"
    ref = "Y/N"

  [subject.has_diabetes]
    field = "comorbidities___12"
    ref = "Y/N"

  [subject.diabetes_type]
    combinedType = "firstNonNull"
    fields = [
      { field = "type_of_diabetes___1", values = { 1 = "type-1" } },
      { field = "type_of_diabetes___2", values = { 1 = "type-2" } },
      { field = "type_of_diabetes___3", values = { 1 = "gestational" } },
    ]

  [subject.has_liver_disease]
    field = "comorbidities___14"
    ref = "Y/N"

  [subject.has_malnutrition]
    field = "comorbidities___29"
    ref = "Y/N"

  [subject.has_solid_organ_transplant]
    field = "comorbidities___21"
    ref = "Y/N"

  [subject.has_hiv_art]
    field = "pre_hospital_medication___3"
    ref = "Y/N"

  [subject.has_immunosuppression]
    field = "comorbidities___22"
    ref = "Y/N"

  [subject.has_died]
    combinedType = "any"
    fields = [
      { field = "hosp_status", description = "Hospital discharge status?", values = { 1 = true, 0 = false } },
      { field = "mort_28_days", description = "28 day mortality?", values = { 1 = true, 0 = false } },
    ]

  [subject.date_death]
    field = "ADMIT DATE"
    apply = { function = "endDate", params = ["$hospital_los"] }
    if = { hosp_status = 1 }

  [subject.icu_admitted]
    field = "admitted_to_icu"
    ref = "Y/N"

[visit]

  [visit.visit_id]
    # field = "patient_study_id"
    field = "icu_id"
    sensitive = true

  [visit.subject_id]
    # field = "patient_study_id"
    field = "icu_id"
    sensitive = true

  [visit.country_iso3]
    field = "country"
    ref = "countryMap"

  [visit.start_date]
    field = "ADMIT DATE"

  [visit.icu_admission]
    combinedType = "any"
    fields = [
      { field = "admitted_to_icu", ref = "Y/N" },
      { field = "is_patient_admitted_to_icu", ref = "Y/N" },
    ]

  [visit.icu_admission_dates] # calculated from admission date + hospital day - CHECK IF THIS IS CORRECT?
    combinedType = "set"
    excludeWhen = "none"
    fields = [
      { field = "ADMIT DATE", description = "icu admission date calculated from admission and hospital day", apply = { function = "endDate", params = [
        "$day_to_icu",
      ] } },
    ]

  [visit.transfer_from_other_facility]
    field = "hospital_admission_source"
    values = { 5 = true }

  [visit.pathogen_test_date]
    field = "covid19_test_date"

  [visit.treatment_inotropes_vasopressors]
    field = "types_of_vasopressors___10"
    ref = "Y/N"

  [visit.treatment_ecmo]
    field = "treatment_events___5"
    ref = "Y/N"

  [visit.treatment_corticosteroid]
    field = "medications___4"
    ref = "Y/N"

  [visit.treatment_corticosteroid_type] # text field
    field = "steroid_name_dose"
    description = "Please specify the corticosteroid name and dose"

  [visit.treatment_oxygen_therapy] # check this!
    combinedType = "any"
    excludeWhen = "none"
    fields = [
      { field = "oxygenation___1", ref = "Y/N" },
      { field = "oxygenation___2", ref = "Y/N" },
      { field = "oxygenation___3", ref = "Y/N" },
      { field = "oxygenation___4", ref = "Y/N" },
      { field = "oxygenation___5", ref = "Y/N" },
      { field = "oxygenation___6", ref = "Y/N" },
      { field = "oxygenation___11", ref = "Y/N" },
      { field = "oxygenation_methods_2___1", ref = "Y/N" },
      { field = "oxygenation_methods_2___2", ref = "Y/N" },
      { field = "oxygenation_methods_2___3", ref = "Y/N" },
    ]

  [visit.treatment_oxygen_mask_prongs]
    combinedType = "any"
    fields = [
      { field = "oxygenation___4", ref = "Y/N" },
      { field = "oxygenation___5", ref = "Y/N" },
      { field = "oxygenation___6", ref = "Y/N" },
    ]

  [visit.treatment_prone_position]
    field = "treatment_events___1"
    ref = "Y/N"

  [visit.treatment_invasive_ventilation]
    combinedType = "any"
    fields = [
      { field = "oxygenation___2", ref = "Y/N" },
      { field = "oxygenation_methods_2___1", ref = "Y/N" },
    ]

  [visit.treatment_antifungal_agent]
    field = "medications___1"
    ref = "Y/N"

  [visit.treatment_antivirals]
    field = "medications___2"
    ref = "Y/N"

  [visit.treatment_antiviral_type]
    description = "Type of antiviral(s) used"
    combinedType = "set"
    excludeWhen = "none"
    fields = [
      { field = "name_of_antiviral___1", values = { 1 = "Interferon alpha" } },
      { field = "name_of_antiviral___2", values = { 1 = "Interferon beta" } },
      { field = "name_of_antiviral___3", values = { 1 = "Lopinavir" } },
      { field = "name_of_antiviral___4", values = { 1 = "Neuraminidase inhibitor" } },
      { field = "name_of_antiviral___5", values = { 1 = "Remdesivir" } },
      { field = "name_of_antiviral___6", values = { 1 = "Ribavirin" } },
      { field = "name_of_antiviral___7", values = { 1 = "Ritonavir" } },
      { field = "name_of_antiviral___8", values = { 1 = "Other" } },
    ]

  [visit.treatment_antibiotics]
    field = "medications___9"
    ref = "Y/N"

  [visit.treatment_anticoagulation]
    combinedType = "any"
    fields = [
      { field = "anticoagulation_category___2", ref = "Y/N" },
      { field = "anticoagulation_category___3", ref = "Y/N" },
      { field = "anticoagulation_category___4", ref = "Y/N" },
      { field = "anticoagulation_category___5", ref = "Y/N" },
      { field = "anticoagulation_category___6", ref = "Y/N" },
      { field = "anticoagulation_category___7", ref = "Y/N" },
      { field = "anticoagulation_category___8", ref = "Y/N" },
      { field = "anticoagulation_category___9", ref = "Y/N" },
      { field = "anticoagulation_category___10", ref = "Y/N" },
      { field = "anticoagulation_category___11", ref = "Y/N" },
      { field = "anticoagulation_category___12", ref = "Y/N" },
      { field = "anticoagulation_category___13", ref = "Y/N" },
      { field = "anticoagulation_category___14", ref = "Y/N" },
      { field = "anticoagulation_category___21", ref = "Y/N" },
      { field = "medications___8", ref = "Y/N" },
    ]


  [visit.treatment_inhaled_nitric_oxide]
    field = "treatment_events___2"
    ref = "Y/N"

  [visit.treatment_noninvasive_ventilation]
    combinedType = "any"
    fields = [
      { field = "oxygenation___3", ref = "Y/N" },
      { field = "oxygenation_methods_2___2", ref = "Y/N" },
    ]

  [visit.treatment_high_flow_nasal_cannula]
    combinedType = "any"
    fields = [
      { field = "oxygenation___1", ref = "Y/N" },
      { field = "oxygenation_methods_2___3", ref = "Y/N" },
    ]
  [visit.treatment_steroids]
    field = "medications___16"
    ref = "Y/N"

  [visit.treatment_intravenous_fluids]
    field = "totak_iv_fluid"

  [visit.treatment_nsaid]
    field = "medications___16"
    ref = "Y/N"

  [visit.treatment_neuromuscular_blocking_agents]
    combinedType = "any"
    fields = [
      { field = "nmb_given", description = "NeuroMuscular Blockers (NMB) Given?", values = { 0 = false, 1 = true, 2 = true, 3 = true, 4 = true, 5 = true, 6 = true, 7 = true } },
      { field = "icu_level_care___7", ref = "Y/N" },
    ]

  [visit.treatment_cpr] # not sure about this!
    field = "good_death___1"
    ref = "Y/N"

    # [visit.treatment_tocilizumab]
    #   field = "mis_medications___1"
    #   ref = "Y/N"

  [visit.treatment_immunoglobulins]
    field = "blood_products___6"
    ref = "Y/N"

  [visit.treatment_dialysis]
    field = "crrt_duration"
    apply = { function = "isNotNull" }

  [visit.outcome]
    field = "hosp_status"
    description = "Discharged alive or dead"
    values = { 1 = "death", 0 = "discharged" }

  [visit.date_outcome] # calculate: hospital length of stay (hospital_los) + the admission date - CHECK THIS!
    field = "ADMIT DATE"
    description = "outcome date calculated from admission and hospital los"
    apply = { function = "endDate", params = ["$hospital_los"] }


[[observation]]
  name = "avpu"
  date = { field = "ADMIT DATE", apply = { function = "endDate", params = [
    "$hospital_day_core_e1",
  ] } }
  phase = "study"

  [observation.text]
    combinedType = "firstNonNull"
    fields = [
      { field = "avpu_score_v2___1", values = { 1 = "Alert" } },
      { field = "avpu_score_v2___2", values = { 1 = "Verbal" } },
      { field = "avpu_score_v2___3", values = { 1 = "Pain" } },
      { field = "avpu_score_v2___4", values = { 1 = "Unresponsive" } },
    ]

[[observation]]
  name = "diastolic_blood_pressure_mmHg"
  date = { field = "ADMIT DATE", apply = { function = "endDate", params = [
    "$hospital_day_core_e1",
  ] } }
  phase = "study"
  value = { field = "dbp_echo" }

[[observation]]
  name = "pao2_mmHg"
  date = { field = "ADMIT DATE", apply = { function = "endDate", params = [
    "$hospital_day_core_e1",
  ] } }
  phase = "study"
  value = { field = "pao2_at_time_of_fio2_above" }
  context = ["Arterial", "Same blood gas record"]

[[observation]]
  name = "pco2_mmHg"
  date = { field = "ADMIT DATE", apply = { function = "endDate", params = [
    "$hospital_day_core_e1",
  ] } }
  phase = "study"
  value = { field = "pco2_from_same_blood_gas_r" }
  context = ["Same blood gas record"]

[[observation]]
  name = "pH"
  date = { field = "ADMIT DATE", apply = { function = "endDate", params = [
    "hospital_day_core_e1",
  ] } }
  phase = "study"
  value = { field = "ph_from_same_blood_gas_rec" }
  context = ["Same blood gas record"]

[[observation]]
  name = "pao2_mmHg"
  date = { field = "ADMIT DATE", apply = { function = "endDate", params = [
    "$hospital_day_core_e2",
  ] } }
  phase = "study"
  value = { field = "pao2_lowest_plods2", source_unit = "mmHg" }
  context = ["Lowest daily reading"]

[[observation]]
  name = "glasgow_coma_score"
  date = { field = "ADMIT DATE", apply = { function = "endDate", params = [
    "$hospital_day_core_e2",
  ] } }
  phase = "study"
  value = { field = "gcs_lowest_plods2" }
  context = ["Lowest daily score"]

[[observation]]
  name = "abdominal_pain"
  date = { field = "ADMIT DATE" }
  phase = "admission"
  is_present = { field = "signs_and_symptoms_at_hosp___1", ref = "Y/N" }

[[observation]]
  name = "altered_consciousness_confusion"
  date = { field = "ADMIT DATE" }
  phase = "admission"
  is_present = { field = "signs_and_symptoms_at_hosp___8", ref = "Y/N" }

[[observation]]
  name = "anorexia"
  date = { field = "ADMIT DATE" }
  phase = "admission"
  is_present = { field = "signs_and_symptoms_at_hosp___3", ref = "Y/N" }

[[observation]]
  name = "chest_pain"
  date = { field = "ADMIT DATE" }
  phase = "admission"
  is_present = { field = "signs_and_symptoms_at_hosp___6", ref = "Y/N" }

[[observation]]
  name = "confusion"
  date = { field = "ADMIT DATE" }
  phase = "admission"
  is_present = { field = "signs_and_symptoms_at_hosp___8", ref = "Y/N" }

[[observation]]
  name = "conjunctivitis"
  date = { field = "ADMIT DATE" }
  phase = "admission"
  is_present = { field = "signs_and_symptoms_at_hosp___9", ref = "Y/N" }

[[observation]]
  name = "cough"
  date = { field = "ADMIT DATE" }
  phase = "admission"

  [observation.is_present]
    combinedType = "any"
    fields = [
      { field = "signs_and_symptoms_at_hosp___10", ref = "Y/N" },
      { field = "signs_and_symptoms_at_hosp___11", ref = "Y/N" },
    ]

[[observation]]
  name = "cough_dry"
  date = { field = "ADMIT DATE" }
  phase = "admission"
  is_present = { field = "signs_and_symptoms_at_hosp___10", ref = "Y/N" }

[[observation]]
  name = "cough_with_sputum_production"
  date = { field = "ADMIT DATE" }
  phase = "admission"
  is_present = { field = "signs_and_symptoms_at_hosp___11", ref = "Y/N" }

[[observation]]
  name = "diarrhoea"
  date = { field = "ADMIT DATE" }
  phase = "admission"
  is_present = { field = "signs_and_symptoms_at_hosp___12", ref = "Y/N" }

[[observation]]
  name = "fatigue_malaise"
  date = { field = "ADMIT DATE" }
  phase = "admission"
  is_present = { field = "signs_and_symptoms_at_hosp___18", ref = "Y/N" }

[[observation]]
  name = "headache"
  date = { field = "ADMIT DATE" }
  phase = "admission"
  is_present = { field = "signs_and_symptoms_at_hosp___16", ref = "Y/N" }

[[observation]]
  name = "hepatomegaly"
  start_date = { field = "ADMIT DATE" }
  date = { field = "ADMIT DATE", apply = { function = "endDate", params = [
    "$hospital_los",
  ] } }
  duration_type = "event"
  phase = "study"
  is_present = { field = "complications___19", ref = "Y/N" }

[[observation]]
  name = "history_of_fever"
  date = { field = "ADMIT DATE" }
  phase = "admission"
  is_present = { field = "signs_and_symptoms_at_hosp___15", ref = "Y/N" }

[[observation]]
  name = "loss_of_smell"
  date = { field = "ADMIT DATE" }
  phase = "admission"
  is_present = { field = "signs_and_symptoms_at_hosp___4", ref = "Y/N" }

[[observation]]
  name = "loss_of_taste"
  date = { field = "ADMIT DATE" }
  phase = "admission"
  is_present = { field = "signs_and_symptoms_at_hosp___2", ref = "Y/N" }

[[observation]]
  name = "lymphadenopathy"
  date = { field = "ADMIT DATE" }
  phase = "admission"
  is_present = { field = "signs_and_symptoms_at_hosp___27", ref = "Y/N" }

[[observation]]
  name = "muscle_aches"
  date = { field = "ADMIT DATE" }
  phase = "admission"
  is_present = { field = "signs_and_symptoms_at_hosp___19", ref = "Y/N" }

[[observation]]
  name = "seizures"
  date = { field = "ADMIT DATE" }
  phase = "admission"
  is_present = { field = "signs_and_symptoms_at_hosp___23", ref = "Y/N" }

[[observation]]
  name = "shortness_of_breath"
  date = { field = "ADMIT DATE" }
  phase = "admission"
  is_present = { field = "signs_and_symptoms_at_hosp___14", ref = "Y/N" }

[[observation]]
  name = "skin_rash"
  date = { field = "ADMIT DATE" }
  phase = "admission"
  is_present = { field = "signs_and_symptoms_at_hosp___26", ref = "Y/N" }

[[observation]]
  name = "sore_throat"
  date = { field = "ADMIT DATE" }
  phase = "admission"
  is_present = { field = "signs_and_symptoms_at_hosp___25", ref = "Y/N" }

[[observation]]
  name = "vomiting_nausea"
  date = { field = "ADMIT DATE" }
  phase = "admission"
  is_present = { field = "signs_and_symptoms_at_hosp___21", ref = "Y/N" }

[[observation]]
  name = "runny_nose"
  date = { field = "ADMIT DATE" }
  phase = "admission"
  is_present = { field = "signs_and_symptoms_at_hosp___20", ref = "Y/N" }

[[observation]]
  name = "heart_rate_bpm"
  date = { field = "ADMIT DATE", apply = { function = "endDate", params = [
    "hospital_day_core_e1",
  ] } }
  phase = "study"
  value = { field = "heart_rate_highest" }

[[observation]]
  name = "heart_rate_bpm"
  date = { field = "ADMIT DATE", apply = { function = "endDate", params = [
    "hospital_day_core_e1",
  ] } }
  phase = "study"
  value = { field = "heart_rate_lo" }

[[observation]] # there are other fields with arterial blood pressure
  name = "mean_arterial_blood_pressure_mmHg"
  date = { field = "ADMIT DATE", apply = { function = "endDate", params = [
    "hospital_day_core_e2",
  ] }, source_unit = "mmHg" }
  phase = "study"
  value = { field = "map_low_plods2" }
  context = ['Lowest daily value']

[[observation]] # check this!!!
  name = "other_symptom"
  date = { field = "ADMIT DATE" }
  phase = "admission"
  text = { field = "signs_symptoms_others" }

[[observation]]
  name = "oxygen_saturation_percent"
  date = { field = "ADMIT DATE", apply = { function = "endDate", params = [
    "hospital_day_core_e1",
  ] } }
  phase = "study"
  value = { field = "oxygen_saturation_spo2_v2" }

[[observation]]
  name = "respiratory_rate"
  date = { field = "ADMIT DATE", apply = { function = "endDate", params = [
    "hospital_day_core_e1",
  ] } }
  phase = "study"
  value = { field = "rr" }

[[observation]]
  name = "respiratory_rate"
  date = { field = "ADMIT DATE", apply = { function = "endDate", params = [
    "hospital_day_core_e1",
  ] } }
  phase = "study"
  value = { field = "rr_lo" }

[[observation]]
  name = "richmond_agitation-sedation_scale"
  date = { field = "ADMIT DATE", apply = { function = "endDate", params = [
    "hospital_day_core_e1",
  ] } }
  phase = "study"
  value = { field = "richmond_agitation_sedatio_v2" }

[[observation]]
  name = "riker_sedation-agitation_scale"
  date = { field = "ADMIT DATE", apply = { function = "endDate", params = [
    "hospital_day_core_e1",
  ] } }
  phase = "study"
  value = { field = "riker_sedation_agitation_s_v2" }

[[observation]]
  name = "systolic_blood_pressure_mmHg"
  date = { field = "ADMIT DATE", apply = { function = "endDate", params = [
    "hospital_day_core_e1",
  ] } }
  phase = "study"
  value = { field = "sbp_echo" }

[[observation]]
  name = "temperature_celsius"
  date = { field = "ADMIT DATE", apply = { function = "endDate", params = [
    "hospital_day_core_e1",
  ] } }
  phase = "study"
  value = { field = "temperature", values = { 1 = "≤37·3°C", 2 = "37·3-38.0°C", 3 = "38.1-39.0°C", 4 = ">39.0°C" } }

[[observation]]
  name = "temperature_celsius"
  date = { field = "ADMIT DATE", apply = { function = "endDate", params = [
    "hospital_day_core_e1",
  ] } }
  phase = "study"
  value = { field = "temperature_lo", values = { 1 = "≤37·3°C", 2 = "37·3-38.0°C", 3 = "38.1-39.0°C", 4 = ">39.0°C" } }

[[observation]]
  name = "total_fluid_output_ml"
  date = { field = "ADMIT DATE", apply = { function = "endDate", params = [
    "hospital_day_core_e1",
  ] } }
  phase = "study"
  value = { field = "uo_v2" }

[[observation]]
  name = "oxygen_o2hb"
  date = { field = "ADMIT DATE", apply = { function = "endDate", params = [
    "hospital_day_core_e1",
  ] } }
  phase = "study"
  value = { field = "haemoglobin" }

[[observation]]
  name = "pneumonia"
  start_date = { field = "ADMIT DATE" }
  date = { field = "ADMIT DATE", apply = { function = "endDate", params = [
    "$hospital_los",
  ] } }
  duration_type = "event"
  phase = "study"
  is_present = { field = "complications___5", ref = "Y/N" }
  context = ['bacterial']

[[observation]]
  name = "pneumonia"
  start_date = { field = "ADMIT DATE" }
  date = { field = "ADMIT DATE", apply = { function = "endDate", params = [
    "$hospital_los",
  ] } }
  duration_type = "event"
  phase = "study"
  is_present = { field = "complications___14", ref = "Y/N" }
  context = ['COP']
