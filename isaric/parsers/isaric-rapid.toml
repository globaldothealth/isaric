#:schema ../../schemas/dev/parser.schema.json

[adtl]
  name = "isaric-rapid"
  description = "ISARIC RAPID study"

  [adtl.defs."Y/N/NK".values]
    1 = true
    2 = false

  [adtl.defs.ethnicityMap.values]
    1 = "White"
    2 = "Arab"
    3 = "Black"
    4 = "East_Asian"
    5 = "South_Asian"
    6 = "West_Asian"
    7 = "Latin_American"

  [adtl.defs.inabilityWalk.values]
    1 = 1 # "No difficulty"
    2 = 2 # "Some difficulty"
    3 = 2 # "Some difficulty"
    4 = 3 # "Lots of difficulty"
    5 = 4 # "Unable to walk"

  [adtl.defs.countryMap.values]
    1 = "AFG"
    2 = "ALB"
    3 = "DZA"
    4 = "AND"
    5 = "AGO"
    6 = "ATG"
    7 = "ARG"
    8 = "ARM"
    9 = "AUS"
    10 = "AUT"
    11 = "AZE"
    12 = "BHS"
    13 = "BHR"
    14 = "BGD"
    15 = "BRB"
    16 = "BLR"
    17 = "BEL"
    18 = "BLZ"
    19 = "BEN"
    20 = "BTN"
    21 = "BOL"
    22 = "BIH"
    23 = "BWA"
    24 = "BRA"
    25 = "BRN"
    26 = "BGR"
    27 = "BFA"
    28 = "BDI"
    29 = "KHM"
    30 = "CMR"
    31 = "CAN"
    32 = "CPV"
    33 = "CAF"
    34 = "TCD"
    35 = "CHL"
    36 = "CHN"
    37 = "COL"
    38 = "COM"
    39 = "COG"
    40 = "COD"
    41 = "CRI"
    42 = "HRV"
    43 = "CUB"
    44 = "CYP"
    45 = "CZE"
    46 = "DNK"
    47 = "DJI"
    48 = "DMA"
    49 = "DOM"
    50 = "TLS"
    51 = "ECU"
    52 = "EGY"
    53 = "SLV"
    54 = "GNQ"
    55 = "ERI"
    56 = "EST"
    57 = "ETH"
    58 = "FJI"
    59 = "FIN"
    60 = "FRA"
    61 = "GAB"
    62 = "GMB"
    63 = "GEO"
    64 = "DEU"
    65 = "GHA"
    66 = "GRC"
    67 = "GRD"
    68 = "GTM"
    69 = "GIN"
    70 = "GNB"
    71 = "GUY"
    72 = "HTI"
    73 = "HND"
    74 = "HUN"
    75 = "ISL"
    76 = "IND"
    77 = "IDN"
    78 = "IRN"
    79 = "IRQ"
    80 = "IRL"
    81 = "ISR"
    82 = "ITA"
    83 = "CIV"
    84 = "JAM"
    85 = "JPN"
    86 = "JOR"
    87 = "KAZ"
    88 = "KEN"
    89 = "KIR"
    90 = "PRK"
    91 = "KOR"
    92 = "XXK"
    93 = "KWT"
    94 = "KGZ"
    95 = "LAO"
    96 = "LVA"
    97 = "LBN"
    98 = "LSO"
    99 = "LBR"
    100 = "LBY"
    101 = "LIE"
    102 = "LTU"
    103 = "LUX"
    104 = "MKD"
    105 = "MDG"
    106 = "MWI"
    107 = "MYS"
    108 = "MDV"
    109 = "MLI"
    110 = "MLT"
    111 = "MHL"
    112 = "MRT"
    113 = "MUS"
    114 = "MEX"
    115 = "FSM"
    116 = "MDA"
    117 = "MCO"
    118 = "MNG"
    119 = "MNE"
    120 = "MAR"
    121 = "MOZ"
    122 = "MMR"
    123 = "NAM"
    124 = "NRU"
    125 = "NPL"
    126 = "NLD"
    127 = "NZL"
    128 = "NIC"
    129 = "NER"
    130 = "NGA"
    131 = "NOR"
    132 = "OMN"
    133 = "PAK"
    134 = "PLW"
    135 = "PAN"
    136 = "PNG"
    137 = "PRY"
    138 = "PER"
    139 = "PHL"
    140 = "POL"
    141 = "PRT"
    142 = "QAT"
    143 = "ROU"
    144 = "RUS"
    145 = "RWA"
    146 = "KNA"
    147 = "LCA"
    148 = "VCT"
    149 = "WSM"
    150 = "SMR"
    151 = "STP"
    152 = "SAU"
    153 = "SEN"
    154 = "SRB"
    155 = "SYC"
    156 = "SLE"
    157 = "SGP"
    158 = "SVK"
    159 = "SVN"
    160 = "SLB"
    161 = "SOM"
    162 = "ZAF"
    163 = "SSD"
    164 = "ESP"
    165 = "LKA"
    166 = "SDN"
    167 = "SUR"
    168 = "SWZ"
    169 = "SWE"
    170 = "CHE"
    171 = "SYR"
    172 = "TWN"
    173 = "TJK"
    174 = "TZA"
    175 = "THA"
    176 = "TGO"
    177 = "TON"
    178 = "TTO"
    179 = "TUN"
    180 = "TUR"
    181 = "TKM"
    182 = "TUV"
    183 = "UGA"
    184 = "UKR"
    185 = "ARE"
    186 = "GBR"
    187 = "USA"
    188 = "URY"
    189 = "UZB"
    190 = "VUT"
    191 = "VAT"
    192 = "VEN"
    193 = "VNM"
    194 = "YEM"
    195 = "ZMB"
    196 = "ZWE"

[adtl.defs.admissionDateHierarchy]
  combinedType = "firstNonNull"
  excludeWhen = "none"
  fields = [
    { field = "hostdat", description = "Admission date at this facility" },
    { field = "cestdat", description = "Onset date of first/earliest symptom" },
    { field = "dsstdat", description = "Date of enrolment" },
  ]

[adtl.defs.followupDateHierarchy]
  combinedType = "firstNonNull"
  fields = [
    { field = "flw_survey_date", description = "About you and your COVID-19 illness (if you're completing this survey on behalf of a child or adult that you care for, all the questions relate to their health and wellbeing)" },
    { field = "flw2_survey_date", description = "About you and your COVID-19 illness (if you're completing this survey on behalf of a child or adult that you care for, all the questions relate to their health and wellbeing)" },
    { field = "daily_date", description = "Date of follow-up" },
    { field = "dsstdtc", description = "Outcome date" },
  ]

[adtl.tables]
  subject = { kind = "groupBy", groupBy = "subject_id", aggregation = "lastNotNull", schema = "../../schemas/dev/subject.schema.json", optional-fields = [
    "ethnicity",
  ] }
  visit = { kind = "groupBy", groupBy = "visit_id", aggregation = "lastNotNull", schema = "../../schemas/dev/visit.schema.json" }
  observation = { kind = "oneToMany", schema = "../../schemas/dev/observation.schema.json", common = { visit_id = { field = "subjid", sensitive = true } } }

  ## SUBJECT

[subject]
  pathogen = "COVID-19"

  [subject.sex_at_birth]
    field = "sex"
    description = "Sex at Birth"
    values = { 1 = "male", 2 = "female" }

  [subject.subject_id]
    field = "subjid"
    ref = "relsub"
    sensitive = true
    ignoreMissingKey = true
    description = "Participant Identification Number (PIN)"

  [subject.enrolment_date]
    field = "dsstdat"
    description = "Date of Enrolment"

  [subject.earliest_admission_date]
    combinedType = "min"
    fields = [
      { field = "hostdat", description = "Admission date at this facility" },
    ]

  [subject.ethnicity]
    description = "Ethnicity"
    combinedType = "set"
    excludeWhen = "none"
    fields = [
      { field = "flw_ethnicity", ref = "ethnicityMap" },
      { field = "flw2_ethnicity", ref = "ethnicityMap" },
      { field = "flw_ethnicity_oth", description = "Other ethnicity" },
      { field = "flw2_ethnicity_oth", description = "Other ethnicity" },
    ]

  [subject.works_microbiology_lab]
    field = "labwork_erterm"
    ref = "Y/N/NK"
    description = "Employed in a microbiology laboratory?"

  [subject.works_healthcare]
    field = "healthwork_erterm"
    ref = "Y/N/NK"
    description = "Employed as a healthcare worker?"

  [subject.age]
    description = "Age/Estimated age"
    combinedType = "firstNonNull"

    [[subject.age.fields]]
      field = "brthdtc"
      apply = { function = "yearsElapsed", params = ["$dsstdat", 2022] }

    [[subject.age.fields]]
      field = "age"
      unit = "years"
      source_unit = { field = "ageu", values = { 1 = "months", 2 = "years" } }

[subject.date_of_birth]
  field = "brthdtc"

[subject.dob_year]
  combinedType = "firstNonNull"
  fields = [
    { field = "brthdtc", apply = { function = "splitDate", params = [
      "year",
      2022,
    ] } },
    { field = "age", if = { ageu = 2 }, apply = { function = "startYear", params = [
      [
        "$hostdat",
        "$cestdat",
        "$dsstdat",
      ],
      2022,
    ] } },
    { field = "age", if = { ageu = 1 }, apply = { function = "startYear", params = [
      [
        "$hostdat",
        "$cestdat",
        "$dsstdat",
      ],
      2022,
      "%Y-%m-%d",
      "months",
    ] } },
  ]

[subject.dob_month]
  combinedType = "firstNonNull"
  fields = [
    { field = "brthdtc", apply = { function = "splitDate", params = [
      "month",
      2022,
    ] } },
    { field = "age", if = { ageu = 1 }, apply = { function = "startMonth", params = [
      [
        "$hostdat",
        "$cestdat",
        "$dsstdat",
      ],
      2022,
    ] } },
  ]

[subject.dob_day]
  field = "brthdtc"
  apply = { function = "splitDate", params = ["day", 2022] }

[subject.pregnancy]
  field = "pregyn_rptestcd"
  description = "Pregnant ?"
  values = { 0 = false, 1 = true }

[subject.pregnancy_date_of_delivery]
  field = "apdm_brthdat"
  description = "Delivery date"

[subject.pregnancy_birth_weight_kg]
  field = "apvs_weight_vsorres"
  source_unit = "grams"
  unit = "kg"
  description = "Birth weight"

[subject.pregnancy_outcome]
  field = "still_ceoccur"
  values = { 1 = "Still birth", 2 = "Live birth" }

[subject.pregnancy_gestational_age_weeks]
  field = "apsc_egestage_scorres"
  description = "Gestational weeks assessment"

[subject.has_hiv]
  combinedType = "any"
  fields = [
    { field = "hiv_mborres", description = "AIDS/HIV", values = { 1 = true, 0 = false } },
    { field = "aidshiv_mhyn", description = "HIV", values = { 1 = true, 4 = true, 2 = false } },
  ]

[subject.has_hiv_art]
  field = "aidshiv_mhyn"
  values = { 1 = true, 2 = false, 4 = false } # 3=nk

[subject.has_hypertension]
  field = "hypertension_mhyn"
  ref = "Y/N/NK"
  description = "Hypertension (physician diagnosed)"

[subject.has_malignant_neoplasm]
  field = "malignantneo_mhyn"
  ref = "Y/N/NK"
  description = "Malignant neoplasm"

[subject.has_malnutrition]
  field = "malnutrition_vsorres"
  values = { 1 = true, 0 = false }
  description = "Patient is malnourished"

[subject.has_smoking]
  field = "smoking_mhyn"
  values = { 1 = "yes", 2 = "never" } # TODO: How to get has_smoking=former?
  description = "Current smoking"

[subject.has_asthma]
  field = "asthma_mhyn"
  ref = "Y/N/NK"
  description = "Asthma (physician diagnosed)"

[subject.has_chronic_cardiac_disease]
  field = "chroniccard_mhyn"
  ref = "Y/N/NK"
  description = "Chronic cardiac disease, including congenital heart disease (not hypertension)"

[subject.has_chronic_kidney_disease]
  field = "renal_mhyn"
  ref = "Y/N/NK"
  description = "Chronic kidney disease"

[subject.has_diabetes]
  field = "diabetes_mhyn"
  ref = "Y/N/NK"
  description = "Diabetes"

[subject.has_asplenia]
  field = "asplenia_mhyn"
  ref = "Y/N/NK"
  description = "Asplenia"

[subject.has_tuberculosis]
  field = "tb_mhyn"
  ref = "Y/N/NK"
  description = "Tuberculosis"

[subject.has_liver_disease]
  field = "liver_mhyn"
  ref = "Y/N/NK"
  description = "Liver disease"

[subject.has_died]
  combinedType = "any"
  fields = [
    { field = "dsterm", description = "Death occurred", values = { 1 = false, 2 = false, 3 = false, 4 = true, 5 = false } },
    { field = "flw_deceased_yn", description = "Is the patient deceased?", values = { 1 = true, 0 = false } },
    { field = "flw2_deceased_yn", description = "Is the patient deceased?", values = { 1 = true, 0 = false } },
  ]


[subject.date_death]
  combinedType = "firstNonNull"
  fields = [
    { field = "dsstdtc", description = "outcome date", if = { dsterm = 4 } },
    { field = "flw_date_death", description = "Date of death", if = { flw_deceased_yn = 1 } },
    { field = "flw2_date_death", description = "Date of death", if = { flw2_deceased_yn = 1 } },
  ]

[subject.icu_admitted]
  combinedType = "any"
  fields = [
    { field = "overall_icu_hoterm", description = "icu at any time?", values = { 1 = true, 2 = false } },
    { field = "ccm_a_icu_hoyn", description = "ICU/HDU today?", values = { 1 = true, 2 = true, 0 = false } },
    { field = "daily_icu_hoterm", description = "icu today?", values = { 1 = true, 2 = false } },
    { field = "icu_hoterm", description = "first day of admission", values = { 1 = true, 2 = false } },
  ]

  ## VISIT

[visit]
  country_iso3 = { field = "country", ref = "countryMap" }

  [visit.visit_id]
    field = "subjid"
    sensitive = true

  [visit.start_date]
    combinedType = "firstNonNull"
    excludeWhen = "none"
    fields = [
      { field = "hostdat", description = "Admission date at this facility" },
      { field = "cestdat", description = "Onset date of first/earliest symptom" },
      { field = "flw_date_symptoms", description = "Roughly what day did you first experience symptoms of COVID-19?" },
      { field = "dsstdat", description = "Date of enrolment" },
    ]

  [visit.subject_id]
    field = "subjid"
    ref = "relsub"
    sensitive = true
    ignoreMissingKey = true

  [visit.icu_admission]
    description = "ICU or High Dependency admission"
    combinedType = "any"

    [[visit.icu_admission.fields]]
      field = "overall_icu_hoterm"
      ref = "Y/N/NK"
      description = "ICU or High Dependency admission?"

    [[visit.icu_admission.fields]]
      field = "daily_icu_hoterm"
      ref = "Y/N/NK"
      description = "ICU or High Dependency admission?"

    [[visit.icu_admission.fields]]
      field = "icu_hoterm"
      ref = "Y/N/NK"
      description = "ICU or High Dependency admission on the first day of admission?"

    [[visit.icu_admission.fields]]
      field = "ccm_a_icu_hoyn"
      description = "Current admission to ICU or other High Dependency Unit (HDU)?"
      values = { 0 = false, 1 = true, 2 = true }

[visit.transfer_from_other_facility]
  field = "hoyn"
  values = { 1 = false, 2 = true, 0 = false }

[visit.treatment_ace_inhibitors]
  description = "Ace Inhibitors"
  combinedType = "any"

  [[visit.treatment_ace_inhibitors.fields]]
    field = "daily_ace_cmoccur"
    ref = "Y/N/NK"
    description = "Angiotension converting enzyme inhibitors (ACE inhibitors)?"

  [[visit.treatment_ace_inhibitors.fields]]
    field = "ace_cmoccur"
    ref = "Y/N/NK"
    description = "Angiotensin converting enzyme inhibitors (ACE) on the first day of admission?"

[visit.treatment_antibiotics]
  description = "Antibiotics"
  combinedType = "any"
  fields = [
    { field = "overall_antibiotic_cmyn", ref = "Y/N/NK", description = "Antibiotic?" },
    { field = "daily_antibiotic_cmyn", ref = "Y/N/NK", description = "Antibiotic?" },
    { field = "antibiotic_cmyn", ref = "Y/N/NK", description = "Antibiotic on the first day of admission?" },
  ]

[visit.treatment_antibiotics_type]
  combinedType = "set"
  excludeWhen = 'false-like'
  fields = [
    { field = "overall_antibiotic_cmtype___1", values = { 1 = "Aminoglycosides" } },
    { field = "overall_antibiotic_cmtype___2", values = { 1 = "Carbapenems" } },
    { field = "overall_antibiotic_cmtype___3", values = { 1 = "Cephalosporins - 1st generation" } },
    { field = "overall_antibiotic_cmtype___4", values = { 1 = "Cephalosporins - 2nd generation" } },
    { field = "overall_antibiotic_cmtype___5", values = { 1 = "Cephalosporins - 3rd generation" } },
    { field = "overall_antibiotic_cmtype___6", values = { 1 = "Cephalosporins - 4th generation" } },
    { field = "overall_antibiotic_cmtype___7", values = { 1 = "Cephalosporins - 5th generation" } },
    { field = "overall_antibiotic_cmtype___8", values = { 1 = "Glycopeptides" } },
    { field = "overall_antibiotic_cmtype___9", values = { 1 = "Lincosamides" } },
    { field = "overall_antibiotic_cmtype___10", values = { 1 = "Macrolides" } },
    { field = "overall_antibiotic_cmtype___11", values = { 1 = "Nitrofurans" } },
    { field = "overall_antibiotic_cmtype___12", values = { 1 = "Oxazolidinones" } },
    { field = "overall_antibiotic_cmtype___13", values = { 1 = "Beta-lactam" } },
    { field = "overall_antibiotic_cmtype___14", values = { 1 = "Beta-lactam/beta-lactamase inhibitor combination" } },
    { field = "overall_antibiotic_cmtype___15", values = { 1 = "Quinolones/Fluoroquinolone" } },
    { field = "overall_antibiotic_cmtype___16", values = { 1 = "Co-trimoxazole (trimethoprim-sulfamethoxazole)" } },
    { field = "overall_antibiotic_cmtype___17", values = { 1 = "Flucloxacillin" } },
    { field = "overall_antibiotic_cmtype___18", values = { 1 = "Tetracyclines" } },
    { field = "overall_antibiotic_cmtype___19", values = { 1 = "Daptomycin" } },
    { field = "overall_antibiotic_cmoth", description = "free text" },
  ]

[visit.treatment_anticoagulation]
  description = "Heparin for systemic anticoagulation?"
  field = "ccm_b_heparint_cmyn"
  ref = "Y/N/NK"

[visit.treatment_antifungal_agent]
  description = "Antifungal"
  combinedType = "any"
  fields = [
    { field = "overall_antifung_cmyn", ref = "Y/N/NK", description = "Antifungal agent?" },
    { field = "daily_antifung_cmyn", ref = "Y/N/NK", description = "Antifungal agent?" },
    { field = "antifung_cmyn", ref = "Y/N/NK", description = "Antifungal agent on the first day of admission?" },
  ]

[visit.treatment_antimalarial]
  description = "Antimalarial"
  combinedType = "any"
  excludeWhen = "none"
  fields = [
    { field = "overall_antimal_cmyn", ref = "Y/N/NK", description = "Antimalarial agent?" },
    { field = "daily_antimal_cmyn", ref = "Y/N/NK", description = "Antimalarial agent?" },
    { field = "antimal_cmyn", ref = "Y/N/NK", description = "Antimalarial agent on the first day of admission?" },
    { fieldPattern = ".*exper_cmtype___1", values = { 1 = true } },
    { fieldPattern = ".*exper_cmtype___2", values = { 1 = true } },
  ]

[visit.treatment_antimalarial_type]
  combinedType = "set"
  excludeWhen = "none"
  fields = [
    { fieldPattern = ".*exper_cmtype___1", values = { 1 = "Chloroquine" } },
    { fieldPattern = ".*exper_cmtype___2", values = { 1 = "Hydroxychloroquine" } },
  ]

[visit.treatment_antivirals]
  description = "Antiviral"
  combinedType = "any"
  fields = [
    { field = "overall_antiviral_cmyn", ref = "Y/N/NK", description = "Antiviral agent?" },
    { field = "daily_antiviral_cmyn", ref = "Y/N/NK", description = "Antiviral agent?" },
    { field = "antiviral_cmyn", ref = "Y/N/NK", description = "Antiviral agent on the first day of admission?" },
  ]

[visit.treatment_antiviral_type]
  description = "Type of antiviral agent used"
  combinedType = "set"
  excludeWhen = "none"
  fields = [
    { fieldPattern = ".*antiviral_cmtrt___1", values = { 1 = "Ribavirin" } },
    { fieldPattern = ".*antiviral_cmtrt___2", values = { 1 = "Lopinavir/Ritonavir" } },
    { fieldPattern = ".*antiviral_cmtrt___3", values = { 1 = "Interferon alpha" } },
    { fieldPattern = ".*antiviral_cmtrt___4", values = { 1 = "Interferon beta" } },
    { fieldPattern = ".*antiviral_cmtrt___5", values = { 1 = "Neuraminidase inhibitor" } },
    { fieldPattern = ".*antiviral_cmtrt___6", values = { 1 = "Other" } },
  ]

[visit.treatment_antiviral_type_other]
  description = "Type of antiviral used - free text"
  combinedType = "set"
  excludeWhen = "false-like"
  fields = [
    { field = "antiviral_cmoth" },
    { field = "overall_antiviral_cmoth" },
    { field = "daily_antiviral_cmoth" },
  ]


[visit.treatment_neuromuscular_blocking_agents]
  field = "ccm_a_neuro_cmtrt"
  ref = "Y/N/NK"

[visit.treatment_arb]
  description = "Angiotensin II receptor blockers (ARB)"
  combinedType = "any"

  [[visit.treatment_arb.fields]]
    field = "daily_arb_cmoccur"
    ref = "Y/N/NK"
    description = "Angiotensin II receptor blockers (ARBs)?"

  [[visit.treatment_arb.fields]]
    field = "arb_cmoccur"
    ref = "Y/N/NK"
    description = "Angiotensin II receptor blockers (ARBs) on the first day of admission?"

[visit.treatment_corticosteroid]
  description = "Corticosteroid"
  combinedType = "any"
  fields = [
    { field = "overall_corticost_cmyn", ref = "Y/N/NK", description = "Corticosteroid?" },
    { field = "daily_corticost_cmyn", ref = "Y/N/NK", description = "Corticosteroid?" },
    { field = "corticost_cmyn", ref = "Y/N/NK", description = "Corticosteroid on the first day of admission?" },
  ]

[visit.treatment_corticosteroid_type]
  description = "Type of corticosteroid used"
  combinedType = "set"
  excludeWhen = "none"
  fields = [
    { fieldPattern = ".*corticost_cmtrt___1", values = { 1 = "Dexamethasone" } },
    { fieldPattern = ".*corticost_cmtrt___2", values = { 1 = "Hydrocortisone" } },
    { fieldPattern = ".*corticost_cmtrt___3", values = { 1 = "Prednisolone" } },
    { fieldPattern = ".*corticost_cmtrt___4", values = { 1 = "Methylprednisolone" } },
    { fieldPattern = ".*corticost_cmtrt___5", values = { 1 = "Other" } },
  ]

[visit.treatment_corticosteroid_type_other]
  description = "Type of corticosteroid used"
  combinedType = "set"
  excludeWhen = "false-like"
  fields = [
    { field = "corticost_cmoth" },
    { field = "overall_corticost_cmoth" },
    { field = "daily_corticost_cmoth" },
  ]

[visit.treatment_cardiovascular_support]
  combinedType = "any"
  fields = [
    { fieldPattern = ".*extracorp_prtrt", ref = "Y/N/NK" },
    { fieldPattern = ".*inotrop_cmtrt", description = "Inotropes/vasopressors?", ref = "Y/N/NK" },
    { field = "ccm_a_inotrop_cmtrt", ref = "Y/N/NK", description = "Any vasopressor/inotropic support?" },
  ]

[visit.treatment_dialysis]
  description = "Dialysis"
  combinedType = "any"
  fields = [
    { fieldPattern = "overall_rrt_prtrt", ref = "Y/N/NK", description = "Renal replacement therapy (RRT) or dialysis?" },
    { field = "daily_rrt_prtrt", ref = "Y/N/NK", description = "Renal replacement therapy (RRT) or dialysis?" },
    { field = "ccm_a_renal_prtrt", ref = "Y/N/NK", description = "Dialysis/Hemofiltration?" },
    { field = "ccm_b_renal_prtrt", ref = "Y/N/NK", description = "Dialysis/Hemofiltration?" },
  ]

[visit.treatment_ecmo]
  description = "ECMO"
  combinedType = "any"

  [[visit.treatment_ecmo.fields]]
    field = "overall_extracorp_prtrt"
    ref = "Y/N/NK"
    description = "Extracorporeal (ECMO) support?"

  [[visit.treatment_ecmo.fields]]
    field = "daily_extracorp_prtrt"
    ref = "Y/N/NK"
    description = "Extracorporeal (ECMO) support?"

  [[visit.treatment_ecmo.fields]]
    field = "extracorp_prtrt"
    ref = "Y/N/NK"
    description = "Extracorporeal (ECMO) support on the first day of admission?"

[visit.treatment_experimental_agent]
  description = "Experimental treatments"
  combinedType = "any"
  fields = [
    { field = "overall_exper_cmyn", ref = "Y/N/NK", description = "Experimental agent?" },
    { field = "daily_exper_cmyn", ref = "Y/N/NK", description = "Experimental agent?" },
    { field = "exper_cmyn", ref = "Y/N/NK", description = "Experimental agent on the first day of admission?" },
  ]

[visit.treatment_experimental_agent_type]
  description = "Experimental treatments used"
  combinedType = "set"
  excludeWhen = "none"
  # overall_*, daily_*, *
  fields = [
    { fieldPattern = ".*exper_cmtype___3", values = { 1 = "Remdesivir" } },
    { fieldPattern = ".*exper_cmtype___4", values = { 1 = "IL6 inhibitor" } },
    { fieldPattern = ".*exper_cmtype___5", values = { 1 = "IL1 inhibitor" } },
    { fieldPattern = ".*exper_cmtype___6", values = { 1 = "Convalescent plasma" } },
    { fieldPattern = ".*exper_cmtype___7", values = { 1 = "Other" } },
  ]

[visit.treatment_experimental_agent_type_other]
  combinedType = "set"
  excludeWhen = "none"
  description = "Experimental agent = other - free text field"
  fields = [{ fieldPattern = ".*exper_cmoth" }]

[visit.treatment_inotropes_vasopressors]
  description = "Inotropes/vasopressors"
  combinedType = "any"
  fields = [
    { field = "overall_inotrop_cmtrt", ref = "Y/N/NK", description = "Inotropes/vasopressors?" },
    { field = "daily_inotrop_cmtrt", ref = "Y/N/NK", description = "Inotropes/vasopressors?" },
    { field = "inotrop_cmtrt", ref = "Y/N/NK", description = "Inotropes/vasopressors on the first day of admission?" },
    { field = "ccm_a_inotrop_cmtrt", ref = "Y/N/NK", description = "Any vasopressor/inotropic support?" },
  ]

[visit.treatment_intravenous_fluids]
  description = "IV fluids"
  combinedType = "any"
  fields = [
    { field = "overall_iv_fluids_cmyn", ref = "Y/N/NK", description = "Intraveonous fluids?" },
    { field = "daily_iv_fluids_cmyn", ref = "Y/N/NK", description = "Intraveonous fluids?" },
    { field = "iv_fluids_cmyn", ref = "Y/N/NK", description = "Intraveonous fluids on the first day of admission?" },
  ]

[visit.treatment_invasive_ventilation]
  description = "Invasive ventilation"
  combinedType = "any"
  fields = [
    { field = "overall_invasive_proccur", ref = "Y/N/NK", description = "Invasive ventilation?" },
    { field = "daily_invasive_proccur", ref = "Y/N/NK", description = "Invasive ventilation?" },
    { field = "invasive_proccur", ref = "Y/N/NK", description = "Invasive ventilation on first day of admission?" },
    { field = "ccm_b_invasive_prtrt", ref = "Y/N/NK", description = "Invasive ventilation?" },
  ]

[visit.treatment_noninvasive_ventilation]
  description = "Non-invasive ventilation"
  combinedType = "any"

  [[visit.treatment_noninvasive_ventilation.fields]]
    field = "overall_noninvasive_proccur"
    ref = "Y/N/NK"
    description = "Non-invasive ventilation?"

  [[visit.treatment_noninvasive_ventilation.fields]]
    field = "daily_noninvasive_proccur"
    ref = "Y/N/NK"
    description = "Non-invasive ventilation?"

  [[visit.treatment_noninvasive_ventilation.fields]]
    field = "noninvasive_proccur"
    ref = "Y/N/NK"
    description = "Non-invasive ventilation on first day of admission?"

  [[visit.treatment_noninvasive_ventilation.fields]]
    field = "ccm_b_noninvasive_prtrt"
    ref = "Y/N/NK"
    description = "Non-invasive ventilation?"

[visit.treatment_nsaid]
  description = "NSAID"
  combinedType = "any"

  [[visit.treatment_nsaid.fields]]
    field = "overall_nsaid_cmyn"
    ref = "Y/N/NK"
    description = "Non-steroidal anti-inflammatory (NSAID)?"

  [[visit.treatment_nsaid.fields]]
    field = "daily_nsaid_cmoccur"
    ref = "Y/N/NK"
    description = "Non-steroidal anti-inflammatory (NSAID)?"

  [[visit.treatment_nsaid.fields]]
    field = "nsaid_cmoccur"
    ref = "Y/N/NK"
    description = "Non-steroidal anti-inflammatory (NSAID) on first day of admission?"

[visit.treatment_other]
  combinedType = "set"
  excludeWhen = "none"
  fields = [{ field = "ccm_a_other_prtrt", if = { ccm_a_oth_prperf = 1 } }]
  description = "Other intervention or procedure not already recorded in this form or in the RAPID Module 2 form?"
  # include others? most are in 'other please specify' for specific categories e.g. corticosteroid.

[visit.treatment_oxygen_therapy]
  description = "Oxygen therepy"
  combinedType = "any"
  fields = [
    { field = "overall_oxygen_cmoccur", ref = "Y/N/NK", description = "Oxygen therepy?" },
    { field = "daily_oxygen_cmoccur", ref = "Y/N/NK", description = "Oxygen therepy?" },
    { field = "oxygen_cmoccur", ref = "Y/N/NK", description = "Oxygen therepy on first day of admission?" },
    { field = "ccm_a_fi02_lbyn", ref = "Y/N/NK", description = "Any supplemental oxygen?" },
  ]

[visit.treatment_prone_position]
  description = "Prone Positioning"
  combinedType = "any"
  fields = [
    { field = "overall_prone_prtrt", ref = "Y/N/NK", description = "Prone positioning?" },
    { field = "daily_prone_prtrt", ref = "Y/N/NK", description = "Prone positioning?" },
    { field = "prone_prtrt", ref = "Y/N/NK", description = "Prone position on first day of admission?" },
    { field = "ccm_a_pronevent_prtrt", ref = "Y/N/NK", description = "Prone positioning?" },
    { field = "ccm_b_pronevent_prtrt", ref = "Y/N/NK", description = "Prone positioning?" },
  ]

[visit.treatment_inhaled_nitric_oxide]
  field = "ccm_a_nitritc_cmtrt"
  ref = "Y/N/NK"
  description = "Inhaled nitric oxide?"

[visit.treatment_high_flow_nasal_cannula]
  combinedType = "any"
  excludeWhen = "none"
  fields = [
    { field = "ccm_b_hhfnc_prtrt", ref = "Y/N/NK", description = "Humidified high flow nasal cannula (HHFNC)?" },
    { field = "overall_oxygen_cmtype___2", values = { 1 = true, 0 = false }, description = "Oxygen therapy? (interface)" },
    { field = "daily_oxygen_cmtype", values = { 2 = true }, description = "Oxygen therapy? (interface)" },
    { field = "oxygen_cmtype", values = { 2 = true }, description = "Oxygen therapy? (interface)" },
  ]


[visit.icu_admission_dates]
  description = "ICU admission date"
  combinedType = "list"
  excludeWhen = "none"
  fields = [
    { field = "overall_icu_hostdat", description = "ICU admission date" },
    { field = "ccm_b_icu_hodat", description = "ICU admission date" },
  ]

[visit.outcome]
  field = "dsterm"
  description = "Outcome"

  [visit.outcome.values]
    1 = "discharged"
    2 = "hospitalised"
    3 = "transferred"
    4 = "death"
    5 = "palliative discharge"

[visit.date_outcome]
  field = "dsstdtc"
  description = "Outcome date"

  ## OBSERVATION

[[observation]]
  name = "bleeding_haemorrhage"
  date = { ref = "admissionDateHierarchy" }
  phase = "admission"
  is_present = { field = "bleed_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "bleeding"
  date = { ref = "followupDateHierarchy" }
  phase = "followup"
  is_present = { field = "flw_bleeding", values = { 1 = true, 0 = false }, description = "Bleeding" }
  [observation.context]
    combinedType = "set"
    fields = [{ field = "flw_bleeding_site" }]

[[observation]]
  name = "cough"
  date = { ref = "admissionDateHierarchy" }
  phase = "admission"
  [observation.is_present]
    combinedType = "any"
    fields = [
      { field = "symptoms_cough", values = { 1 = true, 0 = false } },
      { field = "cough_ceoccur_v2", ref = "Y/N/NK" },
      { field = "coughsput_ceoccur_v2", ref = "Y/N/NK" },
      { field = "coughhb_ceoccur_v2", ref = "Y/N/NK" },
    ]

[[observation]]
  name = "cough_dry"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "cough_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "cough_with_sputum_production"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "coughsput_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "cough_with_haemoptysis"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "coughhb_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "cough"
  date = { field = "daily_date" }
  phase = "study"
  [observation.is_present]
    combinedType = "any"
    fields = [
      { field = "daily_cough_ceoccur_v2", ref = "Y/N/NK" },
      { field = "daily_coughsput_ceoccur_v2", ref = "Y/N/NK" },
    ]

[[observation]]
  name = "cough_dry"
  date = { field = "daily_date" }
  phase = "study"
  is_present = { field = "daily_cough_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "cough_with_sputum_production"
  date = { field = "daily_date" }
  duration_type = "event"
  phase = "study"
  is_present = { field = "daily_coughsput_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "cough_dry"
  phase = "followup"
  start_date = { field = "flw_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw_survey_date" }
  duration_type = "event"
  is_present = { field = "flw_pers_cough", ref = "Y/N/NK", if = { flw_pers_cough_y = 1 } }

[[observation]]
  name = "cough_with_sputum_production"
  phase = "followup"
  start_date = { field = "flw_survey_date", apply = { function = "startDate", params = [
    7,
  ] } }
  date = { field = "flw_survey_date" }
  duration_type = "event"
  is_present = { field = "flw_pers_cough", ref = "Y/N/NK", if = { flw_pers_cough_y = 2 } }
  if = { "flw_pers_cough_y" = 2 }

[[observation]]
  name = "avpu"
  date = { ref = "admissionDateHierarchy" }
  phase = "admission"
  text = { field = "avpu_vsorres", values = { 1 = "Alert", 2 = "Verbal", 3 = "Pain", 4 = "Unresponsive" } }

[[observation]]
  name = "avpu"
  date = { field = "daily_date" }
  phase = "study"
  text = { field = "daily_avpu_vsorres", values = { 1 = "Alert", 2 = "Verbal", 3 = "Pain", 4 = "Unresponsive" } }

[[observation]]
  name = "oxygen_saturation_percent"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  value = { field = "oxy_vsorres" }

  [observation.context]
    combinedType = "set"
    excludeWhen = "none"
    fields = [
      { field = "oxy_vsorresu", values = { 1 = "Room air", 2 = "Oxygen therapy" } },
    ]
    description = "Oxygen saturation on:"

[[observation]]
  name = "oxygen_saturation_percent"
  phase = "study"
  date = { field = "daily_date" }
  value = { field = "daily_oxy_vsorres" }

  [observation.context]
    combinedType = "set"
    excludeWhen = "none"
    fields = [
      { field = "daily_oxy_vsorresu", values = { 1 = "Room air", 2 = "Oxygen therapy" } },
    ]
    description = "Oxygen saturation on:"

[[observation]]
  name = "glasgow_coma_score"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  value = { field = "gcs_vsorres" }

[[observation]]
  name = "glasgow_coma_score"
  phase = "study"
  date = { field = "daily_date" }
  value = { field = "daily_gcs_vsorres" } # out of 15
  #description = "Glasgow Coma Score (GCS/15)"

[[observation]]
  name = "conjunctivitis"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "conjunct_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "conjunctivitis"
  phase = "study"
  date = { field = "daily_date" }
  is_present = { field = "daily_conjunct_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "runny_nose"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "runnynose_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "seizures"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "seizures_cecoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "seizures"
  phase = "study"
  date = { field = "daily_date" }
  is_present = { field = "daily_seizures_cecoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "seizures"
  phase = "followup"
  date = { ref = "followupDateHierarchy" }
  is_present = { field = "flw_seizures", values = { 1 = true, 0 = false } }

[[observation]]
  name = "seizures"
  phase = "followup"
  date = { ref = "followupDateHierarchy" }
  is_present = { field = "flw2_seizures", values = { 1 = true, 0 = false } }

[[observation]]
  name = "sore_throat"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "sorethroat_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "sore_throat"
  phase = "study"
  date = { field = "daily_date" }
  is_present = { field = "daily_sorethroat_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "vomiting_nausea"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "vomit_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "vomiting_nausea"
  phase = "study"
  date = { field = "daily_date" }
  is_present = { field = "daily_vomit_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "vomiting_nausea"
  phase = "followup"
  date = { ref = "followupDateHierarchy" }
  is_present = { field = "flw_nausea", values = { 1 = true, 0 = false } }

[[observation]]
  name = "vomiting_nausea"
  phase = "followup"
  date = { ref = "followupDateHierarchy" }
  is_present = { field = "flw2_feeling_sick", values = { 1 = true, 0 = false } }

[[observation]]
  name = "wheezing"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "wheeze_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "altered_consciousness_confusion"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "confusion_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "confusion"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "confusion_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "confusion"
  phase = "study"
  date = { field = "daily_date" }
  is_present = { field = "daily_confusion_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "confusion"
  phase = "followup"
  date = { field = "flw_survey_date" }
  is_present = { field = "flw_confusion", values = { 1 = true, 0 = false } }

[[observation]]
  name = "confusion"
  phase = "followup"
  date = { field = "flw2_survey_date" }
  is_present = { field = "flw2_confusion", values = { 1 = true, 0 = false } }

[[observation]]
  name = "chest_pain"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "chestpain_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "chest_pain"
  phase = "study"
  date = { field = "daily_date" }
  is_present = { field = "daily_chestpain_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "chest_pain"
  phase = "followup"
  date = { ref = "followupDateHierarchy" }
  is_present = { field = "flw_chest_pains", values = { 1 = true, 0 = false } }

[[observation]]
  name = "chest_pain"
  phase = "followup"
  date = { ref = "followupDateHierarchy" }
  is_present = { field = "flw2_chest_pains", values = { 1 = true, 0 = false } }

[[observation]]
  name = "joint_pain"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "jointpain_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "joint_pain"
  phase = "followup"
  date = { ref = "followupDateHierarchy" }
  is_present = { field = "flw_joint_pain", values = { 1 = true, 0 = false } }

[[observation]]
  name = "joint_pain"
  phase = "followup"
  date = { ref = "followupDateHierarchy" }
  is_present = { field = "flw2_joint_pain", values = { 1 = true, 0 = false } }

[[observation]]
  name = "muscle_aches"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "myalgia_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "muscle_aches"
  phase = "followup"
  date = { ref = "followupDateHierarchy" }
  is_present = { field = "flw_muscle_pain", values = { 1 = true, 0 = false } }

[[observation]]
  name = "muscle_aches"
  phase = "followup"
  date = { ref = "followupDateHierarchy" }
  is_present = { field = "flw2_muscle_pain", values = { 1 = true, 0 = false } }

[[observation]]
  name = "lymphadenopathy"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "lymp_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "shortness_of_breath"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "shortbreath_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "shortness_of_breath"
  phase = "study"
  date = { field = "daily_date" }
  is_present = { field = "daily_shortbreath_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "shortness_of_breath"
  phase = "followup"
  date = { ref = "followupDateHierarchy" }
  is_present = { field = "flw_short_breath", values = { 1 = true, 0 = false } }

[[observation]]
  name = "shortness_of_breath"
  phase = "followup"
  date = { ref = "followupDateHierarchy" }
  is_present = { field = "flw2_short_breath", values = { 1 = true, 0 = false } }

[[observation]]
  name = "abdominal_pain"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "abdopain_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "abdominal_pain"
  phase = "followup"
  date = { ref = "followupDateHierarchy" }
  is_present = { field = "flw_stomach_pain", values = { 1 = true, 0 = false } }

[[observation]]
  name = "abdominal_pain"
  phase = "followup"
  date = { ref = "followupDateHierarchy" }
  is_present = { field = "flw2_stomach", values = { 1 = true, 0 = false } }

[[observation]]
  name = "diarrhoea"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "diarrhoea_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "diarrhoea"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "daily_diarrhoea_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "diarrhoea"
  phase = "followup"
  date = { ref = "followupDateHierarchy" }
  is_present = { field = "flw_diarrhoea", values = { 1 = true, 0 = false } }

[[observation]]
  name = "diarrhoea"
  phase = "followup"
  date = { ref = "followupDateHierarchy" }
  is_present = { field = "flw2_diarrhoea", values = { 1 = true, 0 = false } }

[[observation]]
  name = "fatigue_malaise"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "fatigue_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "headache"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "headache_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "headache"
  phase = "followup"
  date = { ref = "followupDateHierarchy" }
  is_present = { field = "flw_headache", values = { 1 = true, 0 = false } }

[[observation]]
  name = "headache"
  phase = "followup"
  date = { ref = "followupDateHierarchy" }
  is_present = { field = "flw2_headache", values = { 1 = true, 0 = false } }

[[observation]]
  name = "skin_rash"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "rash_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "skin_rash"
  phase = "followup"
  date = { ref = "followupDateHierarchy" }
  is_present = { field = "flw_skin_rash", values = { 1 = true, 0 = false } }

[[observation]]
  name = "history_of_fever"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "fever_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "history_of_fever"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "symptoms_fever", values = { 1 = true, 0 = false } }

[[observation]]
  name = "history_of_fever"
  phase = "followup"
  date = { ref = "followupDateHierarchy" }
  is_present = { field = "flw_fever", values = { 1 = true, 0 = false } }

[[observation]]
  name = "history_of_fever"
  phase = "followup"
  date = { ref = "followupDateHierarchy" }
  is_present = { field = "flw2_fever", values = { 1 = true, 0 = false } }

[[observation]]
  name = "diastolic_blood_pressure_mmHg"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  value = { field = "diabp_vsorres" }

[[observation]]
  name = "diastolic_blood_pressure_mmHg"
  phase = "study"
  date = { field = "daily_date" }
  value = { field = "diastolic_vsorres" }

[[observation]]
  name = "heart_rate_bpm"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  value = { field = "hr_vsorres" }

[[observation]]
  name = "heart_rate_bpm"
  phase = "admission"
  date = { field = "daily_date" }
  value = { field = "daily_hr_vsorres" }

[[observation]]
  name = "respiratory_rate"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  value = { field = "rr_vsorres" }

[[observation]]
  name = "respiratory_rate"
  phase = "admission"
  date = { field = "daily_date" }
  value = { field = "daily_rr_vsorres" }

[[observation]]
  name = "systolic_blood_pressure_mmHg"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  value = { field = "sysbp_vsorres" }

[[observation]]
  name = "systolic_blood_pressure_mmHg"
  phase = "admission"
  date = { field = "daily_date" }
  value = { field = "systolic_vsorres" }

[[observation]]
  name = "lower_chest_wall_indrawing"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "lowerchest_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "skin_ulcers"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "skinulcers_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "severe_dehydration"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "dehydration_vsorres", values = { 1 = true, 0 = false } }

[[observation]]
  name = "severe_dehydration"
  phase = "admission"
  date = { field = "daily_date" }
  is_present = { field = "daily_dehydration_vsorres", values = { 1 = true, 0 = false } }

[[observation]]
  name = "sternal_capillary_refill_time_greater_2s"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "stercap_vsorres", values = { 1 = true, 0 = false } }

[[observation]]
  name = "sternal_capillary_refill_time_greater_2s"
  phase = "admission"
  date = { field = "daily_date" }
  is_present = { field = "daily_stercap_vsorres", values = { 1 = true, 0 = false } }

[[observation]]
  name = "loss_of_smell_or_taste"
  phase = "followup"
  date = { ref = "followupDateHierarchy" }

  [observation.is_present]
    combinedType = "any"
    fields = [
      { field = "flw_loss_smell", values = { 1 = true, 0 = false } },
      { field = "flw_loss_taste", values = { 1 = true, 0 = false } },
    ]


[[observation]]
  name = "loss_of_smell"
  phase = "followup"
  date = { ref = "followupDateHierarchy" }
  is_present = { field = "flw_loss_smell", values = { 1 = true, 0 = false } }

[[observation]]
  name = "loss_of_taste"
  phase = "followup"
  date = { ref = "followupDateHierarchy" }
  is_present = { field = "flw_loss_taste", values = { 1 = true, 0 = false } }

[[observation]]
  name = "inability_to_walk"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  is_present = { field = "inablewalk_ceoccur_v2", ref = "Y/N/NK" }

[[observation]]
  name = "inability_to_walk_scale"
  phase = "followup"
  date = { ref = "followupDateHierarchy" }
  value = { field = "flw_eq5d_mb_5l_uk_eng", ref = "inabilityWalk" }

[[observation]]
  name = "inability_to_walk_scale"
  phase = "followup"
  date = { ref = "followupDateHierarchy" }
  value = { field = "flw_eq5d_mb_5l_uk_eng_2", ref = "inabilityWalk" }

[[observation]]
  name = "inability_to_walk_scale"
  phase = "followup"
  date = { ref = "followupDateHierarchy" }
  value = { field = "flw_walking_today" }  #, values = { 1 = "No difficulty", 2 = "Some difficulty", 3 = "Lots of difficulty", 4 = "Unable to walk" } }

[[observation]]
  name = "inability_to_walk_scale"
  phase = "followup"
  date = { ref = "followupDateHierarchy" }
  value = { field = "flw2_eq5d_mb_5l_uk_eng_2", ref = "inabilityWalk" }

[[observation]]
  name = "inability_to_walk_scale"
  phase = "followup"
  date = { ref = "followupDateHierarchy" }
  value = { field = "flw2_walking_today" } #, values = { 1 = "No difficulty", 2 = "Some difficulty", 3 = "Lots of difficulty", 4 = "Unable to walk" } }

[[observation]]
  name = "clinical_frailty_score"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" } # not sure about this for this mapping ..
  value = { field = "ccm_b_cfs_rsorres" }

[[observation]]
  name = "temperature_celsius"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  context = ["highest"]
  value = { field = "temp_vsorres" }        # there is no source unit field, but a mix of celsius and farenheit in the data.

[[observation]]
  name = "temperature_celsius"
  phase = "study"
  date = { field = "daily_date" }
  value = { field = "daily_temp_vsorres" } # there is no source unit field

[[observation]]
  name = "pao2_mmHg"
  phase = "study"
  date = { field = "ccm_a_dat" }
  value = { field = "ccm_a_pao2_lborres", unit = "mmHg", source_unit = { field = "ccm_a_pao2_lborresu", values = { 1 = "kPa", 2 = "mmHg" }, description = "PaO2 unit" } }
  [observation.context]
    combinedType = "set"
    excludeWhen = "none"
    fields = [
      { field = "ccm_a_pao2_lbspec", values = { 1 = "Arterial", 3 = "Capillary", 4 = "Unknown" } },
    ]

[[observation]]
  name = "pco2_mmHg"
  phase = "study"
  date = { field = "ccm_a_dat" }
  value = { field = "ccm_a_pco2_lborres", unit = "mmHg", source_unit = { field = "ccm_a_pco2_lborresu", values = { 1 = "kPa", 2 = "mmHg" }, description = "PCO2 unit" } }

[[observation]]
  name = "mean_arterial_blood_pressure_mmHg"
  phase = "study"
  date = { field = "ccm_a_dat" }
  value = { field = "ccm_a_meanart_vsorres" }

[[observation]]
  name = "pH"
  phase = "study"
  date = { field = "ccm_a_dat" }
  value = { field = "ccm_a_ph_lborres" }

[[observation]]
  name = "base_excess"
  phase = "study"
  date = { field = "ccm_a_dat" }
  value = { field = "ccm_a_baseex_lborres" }

[[observation]]
  name = "oxygen_flow_volume_max"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  text = { field = "oxygen_cmdose", values = { 1 = "1-5 L/min", 2 = "6-10 L/min", 3 = "11-15 L/min", 4 = ">15 L/min" } }
  if.all = [{ oxygen_cmoccur = 1 }, { oxygen_cmdose = { "!=" = 5 } }]

  [observation.context]
    combinedType = "set"
    excludeWhen = "none"
    fields = [
      { field = "oxygen_cmtype", values = { 1 = "Nasal prongs", 2 = "HF nasal cannula", 3 = "Mask", 4 = "Mask with reservoir", 5 = "CPAP/NIV mask" } },
    ]

[[observation]]
  name = "oxygen_flow_volume_max"
  phase = "study"
  date = { field = "daily_date" }
  text = { field = "daily_oxygen_cmdose", values = { 1 = "1-5 L/min", 2 = "6-10 L/min", 3 = "11-15 L/min", 4 = ">15 L/min" } }
  if.all = [
    { daily_oxygen_cmoccur = 1 },
    { daily_oxygen_cmdose = { "!=" = 5 } },
  ]

  [observation.context]
    combinedType = "set"
    excludeWhen = "none"
    fields = [
      { field = "daily_oxygen_cmtype", values = { 1 = "Nasal prongs", 2 = "HF nasal cannula", 3 = "Mask", 4 = "Mask with reservoir", 5 = "CPAP/NIV mask" } },
    ]

[[observation]]
  name = "mid_upper_arm_circumference_cm"
  phase = "admission"
  date = { ref = "admissionDateHierarchy" }
  value = { field = "muac_vsorres", unit = "cm", source_unit = "mm" }

[[observation]]
  name = "richmond_agitation-sedation_scale"
  phase = "study"
  date = { field = "ccm_a_dat" }
  value = { field = "ccm_a_rass_vsorres", apply = { function = "getFloat" } }

[[observation]]
  name = "riker_sedation-agitation_scale"
  phase = "study"
  date = { field = "ccm_a_dat" }
  value = { field = "ccm_a_sas_vsorres", apply = { function = "getFloat" } }

[[observation]]
  name = "pneumonia"
  phase = "study"
  is_present = { field = "pneu_ceterm", ref = "Y/N/NK" }
  start_date = { ref = "admissionDateHierarchy" }
  date = { field = "dsstdtc" }
  duration_type = "event"
